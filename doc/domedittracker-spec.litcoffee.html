<html>
    <head>
        <link rel="stylesheet"
              href="../bootstrap/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="./main.css"/>
        <link rel="stylesheet" href="./obsidian.css"/>
        <link rel="shortcut icon" href="favicon.png"/>
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config( {
              tex2jax: { inlineMath: [ [ '$', '$' ], [ '\\(', '\\)' ] ] }
            } );
        </script>
        <script type="text/javascript"
                src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        </script>
        <title>webLurch docs: domedittracker-spec</title>
    </head>
    <body>
        <div id="left">
            <p align=center>Page contents</p>
<p><a href='#tests-for-the-code-domedittracker-code-class'>Tests for the <code>DOMEditTracker</code> class</a></p><ul>
<li><a href='#domedittracker-class'>DOMEditTracker class</a></li><ul>
<li><a href='#should-exist'>should exist</a></li><li><a href='#should-track-instances'>should track instances</a></li><li><a href='#should-find-the-correct-containers'>should find the correct containers</a></li></ul>
<li><a href='#domedittracker-instances-without-divs'>DOMEditTracker instances without DIVs</a></li><ul>
<li><a href='#should-return-a-null-element'>should return a null element</a></li></ul>
<li><a href='#domedittracker-instances-with-divs'>DOMEditTracker instances with DIVs</a></li><ul>
<li><a href='#should-return-the-correct-div'>should return the correct div</a></li></ul>
<li><a href='#the-undo-redo-stack'>The undo/redo stack</a></li><ul>
<li><a href='#should-grow-when-nodeedithappened'>should grow when nodeEditHappened</a></li><li><a href='#should-truncate-if-needed'>should truncate if needed</a></li><li><a href='#handles-canundo-canredo-correctly'>handles canUndo/canRedo correctly</a></li><li><a href='#gives-good-undo-redo-descriptions'>gives good undo/redo descriptions</a></li><li><a href='#performs-undo-redo-in-the-correct-order'>performs undo/redo in the correct order</a></li><li><a href='#supports-edit-blocks'>supports edit blocks</a></li>
        </div>
        <div id="middle">
            <h1><a name='tests-for-the-code-domedittracker-code-class'></a>Tests for the <code>DOMEditTracker</code> class &nbsp;  <font size=-1><a href='#tests-for-the-code-domedittracker-code-class'><span class="glyphicon glyphicon-link"></span></a></font></h1><p>This file contains the specifications for tests of the
<code>DOMEditTracker</code> class.  One of its aspects is that it manages an
undo/redo stack.  Testing of foundational undo/redo functionality
of <code>DOMEditActions</code> cannot, however, be found in this file; for
that, see <a href="undoredo-spec.litcoffee.html">a different test suite</a>.</p>
<p>Pull in the utility functions in
<a href="phantom-utils.litcoffee.html">phantom-utils</a> that make it
easier to write the tests below.  Then follow the same structure
for setting up tests as documented more thoroughly in
<a href="basic-spec.litcoffee.html">the basic unit test</a>.</p>
<pre class="hljs"><code>{ phantomDescribe, pageExpects, pageExpectsError,
  inPage, pageDo } = <span class="hljs-built_in">require</span> <span class="hljs-string">'./phantom-utils'</span>
</code></pre><h2><a name='domedittracker-class'></a>DOMEditTracker class &nbsp; <font size=-1><a href='test-results.md.html#domedittracker-class'>see results</a></font> <font size=-1><a href='#domedittracker-class'><span class="glyphicon glyphicon-link"></span></a></font></h2><pre class="hljs"><code>phantomDescribe <span class="hljs-string">'DOMEditTracker class'</span>, <span class="hljs-string">'./app/index.html'</span>,<span class="hljs-function"> -&gt;</span>
</code></pre><h3><a name='should-exist'></a>should exist &nbsp; <font size=-1><a href='test-results.md.html#should-exist'>see results</a></font> <font size=-1><a href='#should-exist'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>That is, the class should be defined in the global namespace of
the browser after loading the main app page.</p>
<pre class="hljs"><code>    it <span class="hljs-string">'should exist'</span>, inPage<span class="hljs-function"> -&gt;</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> DOMEditTracker ), <span class="hljs-string">'toBeTruthy'</span>
</code></pre><h3><a name='should-track-instances'></a>should track instances &nbsp; <font size=-1><a href='test-results.md.html#should-track-instances'>see results</a></font> <font size=-1><a href='#should-track-instances'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>Each instance of the class created should be placed in an array
stored in the class variable <code>@instances</code>.</p>
<pre class="hljs"><code>    it <span class="hljs-string">'should track instances'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>First of all, the page itself instantiates an edit tracker upon
loading, one surrounding a child of the document body.  So we first
check that there is an instance already, and its element has the
desired id.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span>
            DOMEditTracker.instances.length ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">1</span>
        pageExpects (<span class="hljs-function"> -&gt;</span>
            DOMEditTracker.instances[<span class="hljs-number">0</span>] \
                .getElement().parentNode <span class="hljs-keyword">is</span> <span class="hljs-built_in">document</span>.body ),
            <span class="hljs-string">'toBeTruthy'</span>
</code></pre><p>Create an edit tracker and check to be sure the instances array
has length 2 and contains the new instance.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> <span class="hljs-built_in">window</span>.T1 = <span class="hljs-keyword">new</span> DOMEditTracker
        pageExpects (<span class="hljs-function"> -&gt;</span> DOMEditTracker.instances.length ),
            <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">2</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> DOMEditTracker.instances[<span class="hljs-number">1</span>] <span class="hljs-keyword">is</span> T1 ),
            <span class="hljs-string">'toBeTruthy'</span>
</code></pre><p>Create another, this one around an element outside the document,
and check to be sure the instances array has length 3 and contains
the two new instances in the appropriate order.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            div = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'div'</span>
            <span class="hljs-built_in">window</span>.T2 = <span class="hljs-keyword">new</span> DOMEditTracker div
        pageExpects (<span class="hljs-function"> -&gt;</span> DOMEditTracker.instances.length ),
            <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">3</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> DOMEditTracker.instances[<span class="hljs-number">2</span>] <span class="hljs-keyword">is</span> T2 ),
            <span class="hljs-string">'toBeTruthy'</span>
</code></pre><h3><a name='should-find-the-correct-containers'></a>should find the correct containers &nbsp; <font size=-1><a href='test-results.md.html#should-find-the-correct-containers'>see results</a></font> <font size=-1><a href='#should-find-the-correct-containers'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>There will already be one <code>DOMEditTracker</code> instance in place,
instantiated by the index page itself.  It is over the first div in
the document.</p>
<p>This test creates a second div in the document and places another
<code>DOMEditTracker</code> instance over it, then checks to be sure that
each of the two instances that have elements can be found as the
instances in charge of those elements and their descendants.
It also tests the same for an instance whose element is outside
the document.</p>
<pre class="hljs"><code>    it <span class="hljs-string">'should find the correct containers'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>Here is the new div to add to the document, with some inner
elements and a <code>DOMEditTracker</code> instance around it.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.div = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'div'</span>
            <span class="hljs-built_in">document</span>.body.appendChild div
            div.innerHTML = <span class="hljs-string">'''
                &lt;div&gt;just some tags in a hierarchy
                &lt;span&gt;for testing purposes&lt;/span&gt;&lt;/div&gt;
                '''</span>
            <span class="hljs-built_in">window</span>.ielt = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'i'</span>
            ielt.textContent = <span class="hljs-string">'dummy'</span>
            div.appendChild ielt
            <span class="hljs-built_in">window</span>.another = <span class="hljs-keyword">new</span> DOMEditTracker div
</code></pre><p>First, is the original <code>DOMEditTracker</code> instance in charge of the
first div in the document?</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span>
            firstDiv = <span class="hljs-built_in">document</span>.body
                .getElementsByTagName( <span class="hljs-string">'div'</span> )[<span class="hljs-number">0</span>]
            DOMEditTracker.instances[<span class="hljs-number">0</span>] <span class="hljs-keyword">is</span>
                DOMEditTracker.instanceOver firstDiv ),
            <span class="hljs-string">'toBeTruthy'</span>
</code></pre><p>Second, is the new <code>DOMEditTracker</code> instance in charge of the div
created above?  And of one of its child nodes?  And one of its
grandchild nodes?</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> another <span class="hljs-keyword">is</span>
            DOMEditTracker.instanceOver div ), <span class="hljs-string">'toBeTruthy'</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> another <span class="hljs-keyword">is</span>
            DOMEditTracker.instanceOver ielt ), <span class="hljs-string">'toBeTruthy'</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> another <span class="hljs-keyword">is</span>
            DOMEditTracker.instanceOver ielt.childNodes[<span class="hljs-number">0</span>] ),
            <span class="hljs-string">'toBeTruthy'</span>
</code></pre><p>Now create an instance around a div outside the document, and do
similar tests on it.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.outside = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'div'</span>
            <span class="hljs-built_in">window</span>.child = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'p'</span>
            outside.appendChild child
            <span class="hljs-built_in">window</span>.grandchild = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'b'</span>
            grandchild.textContent = <span class="hljs-string">'waah'</span>
            child.appendChild grandchild
            <span class="hljs-built_in">window</span>.final = <span class="hljs-keyword">new</span> DOMEditTracker outside
        pageExpects (<span class="hljs-function"> -&gt;</span> final <span class="hljs-keyword">is</span>
            DOMEditTracker.instanceOver outside ), <span class="hljs-string">'toBeTruthy'</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> final <span class="hljs-keyword">is</span>
            DOMEditTracker.instanceOver child ), <span class="hljs-string">'toBeTruthy'</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> final <span class="hljs-keyword">is</span>
            DOMEditTracker.instanceOver grandchild ),
            <span class="hljs-string">'toBeTruthy'</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> final <span class="hljs-keyword">is</span> DOMEditTracker.instanceOver \
            grandchild.childNodes[<span class="hljs-number">0</span>] ), <span class="hljs-string">'toBeTruthy'</span>
</code></pre><h2><a name='domedittracker-instances-without-divs'></a>DOMEditTracker instances without DIVs &nbsp; <font size=-1><a href='test-results.md.html#domedittracker-instances-without-divs'>see results</a></font> <font size=-1><a href='#domedittracker-instances-without-divs'><span class="glyphicon glyphicon-link"></span></a></font></h2><pre class="hljs"><code>phantomDescribe <span class="hljs-string">'DOMEditTracker instances without DIVs'</span>,
<span class="hljs-string">'./app/index.html'</span>,<span class="hljs-function"> -&gt;</span>
</code></pre><h3><a name='should-return-a-null-element'></a>should return a null element &nbsp; <font size=-1><a href='test-results.md.html#should-return-a-null-element'>see results</a></font> <font size=-1><a href='#should-return-a-null-element'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>An instance of the <code>DOMEditTracker</code> class created without a div
should return null from its <code>getElement</code> method.</p>
<pre class="hljs"><code>    it <span class="hljs-string">'should return a null element'</span>, inPage<span class="hljs-function"> -&gt;</span>
        pageExpects (<span class="hljs-function"> -&gt;</span>
            D = <span class="hljs-keyword">new</span> DOMEditTracker()
            D.getElement()
        ), <span class="hljs-string">'toBeNull'</span>
</code></pre><h2><a name='domedittracker-instances-with-divs'></a>DOMEditTracker instances with DIVs &nbsp; <font size=-1><a href='test-results.md.html#domedittracker-instances-with-divs'>see results</a></font> <font size=-1><a href='#domedittracker-instances-with-divs'><span class="glyphicon glyphicon-link"></span></a></font></h2><p>We now test constructing a new <code>DOMEditTracker</code> instance around an
existing DOM element, and verify that it does the correct things
with ids.  See the documentation in
<a href="lurcheditor.litcoffee.html">the Lurch Editor class itself</a> for
details on what the constructor is expected to do in these
situations, or read each test description below.</p>
<pre class="hljs"><code>phantomDescribe <span class="hljs-string">'DOMEditTracker instances with DIVs'</span>,
<span class="hljs-string">'./app/index.html'</span>,<span class="hljs-function"> -&gt;</span>
</code></pre><h3><a name='should-return-the-correct-div'></a>should return the correct div &nbsp; <font size=-1><a href='test-results.md.html#should-return-the-correct-div'>see results</a></font> <font size=-1><a href='#should-return-the-correct-div'><span class="glyphicon glyphicon-link"></span></a></font></h3><pre class="hljs"><code>    it <span class="hljs-string">'should return the correct div'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>An instance of the <code>LurchEditor</code> class created without a div should
return null from its <code>getElement</code> method.  Here we construct the
<code>DOMEditTracker</code> instance around the div, as before.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.div = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'div'</span>
            <span class="hljs-built_in">document</span>.body.appendChild div
            <span class="hljs-built_in">window</span>.D = <span class="hljs-keyword">new</span> DOMEditTracker div
        pageExpects (<span class="hljs-function"> -&gt;</span> div <span class="hljs-keyword">is</span> D.getElement() ), <span class="hljs-string">'toBeTruthy'</span>
</code></pre><h2><a name='the-undo-redo-stack'></a>The undo/redo stack &nbsp; <font size=-1><a href='test-results.md.html#the-undo-redo-stack'>see results</a></font> <font size=-1><a href='#the-undo-redo-stack'><span class="glyphicon glyphicon-link"></span></a></font></h2><p>The tests in this section concern all functions related to the
undo/redo stack maintained by a <code>DOMEditTracker</code> instance.
See the documentation in <a href="domedittracker.litcoffee.html#undo-redo-stack">the DOMEditTracker source code</a> for information
about each function to be tested below, or just read the tests
themselves.</p>
<pre class="hljs"><code>phantomDescribe <span class="hljs-string">'The undo/redo stack'</span>, <span class="hljs-string">'./app/index.html'</span>,<span class="hljs-function"> -&gt;</span>
</code></pre><h3><a name='should-grow-when-nodeedithappened'></a>should grow when nodeEditHappened &nbsp; <font size=-1><a href='test-results.md.html#should-grow-when-nodeedithappened'>see results</a></font> <font size=-1><a href='#should-grow-when-nodeedithappened'><span class="glyphicon glyphicon-link"></span></a></font></h3><pre class="hljs"><code>    it <span class="hljs-string">'should grow when nodeEditHappened'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>When we call <code>nodeEditHappened</code> in the <code>DOMEditTracker</code> instance,
we require the undo/redo stack to grow, and the stack pointer to
continue to be equal to the size of the stack.</p>
<p>Create the objects needed to run the test.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.div = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'div'</span>
            <span class="hljs-built_in">document</span>.body.appendChild div
            <span class="hljs-built_in">window</span>.span1 = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'span'</span>
            <span class="hljs-built_in">window</span>.span2 = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'span'</span>
            <span class="hljs-built_in">window</span>.span3 = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'span'</span>
            <span class="hljs-built_in">window</span>.D = <span class="hljs-keyword">new</span> DOMEditTracker div
</code></pre><p>Verify that the inital values of the stack length and stack pointer
are both zero.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack.length ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">0</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">0</span>
</code></pre><p>Create three editing actions and add them to the stack, verifying
that the stack size and pointer increase with each addition.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> D.nodeEditHappened \
            <span class="hljs-keyword">new</span> DOMEditAction <span class="hljs-string">'appendChild'</span>, div, span1
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack.length ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">1</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">1</span>
        pageDo<span class="hljs-function"> -&gt;</span> D.nodeEditHappened \
            <span class="hljs-keyword">new</span> DOMEditAction <span class="hljs-string">'appendChild'</span>, div, span2
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack.length ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">2</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">2</span>
        pageDo<span class="hljs-function"> -&gt;</span> D.nodeEditHappened \
            <span class="hljs-keyword">new</span> DOMEditAction <span class="hljs-string">'appendChild'</span>, div, span3
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack.length ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">3</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">3</span>
</code></pre><p>Now try to add two invalid actions, and verify that neither the
stack size nor stack pointer changes.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> D.nodeEditHappened <span class="hljs-literal">null</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack.length ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">3</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">3</span>
        pageDo<span class="hljs-function"> -&gt;</span> D.nodeEditHappened <span class="hljs-string">'not an edit action'</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack.length ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">3</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">3</span>
</code></pre><h3><a name='should-truncate-if-needed'></a>should truncate if needed &nbsp; <font size=-1><a href='test-results.md.html#should-truncate-if-needed'>see results</a></font> <font size=-1><a href='#should-truncate-if-needed'><span class="glyphicon glyphicon-link"></span></a></font></h3><pre class="hljs"><code>    it <span class="hljs-string">'should truncate if needed'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>When we call <code>nodeEditHappened</code> in the <code>DOMEditTracker</code> instance,
if the stack pointer is <em>not</em> at the end of the stack, then the
stack should be truncated to make the stack pointer equal to the
stack size before appending the new edit actions.</p>
<p>Create the objects needed to run the test.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.div = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'div'</span>
            <span class="hljs-built_in">document</span>.body.appendChild div
            <span class="hljs-built_in">window</span>.D = <span class="hljs-keyword">new</span> DOMEditTracker div
</code></pre><p>Set up the stack with three actions in it, and add to a results
array the size of the stack and value of the pointer, to verify
that all three were added successfully.  Also record the type of
the most recent action on the stack.</p>
<pre class="hljs"><code>            D.nodeEditHappened <span class="hljs-keyword">new</span> DOMEditAction \
                <span class="hljs-string">'setAttribute'</span>, div, <span class="hljs-string">'key'</span>, <span class="hljs-string">'value'</span>
            D.nodeEditHappened <span class="hljs-keyword">new</span> DOMEditAction \
                <span class="hljs-string">'setAttribute'</span>, div, <span class="hljs-string">'key2'</span>, <span class="hljs-string">'value2'</span>
            span = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'span'</span>
            D.nodeEditHappened <span class="hljs-keyword">new</span> DOMEditAction <span class="hljs-string">'appendChild'</span>,
                div, span
</code></pre><p>Now we expect to find that there are three edits on the stack, and
that the final one is the &quot;appendChild&quot; action just performed.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack.length ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">3</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">3</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack[D.stack.length - <span class="hljs-number">1</span>].type),
            <span class="hljs-string">'toEqual'</span>, <span class="hljs-string">'appendChild'</span>
</code></pre><p>Push the stack pointer back by one, then record a new action, which
should cause the edit tracker to remove the old third action from
the stack before recording the new action.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            D.stackPointer--
            D.nodeEditHappened <span class="hljs-keyword">new</span> DOMEditAction <span class="hljs-string">'normalize'</span>,
                div
</code></pre><p>Verify that the stack has not grown, but that the new most recent
action is of the new type.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack.length ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">3</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">3</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack[D.stack.length - <span class="hljs-number">1</span>].type ),
            <span class="hljs-string">'toEqual'</span>, <span class="hljs-string">'normalize'</span>
</code></pre><h3><a name='handles-canundo-canredo-correctly'></a>handles canUndo/canRedo correctly &nbsp; <font size=-1><a href='test-results.md.html#handles-canundo-canredo-correctly'>see results</a></font> <font size=-1><a href='#handles-canundo-canredo-correctly'><span class="glyphicon glyphicon-link"></span></a></font></h3><pre class="hljs"><code>    it <span class="hljs-string">'handles canUndo/canRedo correctly'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>The <code>canUndo</code> and <code>canRedo</code> member functions of a <code>DOMEditTracker</code>
instance should return true if and only if the stack pointer is at
a location that permits undo/redo, respectively.  In particular,
one can call undo if and only if the stack pointer is not at the
bottom (zero) and can call redo if and only if it is not at the end
(the stack size).  This test verifies this if-and-only-ifs.</p>
<p>Create the objects needed to run the test.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            div = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'div'</span>
            <span class="hljs-built_in">document</span>.body.appendChild div
            <span class="hljs-built_in">window</span>.D = <span class="hljs-keyword">new</span> DOMEditTracker div
</code></pre><p>Set up the stack with three actions in it.</p>
<pre class="hljs"><code>            D.nodeEditHappened <span class="hljs-keyword">new</span> DOMEditAction \
                <span class="hljs-string">'setAttribute'</span>, div, <span class="hljs-string">'key'</span>, <span class="hljs-string">'value'</span>
            D.nodeEditHappened <span class="hljs-keyword">new</span> DOMEditAction \
                <span class="hljs-string">'setAttribute'</span>, div, <span class="hljs-string">'key2'</span>, <span class="hljs-string">'value2'</span>
            span = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'span'</span>
            D.nodeEditHappened <span class="hljs-keyword">new</span> DOMEditAction <span class="hljs-string">'appendChild'</span>,
                div, span
</code></pre><p>Verify that the stack pointer is at the end, and that we cannot
&quot;redo&quot; from there, but we can &quot;undo.&quot;</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">3</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.canRedo() ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-literal">no</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.canUndo() ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-literal">yes</span>
</code></pre><p>Move the stack pointer down the stack, and verify that at each of
its next two locations, both undo and redo are available.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> D.stackPointer--
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">2</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.canRedo() ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-literal">yes</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.canUndo() ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-literal">yes</span>
        pageDo<span class="hljs-function"> -&gt;</span> D.stackPointer--
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">1</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.canRedo() ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-literal">yes</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.canUndo() ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-literal">yes</span>
</code></pre><p>Move the stack pointer down one more step, which should be to the
bottom, and verify that we can redo but cannot undo.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> D.stackPointer--
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">0</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.canRedo() ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-literal">yes</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.canUndo() ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-literal">no</span>
</code></pre><h3><a name='gives-good-undo-redo-descriptions'></a>gives good undo/redo descriptions &nbsp; <font size=-1><a href='test-results.md.html#gives-good-undo-redo-descriptions'>see results</a></font> <font size=-1><a href='#gives-good-undo-redo-descriptions'><span class="glyphicon glyphicon-link"></span></a></font></h3><pre class="hljs"><code>    it <span class="hljs-string">'gives good undo/redo descriptions'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>The <code>undoDescription</code> and <code>redoDescription</code> member functions of a
<code>DOMEditTracker</code> instance should return descriptions of the actions
that would be taken if undo/redo were called (respectively).  This
test verifies, for various locations of the stack pointer in a
stack of three different types of actions, that the undo and redo
descriptiosn are as they should be.</p>
<p>Create the objects needed to run the test.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            div = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'div'</span>
            <span class="hljs-built_in">document</span>.body.appendChild div
            <span class="hljs-built_in">window</span>.D = <span class="hljs-keyword">new</span> DOMEditTracker div
            span = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'span'</span>
</code></pre><p>Set up the stack with three actions in it.</p>
<pre class="hljs"><code>            D.nodeEditHappened <span class="hljs-keyword">new</span> DOMEditAction <span class="hljs-string">'appendChild'</span>,
                div, span
            D.nodeEditHappened <span class="hljs-keyword">new</span> DOMEditAction \
                <span class="hljs-string">'setAttribute'</span>, div, <span class="hljs-string">'key'</span>, <span class="hljs-string">'value'</span>
            D.nodeEditHappened <span class="hljs-keyword">new</span> DOMEditAction <span class="hljs-string">'normalize'</span>,
                div
</code></pre><p>Check the initial values of the stack pointer and undo/redo
descriptions.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">3</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.undoDescription() ),
            <span class="hljs-string">'toEqual'</span>, <span class="hljs-string">'Undo Normalize text'</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.redoDescription() ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-string">''</span>
</code></pre><p>Move the stack pointer down the stack three times (which should put
it at the bottom) and at each position, check the same data as
above.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> D.stackPointer--
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">2</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.undoDescription() ),
            <span class="hljs-string">'toEqual'</span>, <span class="hljs-string">'Undo Change key from empty to value'</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.redoDescription() ),
            <span class="hljs-string">'toEqual'</span>, <span class="hljs-string">'Redo Normalize text'</span>
        pageDo<span class="hljs-function"> -&gt;</span> D.stackPointer--
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">1</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.undoDescription() ),
            <span class="hljs-string">'toEqual'</span>, <span class="hljs-string">'Undo Add a node'</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.redoDescription() ),
            <span class="hljs-string">'toEqual'</span>, <span class="hljs-string">'Redo Change key from empty to value'</span>
        pageDo<span class="hljs-function"> -&gt;</span> D.stackPointer--
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">0</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.undoDescription() ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-string">''</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> D.redoDescription() ),
            <span class="hljs-string">'toEqual'</span>, <span class="hljs-string">'Redo Add a node'</span>
</code></pre><h3><a name='performs-undo-redo-in-the-correct-order'></a>performs undo/redo in the correct order &nbsp; <font size=-1><a href='test-results.md.html#performs-undo-redo-in-the-correct-order'>see results</a></font> <font size=-1><a href='#performs-undo-redo-in-the-correct-order'><span class="glyphicon glyphicon-link"></span></a></font></h3><pre class="hljs"><code>    it <span class="hljs-string">'performs undo/redo in the correct order'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>Although undo/redo are already tested for individual actions in
<a href="domeditaction-spec.litcoffee.html">the tests for the <code>DOMEditAction</code> class</a>, we must still test that this
class manages the stack correctly, so that we can call the <code>undo</code>
and <code>redo</code> member functions of a <code>DOMEditTracker</code> instance
repeatedly and expect them to behave correctly in sequence.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.div = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'div'</span>
            <span class="hljs-built_in">document</span>.body.appendChild div
            <span class="hljs-built_in">window</span>.D = <span class="hljs-keyword">new</span> DOMEditTracker div
</code></pre><p>We expect the div to go through the following four states, so we
create an array of them here.  This will be handy as we repeatedly
undo/redo various actions, and can just compare the state of the
div to various values in this array, using each more than once.</p>
<pre class="hljs"><code>        stateHistory = [
</code></pre><p>The initial state, an empty div:</p>
<pre class="hljs"><code>            tagName : <span class="hljs-string">'DIV'</span>
</code></pre><p>The state after we append a span containing &quot;some text&quot;:</p>
<pre class="hljs"><code>            {
                tagName : <span class="hljs-string">'DIV'</span>
                children : [
                    {
                        tagName : <span class="hljs-string">'SPAN'</span>
                        children : [ <span class="hljs-string">'some text'</span> ]
                    }
                ]
            }
</code></pre><p>The state after we append another text node to the same span:</p>
<pre class="hljs"><code>            {
                tagName : <span class="hljs-string">'DIV'</span>
                children : [
                    {
                        tagName : <span class="hljs-string">'SPAN'</span>
                        children : [ <span class="hljs-string">'some text'</span>,
                                    <span class="hljs-string">'other text'</span> ]
                    }
                ]
            }
</code></pre><p>The state after we normalize, to unite the two adjacent text node
siblings into one:</p>
<pre class="hljs"><code>            {
                tagName : <span class="hljs-string">'DIV'</span>
                children : [
                    {
                        tagName : <span class="hljs-string">'SPAN'</span>
                        children : [ <span class="hljs-string">'some textother text'</span> ]
                    }
                ]
            }
        ]
</code></pre><p>Verify that the current state of the div is empty.  Then store it
for later comparison after undo operations.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ),
            <span class="hljs-string">'toEqual'</span>, stateHistory[<span class="hljs-number">0</span>]
</code></pre><p>Perform three actions, checking the state of the same div after
each one, to be sure we get descriptions of adding a span with some
text in it, adding more text, and normalizing to unite the texts.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.span = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'span'</span>
            span.textContent = <span class="hljs-string">'some text'</span>
            div.appendChild span
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ),
            <span class="hljs-string">'toEqual'</span>, stateHistory[<span class="hljs-number">1</span>]
        pageDo<span class="hljs-function"> -&gt;</span>
            text = <span class="hljs-built_in">document</span>.createTextNode <span class="hljs-string">'other text'</span>
            span.appendChild text
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ),
            <span class="hljs-string">'toEqual'</span>, stateHistory[<span class="hljs-number">2</span>]
        pageDo<span class="hljs-function"> -&gt;</span> div.normalize()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ),
            <span class="hljs-string">'toEqual'</span>, stateHistory[<span class="hljs-number">3</span>]
</code></pre><p>Undo all three actions, checking the state of the same div after
each call to <code>undo</code>.  We ask it to call <code>undo</code> four times, just to
be sure that the fourth one has no effect.  We also check the
stack pointer after each undo, to be sure it&#39;s being decremented.
Note that when the index is zero, we must test to see if it is
false, since the test framework replaces zero and false with null.</p>
<pre class="hljs"><code>        <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> [<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]
            pageDo<span class="hljs-function"> -&gt;</span> D.undo()
            <span class="hljs-keyword">if</span> index &gt; <span class="hljs-number">0</span>
                pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ),
                    <span class="hljs-string">'toEqual'</span>, index
            <span class="hljs-keyword">else</span>
                pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toBeFalsy'</span>
            pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ),
                <span class="hljs-string">'toEqual'</span>, stateHistory[index]
</code></pre><p>Redo all three actions, checking the state of the same div after
each call to <code>redo</code>.  We ask it to call <code>redo</code> four times, just to
be sure that the fourth one has no effect.  We also check the
stack pointer after each redo, to be sure it&#39;s being incremented.</p>
<pre class="hljs"><code>        <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>]
            pageDo<span class="hljs-function"> -&gt;</span> D.redo()
            <span class="hljs-keyword">if</span> index &gt; <span class="hljs-number">0</span>
                pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ),
                    <span class="hljs-string">'toEqual'</span>, index
            <span class="hljs-keyword">else</span>
                pageExpects (<span class="hljs-function"> -&gt;</span> D.stackPointer ), <span class="hljs-string">'toBeFalsy'</span>
            pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ),
                <span class="hljs-string">'toEqual'</span>, stateHistory[index]
</code></pre><h3><a name='supports-edit-blocks'></a>supports edit blocks &nbsp; <font size=-1><a href='test-results.md.html#supports-edit-blocks'>see results</a></font> <font size=-1><a href='#supports-edit-blocks'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>A sequence of successive edit actions can be treated as a block,
and thus grouped into a single, compound edit action on the
undo/redo stack.  Here we test this feature.</p>
<pre class="hljs"><code>    it <span class="hljs-string">'supports edit blocks'</span>, inPage<span class="hljs-function"> -&gt;</span>
        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.div = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'div'</span>
            <span class="hljs-built_in">document</span>.body.appendChild div
            <span class="hljs-built_in">window</span>.D = <span class="hljs-keyword">new</span> DOMEditTracker div
</code></pre><p>We expect the div to go through the following four states, so we
create an array of them here.  This will be handy as we repeatedly
undo/redo various actions, and can just compare the state of the
div to various values in this array, using each more than once.</p>
<pre class="hljs"><code>        stateHistory = [
</code></pre><p>The initial state, with the div empty.</p>
<pre class="hljs"><code>            tagName : <span class="hljs-string">'DIV'</span>
</code></pre><p>The first action we do will be to append a small span.</p>
<pre class="hljs"><code>            {
                tagName : <span class="hljs-string">'DIV'</span>
                children : [
                    {
                        tagName : <span class="hljs-string">'SPAN'</span>
                        children : [ <span class="hljs-string">'small'</span> ]
                    }
                ]
            }
</code></pre><p>Next will be a compound action, walking the div through the
following three states.  It will do so by appending a second
child, removing the first child, then changing an attribute.</p>
<pre class="hljs"><code>            {
                tagName : <span class="hljs-string">'DIV'</span>
                children : [
                    {
                        tagName : <span class="hljs-string">'SPAN'</span>
                        children : [ <span class="hljs-string">'small'</span> ]
                    }
                    tagName : <span class="hljs-string">'HR'</span>
                ]
            }
            {
                tagName : <span class="hljs-string">'DIV'</span>
                children : [ tagName : <span class="hljs-string">'HR'</span> ]
            }
            {
                tagName : <span class="hljs-string">'DIV'</span>
                children : [
                    {
                        tagName : <span class="hljs-string">'HR'</span>
                        attributes : <span class="hljs-string">'ex'</span> : <span class="hljs-string">'ample'</span>
                    }
                ]
            }
</code></pre><p>Finally we will also do another action after the compound action,
inserting a new first child, thus placing the div in the following
final state.</p>
<pre class="hljs"><code>            {
                tagName : <span class="hljs-string">'DIV'</span>
                children : [
                    {
                        tagName : <span class="hljs-string">'P'</span>
                        children : [ <span class="hljs-string">'Lorem ipsum...'</span> ]
                    }
                    {
                        tagName : <span class="hljs-string">'HR'</span>
                        attributes : <span class="hljs-string">'ex'</span> : <span class="hljs-string">'ample'</span>
                    }
                ]
            }
        ]
</code></pre><p>First, verify that the div begins in the expected initial state,
and that the undo/redo stack is empty.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ),
            <span class="hljs-string">'toEqual'</span>, stateHistory[<span class="hljs-number">0</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack.length ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">0</span>
</code></pre><p>Next, perform the first action, which is <em>not</em> part of the sequence
that will be collected into a compound action.  Verify that the
result is as expected from the state history defined above, and
that the undo/redo stack has grown to size 1.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            span = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'span'</span>
            span.textContent = <span class="hljs-string">'small'</span>
            div.appendChild span
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ),
            <span class="hljs-string">'toEqual'</span>, stateHistory[<span class="hljs-number">1</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack.length ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">1</span>
</code></pre><p>Now begin an edit block in the edit tracker; this is the key aspect
of the edit tracker on which this test focuses.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> D.startCompoundAction <span class="hljs-string">'My example action'</span>
</code></pre><p>Now perform each of the three actions that will join to form the
compound action, verifying that although the state changes as we
do them, the undo/redo stack does not (yet) grow.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> div.appendChild <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'hr'</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ),
            <span class="hljs-string">'toEqual'</span>, stateHistory[<span class="hljs-number">2</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack.length ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">1</span>
        pageDo<span class="hljs-function"> -&gt;</span> div.removeChild div.childNodes[<span class="hljs-number">0</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ),
            <span class="hljs-string">'toEqual'</span>, stateHistory[<span class="hljs-number">3</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack.length ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">1</span>
        pageDo<span class="hljs-function"> -&gt;</span> div.childNodes[<span class="hljs-number">0</span>].setAttribute <span class="hljs-string">'ex'</span>, <span class="hljs-string">'ample'</span>
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ),
            <span class="hljs-string">'toEqual'</span>, stateHistory[<span class="hljs-number">4</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack.length ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">1</span>
</code></pre><p>End the edit block in the edit tracker.  Verify that the document
state does not change, but the undo/redo stack finally grows by 1.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> D.endCompoundAction()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ),
            <span class="hljs-string">'toEqual'</span>, stateHistory[<span class="hljs-number">4</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack.length ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">2</span>
</code></pre><p>Finally, perform the final action, also <em>not</em> part of the sequence
just recorded as a compound action.  Verify that the result is as
expected from the state history defined above, and that the
undo/redo stack has grown to size 3.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            p = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'p'</span>
            p.textContent = <span class="hljs-string">'Lorem ipsum...'</span>
            div.insertBefore p, div.childNodes[<span class="hljs-number">0</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ),
            <span class="hljs-string">'toEqual'</span>, stateHistory[<span class="hljs-number">5</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> D.stack.length ), <span class="hljs-string">'toEqual'</span>, <span class="hljs-number">3</span>
</code></pre><p>Undo all three actions, checking the state of the same div after
each call to <code>undo</code>.  We ask it to call <code>undo</code> four times, just to
be sure that the fourth one has no effect.  </p>
<pre class="hljs"><code>        <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> [<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]
            pageDo<span class="hljs-function"> -&gt;</span> D.undo()
            pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ),
                <span class="hljs-string">'toEqual'</span>, stateHistory[index]
</code></pre><p>Redo all three actions, checking the state of the same div after
each call to <code>redo</code>.  We ask it to call <code>redo</code> four times, just to
be sure that the fourth one has no effect.</p>
<pre class="hljs"><code>        <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> [<span class="hljs-number">1</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">5</span>]
            pageDo<span class="hljs-function"> -&gt;</span> D.redo()
            pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ),
                <span class="hljs-string">'toEqual'</span>, stateHistory[index]
</code></pre>
        </div>
        <div id="right">
            <h3 align=center>Navigation</h3><br><h3><a href='index.md.html'>webLurch home</a></h3><p>.</p><ul><li><a href='buildutils.litcoffee.html'>buildutils.litcoffee</a></li><li><a href='cake.litcoffee.html'>cake.litcoffee</a></li></ul><p>./app</p><ul><li><a href='../app/index.html'>index.html</a></li></ul><p>./doc</p><ul><li><a href='plan.md.html'>plan.md</a></li><li><a href='progress.md.html'>progress.md</a></li><li><a href='test-app-help.md.html'>test-app-help.md</a></li><li><a href='test-results.md.html'>test-results.md</a></li></ul><p>./src</p><ul><li><a href='domeditaction.litcoffee.html'>domeditaction.litcoffee</a></li><li><a href='domedittracker.litcoffee.html'>domedittracker.litcoffee</a></li><li><a href='domutils.litcoffee.html'>domutils.litcoffee</a></li><li><a href='lurcheditor.litcoffee.html'>lurcheditor.litcoffee</a></li></ul><p>./test</p><ul><li><a href='all-histories-spec.litcoffee.html'>all-histories-spec.litcoffee</a></li><li><a href='basic-spec.litcoffee.html'>basic-spec.litcoffee</a></li><li><a href='domeditaction-spec.litcoffee.html'>domeditaction-spec.litcoffee</a></li><li><a href='domedittracker-spec.litcoffee.html'>domedittracker-spec.litcoffee</a></li><li><a href='domutils-spec.litcoffee.html'>domutils-spec.litcoffee</a></li><li><a href='lurcheditor-spec.litcoffee.html'>lurcheditor-spec.litcoffee</a></li><li><a href='phantom-utils.litcoffee.html'>phantom-utils.litcoffee</a></li><li><a href='undoredo-spec.litcoffee.html'>undoredo-spec.litcoffee</a></li></ul><p>./testapp</p><ul><li><a href='utils.litcoffee.html'>utils.litcoffee</a></li><li><a href='../testapp/index.html'>index.html</a></li></ul>
        </div>
    </body>
</html>
