<html>
    <head>
        <link rel="stylesheet"
              href="../bootstrap/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="./main.css"/>
        <link rel="stylesheet" href="./obsidian.css"/>
        <link rel="shortcut icon" href="favicon.png"/>
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config( {
              tex2jax: { inlineMath: [ [ '$', '$' ], [ '\\(', '\\)' ] ] }
            } );
        </script>
        <script type="text/javascript"
                src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        </script>
        <title>webLurch docs: plan</title>
    </head>
    <body>
        <div id="left">
            <p align=center>Page contents</p>
<p><a href='#project-plan'>Project Plan</a></p><ul>
<li><a href='#more-word-processing-foundation'>More Word Processing Foundation</a></li><ul>
<li><a href='#editing-actions'>Editing actions</a></li><li><a href='#cursor'>Cursor</a></li><li><a href='#keyboard'>Keyboard</a></li><li><a href='#mouse'>Mouse</a></li><li><a href='#load-and-save'>Load and save</a></li></ul>
<li><a href='#logical-foundation'>Logical Foundation</a></li><ul>
<li><a href='#dependencies'>Dependencies</a></li><li><a href='#math'>Math</a></li><li><a href='#groupers'>Groupers</a></li><li><a href='#background-processing'>Background processing</a></li><li><a href='#background-computation-of-the-property-graph'>Background computation of the property graph</a></li><li><a href='#background-computation-of-bubble-meanings'>Background computation of bubble meanings</a></li><li><a href='#background-validation-probably-in-stages'>Background validation, probably in stages</a></li></ul>
<li><a href='#for-later'>For later</a></li><ul>
<li><a href='#making-unit-tests-more-complete'>Making unit tests more complete</a></li><li><a href='#improving-documentation'>Improving documentation</a></li><li><a href='#citing-sources'>Citing sources</a></li>
        </div>
        <div id="middle">
            <h1><a name='project-plan'></a>Project Plan &nbsp;  <font size=-1><a href='#project-plan'><span class="glyphicon glyphicon-link"></span></a></font></h1><p>Readers unfamiliar with this project may wish to first read what&#39;s
already been accomplished, on the <a href="progress.md.html">Project Progress</a> page.  This page is a complement to that one,
stating what remains to be done.</p>
<p>This document aims to be a complete plan for what needs to be done
on this project, readable by developers.  It can therefore be
viewed as a to-do list in chronological order, the first items
being those that should be done next, and the later items those
that must come after.  Necessarily, the later items are more vague
than the earlier ones.</p>
<h2><a name='more-word-processing-foundation'></a>More Word Processing Foundation &nbsp;  <font size=-1><a href='#more-word-processing-foundation'><span class="glyphicon glyphicon-link"></span></a></font></h2><h3><a name='editing-actions'></a>Editing actions &nbsp;  <font size=-1><a href='#editing-actions'><span class="glyphicon glyphicon-link"></span></a></font></h3><ul>
<li>The creation of the null action testing routine necessitated
the creation of a JSON object comparison utility.  Write unit
tests for that routine.</li>
<li>Whenever a null action is reported to the edit tracker, do not
push it on the stack, and do not notify listeners of a change
in the document.</li>
</ul>
<h3><a name='cursor'></a>Cursor &nbsp;  <font size=-1><a href='#cursor'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>For every item in this section, as it is accomplished, we should
also (of course) create unit tests verifying that it was completed
correctly.</p>
<ul>
<li>Implement the following cursor features in <code>LurchEditor</code>.<ul>
<li>Create a <code>LurchEditor</code> method for lifting the cursor out of
the document, if one exists.  (If one does not exist, it
should call <code>updateCursor</code> to be sure of that, first.)
Normalize the parent after removing it.</li>
<li>Create a <code>LurchEditor</code> method for placing the cursor position
at a given cursor position inside a given node (which
defaults to the zeroth position of the root element of the
editor).  Be sure to remove the cursor before placing it.</li>
<li>Add to <code>LurchEditor</code> instances a timer that flashes the
cursor just as MathQuill does.</li>
<li>Add a CSS class that gives a blue background, for use on the
cursor selection.</li>
<li>Add to the cursor placement routine a parameter for whether
or not to move the anchor as well, defaulting to yes.  If the
anchor does not move, ensure that all leaf nodes between the
old and new cursor positions get the requisite class for
showing the blue background.  If the anchor does move, ensure
that all elements that had that class lose it.  Note that you
can tweak the old version of the routine by not <em>deleting</em>
the old cursor position, but replacing it with a temporary
marker, doing the highlighting, then removing the marker.</li>
<li>Add methods for moving the cursor by a given delta, with or
without moving the anchor (defaults to moving it).</li>
</ul>
</li>
<li>Add all the functions for dealing with that cursor as if it
were a real cursor.  Each of these may make several edits to the
document, and so should use the new block-of-edits support
mentioned above.<ul>
<li>insert text, HTML, or entire object before cursor</li>
<li>replace selection with text, HTML, or entire object</li>
<li>change properties of selection (e.g., font, color)</li>
<li>delete character before/after cursor</li>
<li>delete selection</li>
<li>change properties of paragraph around cursor
(e.g., justification, indentation)</li>
<li>cut, copy, and paste
(See <a href="http://stackoverflow.com/a/11347714/670492">this StackOverflow answer</a> for a possibly
helpful way to put complex content on the clipboard from
JavaScript.)<ul>
<li>implement copy, and then cut is copy-then-delete</li>
<li>implement paste when there is no selection, and then paste
when there is a selection is just delete-then-paste</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a name='keyboard'></a>Keyboard &nbsp;  <font size=-1><a href='#keyboard'><span class="glyphicon glyphicon-link"></span></a></font></h3><ul>
<li>Layer on top of the cursor functions a set of keyboard event
handlers, which call the cursor functions under the hood.
<a href="http://stackoverflow.com/questions/497094/how-do-i-find-out-which-dom-element-has-the-focus">This Stack Overflow question and answer may be useful.</a><ul>
<li>text character = insert text before cursor or replace
selection with text</li>
<li>left/right arrow = move by rel amt +/-1</li>
<li>shift left/right arrow = same but without moving anchor</li>
<li>up, down, home, end, page up, page down = also movement,
but need to be more sophisticated about querying the view
(<a href="http://stackoverflow.com/a/3710561/670492">see if this information helps</a>)</li>
<li>enter = split paragraph into two</li>
<li>backspace = delete character before cursor, or cursor
selection</li>
<li>delete = delete character after cursor, or cursor
selection</li>
<li>Ctrl + B/I/U/L/R/E = apply properties to selection or
paragraph around cursor, as appropriate</li>
<li>Ctrl + X/C/V = cut/copy/paste</li>
</ul>
</li>
<li>In the test app, when the JS eval
input does not have focus (and yet we&#39;re in one of the main
view tabs, not the export-a-test-JSON view) react to
keyboard events by calling the <code>LurchEditor</code>&#39;s appropriate
keyboard API functions.</li>
<li>When the main controller is generating a test record, it
should record the calls it&#39;s sending to that API.
This may require extending the test
runner to also use that same API.</li>
</ul>
<h3><a name='mouse'></a>Mouse &nbsp;  <font size=-1><a href='#mouse'><span class="glyphicon glyphicon-link"></span></a></font></h3><ul>
<li>Should be handled similarly to Up, Home, etc. keys:
Create an API that sits on top of the low-level cursor API
and can accept mouse clicks and drags, translating them into
calls to the low-level API functions.</li>
<li>Connect mouse events in the app and test app to calls to this
new API in <code>LurchEditor</code>.</li>
<li><a href="http://jsfiddle.net/Xotic750/M7mgv/">How to detect on which element inside a large region the
user clicked</a></li>
<li><a href="http://stackoverflow.com/a/3710561/670492">How to find the particular character on which the user
clicked</a></li>
</ul>
<h3><a name='load-and-save'></a>Load and save &nbsp;  <font size=-1><a href='#load-and-save'><span class="glyphicon glyphicon-link"></span></a></font></h3><ul>
<li>Before executing any of the tasks in this section, first look
ahead to the <a href="#dependencies">Dependencies</a> section, below.  It
has requirements that will require you to be careful <em>here</em>
about your design decisions.  Ensure that a sensible design for
loading, saving, sharing, and dependency loading is in place
before proceeding to implement any of the load/save features in
this section.</li>
<li>Research the notion of using Dropbox as a data storage
location; it may impact how you proceed with the other tasks in
this section, below.  Here are some details:<ul>
<li><a href="https://www.dropbox.com/developers/dropins">You can use ready-made open and save dialogs.</a>
This may be the best for us, since it&#39;s minimally invasive
and may handle what we need.  Not sure how it would work with
(a) the settings file or (b) dependencies.</li>
<li><a href="https://www.dropbox.com/developers/datastore">You can store tables that are a JSON-SQL hybrid.</a>
This is quite general, but also comes with increased
complexity over the previous option.  It is not, however,
really that complex.</li>
<li>A bonus on top of the previous bullet point is that
<a href="https://www.dropbox.com/developers/blog/99/using-the-new-local-datastores-feature">recent, bleeding-edge changes in the API</a>
make it possible to use one codebase for both local storage
and Dropbox storage, a very attractive option.</li>
</ul>
</li>
<li>Implement the following needs.<ul>
<li>The main app must be able to load and save documents at least
locally (e.g.,
<a href="http://www.w3schools.com/html/html5_webstorage.asp">Web Storage</a>)
but preferably everywhere (e.g., Dropbox, as described above)</li>
<li>If Dropbox is not used, and thus the user&#39;s files are not
present on their own local machine, provide a way for the
user to load/save files into/out of web storage?</li>
</ul>
</li>
<li>Add the ability to share documents with the world, using
something like <a href="https://www.firebase.com/">Firebase</a>, or making
Dropbox files shared, if the API supports that.</li>
<li>Make there be a way to share files as webpages as well,
read-only pages that contain full meaning information.  This way
instructors can post on their websites (or Lurch can post on its
project web space) core dependencies that anyone can use, and
the integrity of a course (or the whole Lurch project!) is not
dependent on the state of any individual&#39;s Dropbox folder.</li>
</ul>
<h2><a name='logical-foundation'></a>Logical Foundation &nbsp;  <font size=-1><a href='#logical-foundation'><span class="glyphicon glyphicon-link"></span></a></font></h2><h3><a name='dependencies'></a>Dependencies &nbsp;  <font size=-1><a href='#dependencies'><span class="glyphicon glyphicon-link"></span></a></font></h3><ul>
<li>Create a way to give a document a title, author, language,
and version, like we did before.  But perhaps we can drop
language?  Version?</li>
<li>Create a way to find a document in the user&#39;s web storage or
anywhere online (Firebase, web, Dropbox public folder, etc.)
based on its URN.</li>
<li>Cache such files in local/Dropbox storage, so that Lurch is
usable offline.</li>
</ul>
<h3><a name='math'></a>Math &nbsp;  <font size=-1><a href='#math'><span class="glyphicon glyphicon-link"></span></a></font></h3><ul>
<li>Create a button or keystroke that allows you to insert a
<a href="http://mathquill.com/">MathQuill</a> instance in your document,
and stores it as a special kind of content.</li>
<li>Whenever the cursor (the browser&#39;s one, not the model&#39;s one)
is inside a MathQuill instance, frequently recompute the
content of that instance and store it in that content object
in the document.</li>
<li>Make ordinary keyboard motions of the cursor able to enter
and exit MathQuill instances.</li>
<li>Consider whether you can render the MathQuill using
<a href="http://www.mathjax.org/">MathJax</a> when the cursor exits,
to get prettier results.</li>
<li>Consider whether you can add the capability to do
MathJax-rendered LaTeX source, with a popup text box, like
in the Simple Math Editor in the desktop Lurch.</li>
</ul>
<h3><a name='groupers'></a>Groupers &nbsp;  <font size=-1><a href='#groupers'><span class="glyphicon glyphicon-link"></span></a></font></h3><ul>
<li>(throughout all the to-dos in this category, be sure to
create unit tests and verify that the test script can handle
them, to keep all of this honest and solid)</li>
<li>Give <code>LurchEditor</code> the ability to create groupers in pairs
(correctly nested) and if one is deleted its partner is
automatically deleted as well.</li>
<li>Create all the corresponding API, such as querying and
navigating the group hierarchy.</li>
<li>Decide the UI for groups, tags, etc.:
Same as old Lurch?  Something different?  Easier?  Better?</li>
<li>Build the 3 foundational grouper types, although so far all
that&#39;s happening is that the data about the user&#39;s choices
is getting stored in each group, but the groups don&#39;t
compute their meanings, don&#39;t modify one another, nothing
except store a record of the user&#39;s choices for later
computation by background workers.</li>
</ul>
<h3><a name='background-processing'></a>Background processing &nbsp;  <font size=-1><a href='#background-processing'><span class="glyphicon glyphicon-link"></span></a></font></h3><ul>
<li>Create the structure for running computations in the
background.  I think it will work like this:<ul>
<li>Add to the <code>LurchEditor</code> class a list of computations
that must be run on the document before it&#39;s done/stable.
This should be an attribute of the document that gets
preserved across load/save.</li>
<li>Upon each change, the editor will know whether that
change requires any recomputation, and if so, it enqueues
it in that attribute.<ul>
<li>The enqueue function is smart enough to dispatch a
WebWorker to handle anything enqueued, provided that
there are not too many workers already dispatched.</li>
<li>Whenever a worker completes its task, if there are
tasks on the queue, it gets given another.</li>
<li>The result of worker computations will often be just
the first step in a process, and thus will involve
enqueueing yet still more to-dos.  E.g., meaning
recomputation -&gt; revalidation -&gt; revalidation of
later stuff -&gt; etc.</li>
</ul>
</li>
</ul>
</li>
<li>All of the following test-related tools should know to wait
for all background processing to complete before examining
the result of any given action on the document and calling
that the &quot;next state&quot; of the document.  This can be achieved
by <code>LurchEditor</code> providing a function to say whether it&#39;s
still computing stuff or not.<ul>
<li>automated headless test runner</li>
<li>web-based test generator</li>
<li>web-based test replayer</li>
</ul>
</li>
</ul>
<h3><a name='background-computation-of-the-property-graph'></a>Background computation of the property graph &nbsp;  <font size=-1><a href='#background-computation-of-the-property-graph'><span class="glyphicon glyphicon-link"></span></a></font></h3><ul>
<li>more detail needed here later</li>
<li>create unit tests as you go</li>
</ul>
<h3><a name='background-computation-of-bubble-meanings'></a>Background computation of bubble meanings &nbsp;  <font size=-1><a href='#background-computation-of-bubble-meanings'><span class="glyphicon glyphicon-link"></span></a></font></h3><ul>
<li>(yes, that is a huge task that is contingent upon decisions
about parsing, etc., but simple defaults could be put in
place to start, such as a sensible interpretation of
MathQuill content, or simpleLob notation only, or whatever)</li>
<li>create unit tests as you go</li>
</ul>
<h3><a name='background-validation-probably-in-stages'></a>Background validation, probably in stages &nbsp;  <font size=-1><a href='#background-validation-probably-in-stages'><span class="glyphicon glyphicon-link"></span></a></font></h3><ul>
<li>(again, first we should check to see if validation was
redesigned in any important way, including any relevant
theorems proven based on assumptions that you therefore must
guarantee hold in your implementation)</li>
<li>create unit tests as you go</li>
</ul>
<h2><a name='for-later'></a>For later &nbsp;  <font size=-1><a href='#for-later'><span class="glyphicon glyphicon-link"></span></a></font></h2><h3><a name='making-unit-tests-more-complete'></a>Making unit tests more complete &nbsp;  <font size=-1><a href='#making-unit-tests-more-complete'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>The following unit tests were skipped earlier in development,
because they are less important than the ones that were written,
and yet are included here for the sake of completeness, and so that
they are not forgotten.  A complete unit testing suite would have
tests for all of the following cases.</p>
<ul>
<li><a href="domeditaction-spec.litcoffee.html">The tests for the DOMEditAction constructor</a> test every constructor by
passing it correct parameters.  They do not do any testing to
ensure that the constructor throws an error upon receiving
incorrect parameters, except one test that ensures that the
action type is valid.  In particular, no testing is done to
ensure that the node must be valid, nor that for each individual
action type, the parameters must be given correctly.</li>
<li>All the functionality of the test app.  Currently, it is only
tested by the developers&#39; using it, together with some minimal
unit tests <a href="basic-spec.litcoffee.html">in the basic spec file</a>.</li>
</ul>
<p>Someday, when regular, automated testing becomes important, have
a server do a nightly git pull of the latest version.  Once that&#39;s
working, have it run a shell script that does the following.</p>
<ul>
<li>Back up the old HTML version of the test suite output.</li>
<li>Run the test suite.</li>
<li>Email the developers if and only if the new output differs from
the old in an important way (i.e., not just timings, but
results).</li>
</ul>
<h3><a name='improving-documentation'></a>Improving documentation &nbsp;  <font size=-1><a href='#improving-documentation'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>Documentation in most unit test spec files promises that <a href="basic-spec.litcoffee.html">the
basic spec file</a> will provide complete
documentation on how to read and understand a test spec file.  But
it does not.</p>
<ul>
<li>Add documentation to that file so that someone who does not know
how to read a test spec file could learn it from that file.</li>
</ul>
<h3><a name='citing-sources'></a>Citing sources &nbsp;  <font size=-1><a href='#citing-sources'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>The glyph icons that come with Bootstrap were provided free by
<a href="http://glyphicons.com/">Glyphicons</a>.  Bootstrap requests that if
you use them, you provide a link back to that site.  When my apps
are further along in production, such a link should be provided
somewhere on the site where it makes sense to do so.</p>

        </div>
        <div id="right">
            <h3 align=center>Navigation</h3><br><h3><a href='index.md.html'>webLurch home</a></h3><p>.</p><ul><li><a href='buildutils.litcoffee.html'>buildutils.litcoffee</a></li><li><a href='cake.litcoffee.html'>cake.litcoffee</a></li></ul><p>./app</p><ul><li><a href='../app/index.html'>index.html</a></li></ul><p>./doc</p><ul><li><a href='overview.md.html'>overview.md</a></li><li><a href='plan.md.html'>plan.md</a></li><li><a href='progress.md.html'>progress.md</a></li><li><a href='test-app-help.md.html'>test-app-help.md</a></li><li><a href='test-results.md.html'>test-results.md</a></li></ul><p>./src</p><ul><li><a href='domeditaction.litcoffee.html'>domeditaction.litcoffee</a></li><li><a href='domedittracker.litcoffee.html'>domedittracker.litcoffee</a></li><li><a href='domutils.litcoffee.html'>domutils.litcoffee</a></li><li><a href='lurcheditor.litcoffee.html'>lurcheditor.litcoffee</a></li><li><a href='utils.litcoffee.html'>utils.litcoffee</a></li></ul><p>./test</p><ul><li><a href='all-histories-spec.litcoffee.html'>all-histories-spec.litcoffee</a></li><li><a href='basic-spec.litcoffee.html'>basic-spec.litcoffee</a></li><li><a href='domeditaction-spec.litcoffee.html'>domeditaction-spec.litcoffee</a></li><li><a href='domedittracker-spec.litcoffee.html'>domedittracker-spec.litcoffee</a></li><li><a href='domutils-spec.litcoffee.html'>domutils-spec.litcoffee</a></li><li><a href='lurcheditor-spec.litcoffee.html'>lurcheditor-spec.litcoffee</a></li><li><a href='phantom-utils.litcoffee.html'>phantom-utils.litcoffee</a></li><li><a href='undoredo-spec.litcoffee.html'>undoredo-spec.litcoffee</a></li></ul><p>./testapp</p><ul><li><a href='utils.litcoffee.html'>utils.litcoffee</a></li><li><a href='../testapp/index.html'>index.html</a></li></ul>
        </div>
    </body>
</html>
