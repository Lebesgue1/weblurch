<html>
    <head>
        <link rel="stylesheet"
              href="../bootstrap/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="./main.css"/>
        <link rel="stylesheet" href="./obsidian.css"/>
        <link rel="shortcut icon" href="favicon.png"/>
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config( {
              tex2jax: { inlineMath: [ [ '$', '$' ], [ '\\(', '\\)' ] ] }
            } );
        </script>
        <script type="text/javascript"
                src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        </script>
        <title>webLurch docs: cake</title>
    </head>
    <body>
        <div id="left">
            <p align=center>Page contents</p>
<p><a href='#build-process-definitions'>Build process definitions</a></p><ul>
<li><a href='#easy-way-to-build-all'>Easy way to build all</a></li><li><a href='#requirements'>Requirements</a></li><li><a href='#constants'>Constants</a></li><li><a href='#the-code-app-code-build-process'>The <code>app</code> build process</a></li><li><a href='#the-code-testapp-code-build-process'>The <code>testapp</code> build process</a></li><li><a href='#the-code-doc-code-build-process'>The <code>doc</code> build process</a></li><li><a href='#the-code-test-code-build-process'>The <code>test</code> build process</a></li><li><a href='#the-code-pages-code-build-process'>The <code>pages</code> build process</a></li>
        </div>
        <div id="middle">
            <h1><a name='build-process-definitions'></a>Build process definitions &nbsp;  <font size=-1><a href='#build-process-definitions'><span class="glyphicon glyphicon-link"></span></a></font></h1><p>This file defines the build processes in this repository.
It is imported by the <code>Cakefile</code> in this repository,
the source code of which is kept to a one-liner,
so that most of the repository can be written
in <a href="http://coffeescript.org/#literate">the literate variant of CoffeeScript</a>.</p>
<p>We keep a set of build utilities in a separate module, which we
now load.</p>
<pre class="hljs"><code>build = <span class="hljs-built_in">require</span> <span class="hljs-string">'./buildutils'</span>
</code></pre><h2><a name='easy-way-to-build-all'></a>Easy way to build all &nbsp;  <font size=-1><a href='#easy-way-to-build-all'><span class="glyphicon glyphicon-link"></span></a></font></h2><p>If you want to build and test evertything, just run <code>cake all</code>.
It simply invokes all the other tasks, defined below.</p>
<pre class="hljs"><code>build.task <span class="hljs-string">'all'</span>, <span class="hljs-string">'Build app, testapp, docs, and run tests'</span>,<span class="hljs-function"> -&gt;</span>
    build.enqueue <span class="hljs-string">'app'</span>, <span class="hljs-string">'testapp'</span>, <span class="hljs-string">'test'</span>, <span class="hljs-string">'doc'</span>
</code></pre><h2><a name='requirements'></a>Requirements &nbsp;  <font size=-1><a href='#requirements'><span class="glyphicon glyphicon-link"></span></a></font></h2><p>Verify that <code>npm install</code> has been run in this folder, then import
other modules we&#39;ll need later (which were installed by npm
install).</p>
<pre class="hljs"><code>build.verifyPackagesInstalled()
{ parseString } = <span class="hljs-built_in">require</span> <span class="hljs-string">'xml2js'</span>
fs = <span class="hljs-built_in">require</span> <span class="hljs-string">'fs'</span>
exec = <span class="hljs-built_in">require</span>( <span class="hljs-string">'child_process'</span> ).exec
</code></pre><h2><a name='constants'></a>Constants &nbsp;  <font size=-1><a href='#constants'><span class="glyphicon glyphicon-link"></span></a></font></h2><p>These constants define how the functions below perform.</p>
<pre class="hljs"><code>title = <span class="hljs-string">'webLurch'</span>
srcdir = <span class="hljs-string">'./src/'</span>
appdir = <span class="hljs-string">'./app/'</span>
tappdir = <span class="hljs-string">'./testapp/'</span>
srcout = <span class="hljs-string">'weblurch.litcoffee'</span>
appout = <span class="hljs-string">'app.litcoffee'</span>
tappout = <span class="hljs-string">'testapp.litcoffee'</span>
docdir = <span class="hljs-string">'./doc/'</span>
doctmp = <span class="hljs-string">'template.html'</span>
testdir = <span class="hljs-string">'./test/'</span>
repdir = <span class="hljs-string">'./reports/'</span>
mapfile = <span class="hljs-string">'./reports/unit-test-names.json'</span>
mainpg = <span class="hljs-string">'index.md'</span>
</code></pre><h2><a name='the-code-app-code-build-process'></a>The <code>app</code> build process &nbsp;  <font size=-1><a href='#the-code-app-code-build-process'><span class="glyphicon glyphicon-link"></span></a></font></h2><pre class="hljs"><code>build.asyncTask <span class="hljs-string">'app'</span>, <span class="hljs-string">'Build the main app'</span>, <span class="hljs-function"><span class="hljs-params">( done )</span> -&gt;</span>
</code></pre><p>Before building the app, ensure that the output folder exists.</p>
<pre class="hljs"><code>    fs.mkdirSync appdir <span class="hljs-keyword">unless</span> fs.existsSync appdir
</code></pre><p>Next concatenate all <code>.litcoffee</code> source files into one.</p>
<pre class="hljs"><code>    all = ( fs.readFileSync name <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> \
        build.dir srcdir, <span class="hljs-regexp">/\.litcoffee$/</span> )
    fs.writeFileSync appdir+srcout, all.join( <span class="hljs-string">'\n\n'</span> ), <span class="hljs-string">'utf8'</span>
</code></pre><p>Also compile any files specific to the main app (as opposed to the
test app), which will sit in the app folder rather than the source
folder.</p>
<pre class="hljs"><code>    all = ( fs.readFileSync name <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> \
        build.dir( appdir, <span class="hljs-regexp">/\.litcoffee$/</span> ) \
        <span class="hljs-keyword">when</span> name.indexOf( srcout ) <span class="hljs-keyword">is</span> -<span class="hljs-number">1</span> <span class="hljs-keyword">and</span>
             name.indexOf( appout ) <span class="hljs-keyword">is</span> -<span class="hljs-number">1</span> )
    fs.writeFileSync appdir+appout, all.join( <span class="hljs-string">'\n\n'</span> ), <span class="hljs-string">'utf8'</span>
</code></pre><p>Run the compile process defined in
<a href="buildutils.litcoffee.html">the build utilities module</a>.
This compiles, minifies, and generates source maps.</p>
<pre class="hljs"><code>    build.compile appdir+srcout,<span class="hljs-function"> -&gt;</span>
    build.compile appdir+appout, done
</code></pre><h2><a name='the-code-testapp-code-build-process'></a>The <code>testapp</code> build process &nbsp;  <font size=-1><a href='#the-code-testapp-code-build-process'><span class="glyphicon glyphicon-link"></span></a></font></h2><p>This build process is nearly identical to that of <code>app</code>.</p>
<pre class="hljs"><code>build.asyncTask <span class="hljs-string">'testapp'</span>, <span class="hljs-string">'Build the testapp'</span>, <span class="hljs-function"><span class="hljs-params">( done )</span> -&gt;</span>
</code></pre><p>Before building, ensure that the output folder exists.</p>
<pre class="hljs"><code>    fs.mkdirSync tappdir <span class="hljs-keyword">unless</span> fs.existsSync tappdir
</code></pre><p>Next concatenate all <code>.litcoffee</code> source files from the test app
directory into one.</p>
<pre class="hljs"><code>    all = ( fs.readFileSync name <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> \
        build.dir tappdir, <span class="hljs-regexp">/\.litcoffee$/</span> \
        <span class="hljs-keyword">when</span> name.indexOf( tappout ) <span class="hljs-keyword">is</span> -<span class="hljs-number">1</span> )
    fs.writeFileSync tappdir+tappout, all.join( <span class="hljs-string">'\n\n'</span> ),
        <span class="hljs-string">'utf8'</span>
</code></pre><p>Run the compile process defined in
<a href="buildutils.litcoffee.html">the build utilities module</a>.
This compiles, minifies, and generates source maps.</p>
<pre class="hljs"><code>    build.compile tappdir+tappout, done
</code></pre><h2><a name='the-code-doc-code-build-process'></a>The <code>doc</code> build process &nbsp;  <font size=-1><a href='#the-code-doc-code-build-process'><span class="glyphicon glyphicon-link"></span></a></font></h2><pre class="hljs"><code>build.task <span class="hljs-string">'doc'</span>, <span class="hljs-string">'Build the documentation'</span>,<span class="hljs-function"> -&gt;</span>
</code></pre><p>Fetch all files in the source directory, plus this file,
plus any <code>.md</code> files in the <code>doc/</code> dir that need converting,
and the template HTML output file from the <code>doc/</code> directory.</p>
<pre class="hljs"><code>    all = ( f <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> build.dir( <span class="hljs-string">'.'</span>, <span class="hljs-regexp">/\.litcoffee$/</span>,
                                  srcdir, <span class="hljs-regexp">/\.litcoffee$/</span>,
                                  testdir, <span class="hljs-regexp">/\.litcoffee$/</span>,
                                  docdir, <span class="hljs-regexp">/\.md$/</span>,
                                  tappdir, <span class="hljs-regexp">/\.litcoffee$/</span> ) \
        <span class="hljs-keyword">when</span> f.indexOf( tappout ) <span class="hljs-keyword">is</span> -<span class="hljs-number">1</span> )
    html = fs.readFileSync docdir + doctmp, <span class="hljs-string">'utf8'</span>
</code></pre><p>Build a file navigation list from those files&#39; names.</p>
<pre class="hljs"><code>    nav = {}
    navtxt = <span class="hljs-string">'&lt;h3 align=center&gt;Navigation&lt;/h3&gt;&lt;br&gt;'</span>
    <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> all
        end = ( path = file.split <span class="hljs-string">'/'</span> ).pop()
        <span class="hljs-keyword">if</span> end <span class="hljs-keyword">is</span> mainpg
            navtxt += <span class="hljs-string">"&lt;h3&gt;&lt;a href='<span class="hljs-subst">#{mainpg}</span>.html'&gt;"</span> +
                      <span class="hljs-string">"<span class="hljs-subst">#{title}</span> home&lt;/a&gt;&lt;/h3&gt;"</span>
        <span class="hljs-keyword">else</span>
            ( nav[path.join <span class="hljs-string">'/'</span>] ?= [] ).push {
                file : end, text : end }
    ( nav[appdir[...-<span class="hljs-number">1</span>]] ?= [] ).push {
        file : <span class="hljs-string">".<span class="hljs-subst">#{appdir}</span>index"</span>, text : <span class="hljs-string">'index.html'</span> }
    ( nav[tappdir[...-<span class="hljs-number">1</span>]] ?= [] ).push {
        file : <span class="hljs-string">".<span class="hljs-subst">#{tappdir}</span>index"</span>, text : <span class="hljs-string">'index.html'</span> }
    <span class="hljs-keyword">for</span> path <span class="hljs-keyword">in</span> ( Object.keys nav ).sort()
        navtxt += <span class="hljs-string">"&lt;p&gt;<span class="hljs-subst">#{path || <span class="hljs-string">'./'</span>}</span>&lt;/p&gt;&lt;ul&gt;"</span>
        <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> nav[path]
            navtxt += <span class="hljs-string">"&lt;li&gt;&lt;a href='<span class="hljs-subst">#{e.file}</span>.html'&gt;"</span> +
                      <span class="hljs-string">"<span class="hljs-subst">#{e.text}</span>&lt;/a&gt;&lt;/li&gt;"</span>
        navtxt += <span class="hljs-string">'&lt;/ul&gt;'</span>
</code></pre><p>Read each source file and place its marked-down version into the
HTML template, saving it into the docs directory.  The marking-down
process also generates a table of contents (TOC) for the page,
which we put in the left frame.</p>
<pre class="hljs"><code>    <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> all
        end = file.split( <span class="hljs-string">'/'</span> ).pop()
        beginning = end.split( <span class="hljs-string">'.'</span> ).shift()
        <span class="hljs-built_in">console</span>.log <span class="hljs-string">"\tCreating <span class="hljs-subst">#{end}</span>.html..."</span>
        rendered = build.md2html file
        toc = <span class="hljs-string">"""&lt;p align=center&gt;Page contents&lt;/p&gt;
                 <span class="hljs-subst">#{rendered.toc}</span>"""</span>
        myhtml = html.replace( <span class="hljs-string">'LEFT'</span>, toc )
                     .replace( <span class="hljs-string">'RIGHT'</span>, navtxt )
                     .replace( <span class="hljs-string">'MIDDLE'</span>, rendered.html )
                     .replace( <span class="hljs-regexp">/&lt;pre&gt;&lt;code&gt;/g</span>,
                               <span class="hljs-string">'&lt;pre class="hljs"&gt;&lt;code&gt;'</span> )
                     .replace( <span class="hljs-string">'TITLE'</span>,
                               <span class="hljs-string">"<span class="hljs-subst">#{title}</span> docs: <span class="hljs-subst">#{beginning}</span>"</span> )
        fs.writeFileSync <span class="hljs-string">"<span class="hljs-subst">#{docdir+end}</span>.html"</span>, myhtml, <span class="hljs-string">'utf8'</span>
</code></pre><h2><a name='the-code-test-code-build-process'></a>The <code>test</code> build process &nbsp;  <font size=-1><a href='#the-code-test-code-build-process'><span class="glyphicon glyphicon-link"></span></a></font></h2><pre class="hljs"><code>build.asyncTask <span class="hljs-string">'test'</span>, <span class="hljs-string">'Run all unit tests'</span>, <span class="hljs-function"><span class="hljs-params">( done )</span> -&gt;</span>
</code></pre><p>First remove all old reports in the test reports folder.
If we do not do this, then any deleted tests will still have their
reports lingering in the output folder forever.</p>
<pre class="hljs"><code>    fs.mkdirSync repdir <span class="hljs-keyword">unless</span> fs.existsSync repdir
    <span class="hljs-keyword">for</span> report <span class="hljs-keyword">in</span> fs.readdirSync repdir
        fs.unlinkSync repdir + report
</code></pre><p>Run <a href="http://jasmine.github.io/">jasmine</a> on all files in the
<code>test/</code> folder, and produce output in <code>junitreport</code> format (a
bunch of XML files).</p>
<pre class="hljs"><code>    exec <span class="hljs-string">"node node_modules/jasmine-node/lib/jasmine-node/"</span> +
         <span class="hljs-string">"cli.js --junitreport --verbose --coffee "</span> +
         <span class="hljs-string">"--forceexit <span class="hljs-subst">#{testdir}</span>"</span>,
    <span class="hljs-function"><span class="hljs-params">( err, stdout, stderr )</span> -&gt;</span>
        <span class="hljs-built_in">console</span>.log stdout + stderr <span class="hljs-keyword">if</span> stdout + stderr
</code></pre><p>Now that the tests have been run, see if they created a file
mapping the unit test names to the files in which they are defined.
If so, we will use it below to create links from test results to
test definition files.</p>
<pre class="hljs"><code>        <span class="hljs-keyword">try</span>
            mapping = JSON.parse fs.readFileSync mapfile
        <span class="hljs-keyword">catch</span> error
            mapping = <span class="hljs-literal">null</span>
</code></pre><p>Create the header for the test output page and two functions for
flagging test passes/failures with the appropriate CSS classes.</p>
<pre class="hljs"><code>        md = <span class="hljs-string">'''
             # Autogenerated test results

             This file was autogenerated by the build system.


             '''</span>
        pass = <span class="hljs-string">'&lt;span class="test-pass"&gt;Pass&lt;/span&gt;'</span>
        re = <span class="hljs-regexp">/^([0-9]+): Expected (.*) to equal (.*)\.$/</span>
        <span class="hljs-function"><span class="hljs-title">fail</span> = <span class="hljs-params">( x )</span> -&gt;</span>
</code></pre><p>The following if/try block is a simple attempt at formatting object
code nicer.  It will not work in all situations, but it is nice for
those situations in which it does work.  The difficult-to-read
output that comes to the console will appear much more nicely in
the web output, and the developer can look there to help compare
the unmatched objects.</p>
<pre class="hljs"><code>            <span class="hljs-keyword">if</span> m = re.exec x
                <span class="hljs-keyword">try</span>
                    obj1 = JSON.parse m[<span class="hljs-number">2</span>] \
                        .replace( <span class="hljs-regexp">/'/g</span>, <span class="hljs-string">'"'</span> ) \
                        .replace( <span class="hljs-regexp">/([{,])\s*(\w+)\s*:/g</span>,
                            <span class="hljs-string">'$1 "$2" :'</span> )
                    obj2 = JSON.parse m[<span class="hljs-number">3</span>] \
                        .replace( <span class="hljs-regexp">/'/g</span>, <span class="hljs-string">'"'</span> ) \
                        .replace( <span class="hljs-regexp">/([{,])\s*(\w+)\s*:/g</span>,
                            <span class="hljs-string">'$1 "$2" :'</span> )
                    x = <span class="hljs-string">"<span class="hljs-subst">#{m[<span class="hljs-number">1</span>]}</span>: Expected these to be equal:
                        &lt;br&gt;
                        &lt;table width=100% cellspacing=0
                               cellpadding=0&gt;
                        &lt;tr&gt;&lt;td&gt;
                        Actual:
                        \n
                        \n```
                        \n<span class="hljs-subst">#{JSON.stringify obj1, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>}</span>
                        \n```
                        \n
                        \n&lt;/td&gt;&lt;td&gt;
                        Expected:
                        \n
                        \n```
                        \n<span class="hljs-subst">#{JSON.stringify obj2, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>}</span>
                        \n```
                        \n&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;"</span>
            <span class="hljs-string">"&lt;span class='test-fail'&gt;Failure <span class="hljs-subst">#{x}</span>&lt;/span&gt;"</span>
</code></pre><p>Read those XML files and produce <a href="markdown">Markdown</a> output,
all together into a single output file.</p>
<pre class="hljs"><code>        <span class="hljs-keyword">for</span> report <span class="hljs-keyword">in</span> build.dir repdir, <span class="hljs-regexp">/\.xml$/i</span>
            parseString fs.readFileSync( report ),
            <span class="hljs-function"><span class="hljs-params">( err, result )</span> -&gt;</span>
                <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> result.testsuites.testsuite
</code></pre><p>Create header for this test.  Use the <code>mapping</code> computed above to
create links, if possible.</p>
<pre class="hljs"><code>                    name = item.$.name
                    md += <span class="hljs-string">"## <span class="hljs-subst">#{name}</span> (<span class="hljs-subst">#{item.$.time}</span> ms)"</span>
                    <span class="hljs-keyword">if</span> name <span class="hljs-keyword">of</span> mapping
                        escapedName = build.escapeHeading name
                        md += <span class="hljs-string">" &lt;font size=-1&gt;"</span> +
                              <span class="hljs-string">"&lt;a href='<span class="hljs-subst">#{mapping[name]}</span>"</span> +
                              <span class="hljs-string">".html#<span class="hljs-subst">#{escapedName}</span>'&gt;"</span> +
                              <span class="hljs-string">"see source&lt;/a&gt;&lt;/font&gt;"</span>
                    md += <span class="hljs-string">'\n\n'</span>
</code></pre><p>Create subheader for each case in the test.  Again, use the
<code>mapping</code> computed above to create links, if possible.</p>
<pre class="hljs"><code>                    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> item.testcase
                        cn = c.$.name
                        md += <span class="hljs-string">"### <span class="hljs-subst">#{cn}</span> (<span class="hljs-subst">#{c.$.time}</span> ms)"</span>
                        <span class="hljs-keyword">if</span> item.$.name <span class="hljs-keyword">of</span> mapping
                            esc = build.escapeHeading c.$.name
                            md += <span class="hljs-string">" &lt;font size=-1&gt;"</span> +
                                  <span class="hljs-string">"&lt;a href='"</span> +
                                  <span class="hljs-string">"<span class="hljs-subst">#{mapping[item.$.name]}</span>."</span> +
                                  <span class="hljs-string">"html#<span class="hljs-subst">#{esc}</span>'&gt;see source"</span> +
                                  <span class="hljs-string">"&lt;/a&gt;&lt;/font&gt;"</span>
                        md += <span class="hljs-string">'\n\n'</span>
</code></pre><p>Create list item for each failure, or one single item reporting
a pass if there were no failures.</p>
<pre class="hljs"><code>                        <span class="hljs-keyword">if</span> c.failure
                            <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> c.failure
                                md += <span class="hljs-string">" * <span class="hljs-subst">#{fail f}</span>\n\n"</span>
                        <span class="hljs-keyword">else</span>
                            md += <span class="hljs-string">" * <span class="hljs-subst">#{pass}</span>\n\n"</span>
</code></pre><p>Create a footer for this test, summarizing its time and totals.</p>
<pre class="hljs"><code>                    md += <span class="hljs-string">"Above tests run at "</span> +
                          <span class="hljs-string">"<span class="hljs-subst">#{item.$.timestamp}</span>.  "</span> +
                          <span class="hljs-string">"Tests: <span class="hljs-subst">#{item.$.tests}</span> - "</span> +
                          <span class="hljs-string">"Errors: <span class="hljs-subst">#{item.$.errors}</span> - "</span> +
                          <span class="hljs-string">"Failures: <span class="hljs-subst">#{item.$.failures}</span>\n\n"</span>
</code></pre><p>That output file goes in the <code>doc/</code> folder for later processing
by the doc task, defined above.</p>
<pre class="hljs"><code>        fs.writeFileSync <span class="hljs-string">"<span class="hljs-subst">#{docdir}</span>/test-results.md"</span>,
            md, <span class="hljs-string">'utf8'</span>
        done()
</code></pre><h2><a name='the-code-pages-code-build-process'></a>The <code>pages</code> build process &nbsp;  <font size=-1><a href='#the-code-pages-code-build-process'><span class="glyphicon glyphicon-link"></span></a></font></h2><p>After changes are made to the master branch of this repository in
git, we eventually want to propagate them to the gh-pages branch,
because that branch is the one that github uses as the basis for
the project web pages (hence the name, short for &quot;github pages&quot;).
Usually you should do this before pushing commits to github, so
that the website on github reflects the latest state of the
repository.</p>
<p>This build task switches to the gh-pages branch, merges in all
changes from master, re-runs all other build tasks, commits the
resulting documentation changes, and switches branches back to
master.  It&#39;s just what you should run before pushing to github.</p>
<p>It&#39;s an asynchronous task because it uses <code>exec</code>.  We begin with
switching to gh-pages and merging in changes.</p>
<pre class="hljs"><code>build.asyncTask <span class="hljs-string">'pages'</span>,
<span class="hljs-string">'Update gh-pages branch before pushing'</span>, <span class="hljs-function"><span class="hljs-params">( done )</span> -&gt;</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">'''
        In case any step of this lengthy process goes wrong, 
        here are the commands that are about to be run, so
        that you can complete the process:
            git checkout gh-pages
            git merge master
            cake all
            git add doc/*.html
            git commit -a -m 'Updating gh-pages with latest generated docs'
            git checkout master

        Beginning...
        Switching to gh-pages branch...
        '''</span>
    exec <span class="hljs-string">'git checkout gh-pages'</span>, <span class="hljs-function"><span class="hljs-params">( err, stdout, stderr )</span> -&gt;</span>
        <span class="hljs-built_in">console</span>.log stdout + stderr <span class="hljs-keyword">if</span> stdout + stderr
        <span class="hljs-keyword">if</span> err <span class="hljs-keyword">then</span> <span class="hljs-keyword">throw</span> err
        <span class="hljs-built_in">console</span>.log <span class="hljs-string">'Merging in changes...'</span>
        exec <span class="hljs-string">'git merge master'</span>, <span class="hljs-function"><span class="hljs-params">( err, stdout, stderr )</span> -&gt;</span>
            <span class="hljs-built_in">console</span>.log stdout + stderr <span class="hljs-keyword">if</span> stdout + stderr
            <span class="hljs-keyword">if</span> err <span class="hljs-keyword">then</span> <span class="hljs-keyword">throw</span> err
</code></pre><p>Now we enqueue all the other build tasks that need to be done to
update the documentation so that we can then commit the changes to
this branch.  The final thing we enqueue is a function that the
build process will call once it&#39;s run all the other build tasks in
the queue.</p>
<pre class="hljs"><code>            <span class="hljs-built_in">console</span>.log <span class="hljs-string">'Building all in gh-pages...'</span>
            build.enqueue <span class="hljs-string">'app'</span>, <span class="hljs-string">'testapp'</span>, <span class="hljs-string">'test'</span>, <span class="hljs-string">'doc'</span>,<span class="hljs-function"> -&gt;</span>
</code></pre><p>This function commits the changes done by the other steps in the
build process, then switches back to the master branch and reports
completion to the user.</p>
<pre class="hljs"><code>                exec <span class="hljs-string">'git add doc/*.html'</span>,
                <span class="hljs-function"><span class="hljs-params">( err, stdout, stderr )</span> -&gt;</span>
                    <span class="hljs-keyword">if</span> stdout + stderr
                        <span class="hljs-built_in">console</span>.log stdout + stderr
                    <span class="hljs-keyword">if</span> err <span class="hljs-keyword">then</span> <span class="hljs-keyword">throw</span> err
                    exec <span class="hljs-string">"git commit -a -m 'Updating gh-"</span> +
                         <span class="hljs-string">"pages with latest generated docs'"</span>,
                    <span class="hljs-function"><span class="hljs-params">( err, stdout, stderr )</span> -&gt;</span>
                        <span class="hljs-keyword">if</span> stdout + stderr
                            <span class="hljs-built_in">console</span>.log stdout + stderr
                        <span class="hljs-keyword">if</span> err <span class="hljs-keyword">then</span> <span class="hljs-keyword">throw</span> err
                        <span class="hljs-built_in">console</span>.log <span class="hljs-string">'Going back to master...'</span>
                        exec <span class="hljs-string">'git checkout master'</span>,
                        <span class="hljs-function"><span class="hljs-params">( err, stdout, stderr )</span> -&gt;</span>
                            <span class="hljs-keyword">if</span> stdout + stderr
                                <span class="hljs-built_in">console</span>.log stdout + stderr
                            <span class="hljs-keyword">if</span> err <span class="hljs-keyword">then</span> <span class="hljs-keyword">throw</span> err
                            <span class="hljs-built_in">console</span>.log <span class="hljs-string">'''
                            Done.

                            If you're happy with the results \
                            of this process, just type \
                            "git push" to publish them.
                            '''</span>
</code></pre><p>We report that we&#39;re done with this task once we enqueue all those
things, so that the build system will then start processing what
we put on the queue.</p>
<pre class="hljs"><code>            done()
</code></pre>
        </div>
        <div id="right">
            <h3 align=center>Navigation</h3><br><h3><a href='index.md.html'>webLurch home</a></h3><p>.</p><ul><li><a href='buildutils.litcoffee.html'>buildutils.litcoffee</a></li><li><a href='cake.litcoffee.html'>cake.litcoffee</a></li></ul><p>./app</p><ul><li><a href='../app/index.html'>index.html</a></li></ul><p>./doc</p><ul><li><a href='overview.md.html'>overview.md</a></li><li><a href='plan.md.html'>plan.md</a></li><li><a href='progress.md.html'>progress.md</a></li><li><a href='test-app-help.md.html'>test-app-help.md</a></li><li><a href='test-results.md.html'>test-results.md</a></li></ul><p>./src</p><ul><li><a href='domeditaction.litcoffee.html'>domeditaction.litcoffee</a></li><li><a href='domedittracker.litcoffee.html'>domedittracker.litcoffee</a></li><li><a href='domutils.litcoffee.html'>domutils.litcoffee</a></li><li><a href='lurcheditor.litcoffee.html'>lurcheditor.litcoffee</a></li><li><a href='utils.litcoffee.html'>utils.litcoffee</a></li></ul><p>./test</p><ul><li><a href='all-histories-spec.litcoffee.html'>all-histories-spec.litcoffee</a></li><li><a href='basic-spec.litcoffee.html'>basic-spec.litcoffee</a></li><li><a href='domeditaction-spec.litcoffee.html'>domeditaction-spec.litcoffee</a></li><li><a href='domedittracker-spec.litcoffee.html'>domedittracker-spec.litcoffee</a></li><li><a href='domutils-spec.litcoffee.html'>domutils-spec.litcoffee</a></li><li><a href='lurcheditor-spec.litcoffee.html'>lurcheditor-spec.litcoffee</a></li><li><a href='phantom-utils.litcoffee.html'>phantom-utils.litcoffee</a></li><li><a href='undoredo-spec.litcoffee.html'>undoredo-spec.litcoffee</a></li><li><a href='utils-spec.litcoffee.html'>utils-spec.litcoffee</a></li></ul><p>./testapp</p><ul><li><a href='utils.litcoffee.html'>utils.litcoffee</a></li><li><a href='../testapp/index.html'>index.html</a></li></ul>
        </div>
    </body>
</html>
