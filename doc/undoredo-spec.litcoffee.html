<html>
    <head>
        <link rel="stylesheet"
              href="../bootstrap/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="./main.css"/>
        <link rel="stylesheet" href="./obsidian.css"/>
        <link rel="shortcut icon" href="favicon.png"/>
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config( {
              tex2jax: { inlineMath: [ [ '$', '$' ], [ '\\(', '\\)' ] ] }
            } );
        </script>
        <script type="text/javascript"
                src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        </script>
        <title>webLurch docs: undoredo-spec</title>
    </head>
    <body>
        <div id="left">
            <p align=center>Page contents</p>
<p><a href='#tests-for-the-undo-redo-features-of-code-domeditaction-code-s'>Tests for the undo/redo features of <code>DOMEditAction</code>s</a></p><ul>
<li><a href='#undo-and-redo'>Undo and redo</a></li><ul>
<li><a href='#should-work-for-appendchild-actions'>should work for &quot;appendChild&quot; actions</a></li><li><a href='#should-work-for-insertbefore-actions'>should work for &quot;insertBefore&quot; actions</a></li><li><a href='#should-work-for-normalize-actions'>should work for &quot;normalize&quot; actions</a></li><li><a href='#should-work-for-removeattribute-actions'>should work for &quot;removeAttribute&quot; actions</a></li><li><a href='#should-work-for-removeattributenode-actions'>should work for &quot;removeAttributeNode&quot; actions</a></li><li><a href='#should-work-for-removechild-actions'>should work for &quot;removeChild&quot; actions</a></li><li><a href='#should-work-for-replacechild-actions'>should work for &quot;replaceChild&quot; actions</a></li><li><a href='#should-work-for-setattribute-actions'>should work for &quot;setAttribute&quot; actions</a></li><li><a href='#should-work-for-setattributenode-actions'>should work for &quot;setAttributeNode&quot; actions</a></li><li><a href='#should-work-for-compound-actions'>should work for &quot;compound&quot; actions</a></li>
        </div>
        <div id="middle">
            <h1><a name='tests-for-the-undo-redo-features-of-code-domeditaction-code-s'></a>Tests for the undo/redo features of <code>DOMEditAction</code>s &nbsp;  <font size=-1><a href='#tests-for-the-undo-redo-features-of-code-domeditaction-code-s'><span class="glyphicon glyphicon-link"></span></a></font></h1><p>Pull in the utility functions in
<a href="phantom-utils.litcoffee.html">phantom-utils</a> that make it
easier to write the tests below.  Then follow the same structure
for setting up tests as documented more thoroughly in
<a href="basic-spec.litcoffee.html">the basic unit test</a>.</p>
<pre class="hljs"><code>{ phantomDescribe, pageDo, pageExpects,
  pageExpectsError, inPage } = <span class="hljs-built_in">require</span> <span class="hljs-string">'./phantom-utils'</span>
</code></pre><h2><a name='undo-and-redo'></a>Undo and redo &nbsp; <font size=-1><a href='test-results.md.html#undo-and-redo'>see results</a></font> <font size=-1><a href='#undo-and-redo'><span class="glyphicon glyphicon-link"></span></a></font></h2><pre class="hljs"><code>phantomDescribe <span class="hljs-string">'Undo and redo'</span>, <span class="hljs-string">'./app/index.html'</span>,<span class="hljs-function"> -&gt;</span>
</code></pre><h3><a name='should-work-for-appendchild-actions'></a>should work for &quot;appendChild&quot; actions &nbsp; <font size=-1><a href='test-results.md.html#should-work-for-appendchild-actions'>see results</a></font> <font size=-1><a href='#should-work-for-appendchild-actions'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>We will test this by performing an &quot;appendChild&quot; action, then
asking it to be undone, then asking it to be redone, and inspecting
the DOM at each step to ensure it&#39;s as expected.</p>
<pre class="hljs"><code>    it <span class="hljs-string">'should work for "appendChild" actions'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>Because undo and redo march a document through a sequence of states
(both forwards and backwards) we create that sequence of states
here, up front, so that we can simply index into it throughout this
test.  In this case we only have two states, the first before the
edit, and the second after it.</p>
<pre class="hljs"><code>        states = [
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : id : <span class="hljs-string">'0'</span>
                children : [ <span class="hljs-string">'\n        '</span> ]
            }
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : id : <span class="hljs-string">'0'</span>
                children : [
                    <span class="hljs-string">'\n        '</span>
                    {
                        tagName : <span class="hljs-string">'SPAN'</span>
                        children : [
                            {
                                tagName : <span class="hljs-string">'I'</span>
                                children : [ <span class="hljs-string">'stuff,'</span> ]
                            }
                            <span class="hljs-string">' bro'</span>
                        ]
                    }
                ]
            }
        ]
</code></pre><p>Create DOM objects used in this test, and set up a tracker.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.div = <span class="hljs-built_in">document</span>.getElementById <span class="hljs-string">'0'</span>
            <span class="hljs-built_in">window</span>.tracker = DOMEditTracker.instanceOver div
            <span class="hljs-built_in">window</span>.span = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'span'</span>
            span.innerHTML = <span class="hljs-string">'&lt;i&gt;stuff,&lt;/i&gt; bro'</span>
</code></pre><p>Verify that the initial state matches what&#39;s stored in the state
history, above, and is therefore expected.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform the editing action, and validate both it and its results.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            div.appendChild span
            <span class="hljs-built_in">window</span>.action =
                tracker.stack[tracker.stack.length - <span class="hljs-number">1</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> action.toJSON() ), <span class="hljs-string">'toEqual'</span>, {
            node : [], type : <span class="hljs-string">'appendChild'</span>,
            toAppend : {
                tagName : <span class="hljs-string">'SPAN'</span>
                children : [
                    {
                        tagName : <span class="hljs-string">'I'</span>
                        children : [ <span class="hljs-string">'stuff,'</span> ]
                    }
                    <span class="hljs-string">' bro'</span>
                ]
            }
        }
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><p>Perform an undo of that action, and verify that the results are
back to the initial state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.undo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform a redo of that action, and verify that the results are
back to the second state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.redo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><h3><a name='should-work-for-insertbefore-actions'></a>should work for &quot;insertBefore&quot; actions &nbsp; <font size=-1><a href='test-results.md.html#should-work-for-insertbefore-actions'>see results</a></font> <font size=-1><a href='#should-work-for-insertbefore-actions'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>We will test this by performing an &quot;insertBefore&quot; action, then
asking it to be undone, then asking it to be redone, and inspecting
the DOM at each step to ensure it&#39;s as expected.</p>
<pre class="hljs"><code>    it <span class="hljs-string">'should work for "insertBefore" actions'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>Because undo and redo march a document through a sequence of states
(both forwards and backwards) we create that sequence of states
here, up front, so that we can simply index into it throughout this
test.  In this case we only have two states, the first before the
edit, and the second after it.</p>
<pre class="hljs"><code>        states = [
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : id : <span class="hljs-string">'0'</span>
                children : [ <span class="hljs-string">'\n        '</span> ]
            }
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : id : <span class="hljs-string">'0'</span>
                children : [
                    {
                        tagName : <span class="hljs-string">'SPAN'</span>
                        children : [
                            {
                                tagName : <span class="hljs-string">'I'</span>
                                children : [ <span class="hljs-string">'stuff,'</span> ]
                            }
                            <span class="hljs-string">' bro'</span>
                        ]
                    }
                    <span class="hljs-string">'\n        '</span>
                ]
            }
        ]
</code></pre><p>Create DOM objects used in this test, and set up a tracker.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.div = <span class="hljs-built_in">document</span>.getElementById <span class="hljs-string">'0'</span>
            <span class="hljs-built_in">window</span>.tracker = DOMEditTracker.instanceOver div
            <span class="hljs-built_in">window</span>.span = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'span'</span>
            span.innerHTML = <span class="hljs-string">'&lt;i&gt;stuff,&lt;/i&gt; bro'</span>
</code></pre><p>Verify that the initial state matches what&#39;s stored in the state
history, above, and is therefore expected.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform the editing action, and validate both it and its results.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            div.insertBefore span, div.childNodes[<span class="hljs-number">0</span>]
            <span class="hljs-built_in">window</span>.action =
                tracker.stack[tracker.stack.length - <span class="hljs-number">1</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> action.toJSON() ), <span class="hljs-string">'toEqual'</span>, {
            node : [], type : <span class="hljs-string">'insertBefore'</span>,
            insertBefore : <span class="hljs-number">0</span>, toInsert : {
                tagName : <span class="hljs-string">'SPAN'</span>
                children : [
                    {
                        tagName : <span class="hljs-string">'I'</span>
                        children : [ <span class="hljs-string">'stuff,'</span> ]
                    }
                    <span class="hljs-string">' bro'</span>
                ]
            }
        }
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><p>Perform an undo of that action, and verify that the results are
back to the initial state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.undo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform a redo of that action, and verify that the results are
back to the second state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.redo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><h3><a name='should-work-for-normalize-actions'></a>should work for &quot;normalize&quot; actions &nbsp; <font size=-1><a href='test-results.md.html#should-work-for-normalize-actions'>see results</a></font> <font size=-1><a href='#should-work-for-normalize-actions'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>We will test this by performing a &quot;normalize&quot; action, then
asking it to be undone, then asking it to be redone, and inspecting
the DOM at each step to ensure it&#39;s as expected.</p>
<pre class="hljs"><code>    it <span class="hljs-string">'should work for "normalize" actions'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>Because undo and redo march a document through a sequence of states
(both forwards and backwards) we create that sequence of states
here, up front, so that we can simply index into it throughout this
test.  In this case we only have two states, the first before the
edit, and the second after it.</p>
<pre class="hljs"><code>        states = [
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : id : <span class="hljs-string">'0'</span>
                children : [
                    <span class="hljs-string">'\n        '</span>
                    <span class="hljs-string">'one'</span>
                    {
                        tagName : <span class="hljs-string">'SPAN'</span>
                        children : [ <span class="hljs-string">'one and'</span>, <span class="hljs-string">' a half'</span> ]
                    }
                    <span class="hljs-string">'two'</span>
                ]
            }
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : id : <span class="hljs-string">'0'</span>
                children : [
                    <span class="hljs-string">'\n        one'</span>
                    {
                        tagName : <span class="hljs-string">'SPAN'</span>
                        children : [ <span class="hljs-string">'one and a half'</span> ]
                    }
                    <span class="hljs-string">'two'</span>
                ]
            }
        ]
</code></pre><p>Create DOM objects used in this test, and set up a tracker.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.div = <span class="hljs-built_in">document</span>.getElementById <span class="hljs-string">'0'</span>
            <span class="hljs-built_in">window</span>.tracker = DOMEditTracker.instanceOver div
            div.appendChild <span class="hljs-built_in">document</span>.createTextNode <span class="hljs-string">'one'</span>
            <span class="hljs-built_in">window</span>.span = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'span'</span>
            span.innerHTML = <span class="hljs-string">'one and'</span>
            span.appendChild <span class="hljs-built_in">document</span>.createTextNode <span class="hljs-string">' a half'</span>
            div.appendChild span
            div.appendChild <span class="hljs-built_in">document</span>.createTextNode <span class="hljs-string">'two'</span>
</code></pre><p>Verify that the initial state matches what&#39;s stored in the state
history, above, and is therefore expected.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform the editing action, and validate both it and its results.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            div.normalize()
            <span class="hljs-built_in">window</span>.action =
                tracker.stack[tracker.stack.length - <span class="hljs-number">1</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> action.toJSON() ), <span class="hljs-string">'toEqual'</span>, {
            node : [], type : <span class="hljs-string">'normalize'</span>,
            sequences : {
                <span class="hljs-string">'[0]'</span> : [ <span class="hljs-string">'\n        '</span>, <span class="hljs-string">'one'</span> ]
                <span class="hljs-string">'[1,0]'</span> : [ <span class="hljs-string">'one and'</span>, <span class="hljs-string">' a half'</span> ]
            }
        }
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><p>Perform an undo of that action, and verify that the results are
back to the initial state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.undo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform a redo of that action, and verify that the results are
back to the second state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.redo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><h3><a name='should-work-for-removeattribute-actions'></a>should work for &quot;removeAttribute&quot; actions &nbsp; <font size=-1><a href='test-results.md.html#should-work-for-removeattribute-actions'>see results</a></font> <font size=-1><a href='#should-work-for-removeattribute-actions'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>We will test this by performing a &quot;removeAttribute&quot; action, then
asking it to be undone, then asking it to be redone, and inspecting
the DOM at each step to ensure it&#39;s as expected.</p>
<pre class="hljs"><code>    it <span class="hljs-string">'should work for "removeAttribute" actions'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>Because undo and redo march a document through a sequence of states
(both forwards and backwards) we create that sequence of states
here, up front, so that we can simply index into it throughout this
test.  In this case we only have two states, the first before the
edit, and the second after it.</p>
<pre class="hljs"><code>        states = [
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : id : <span class="hljs-string">'0'</span>
                children : [ <span class="hljs-string">'\n        '</span> ]
            }
            {
                tagName : <span class="hljs-string">'DIV'</span>
                children : [ <span class="hljs-string">'\n        '</span> ]
            }
        ]
</code></pre><p>Create DOM objects used in this test, and set up a tracker.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.div = <span class="hljs-built_in">document</span>.getElementById <span class="hljs-string">'0'</span>
            <span class="hljs-built_in">window</span>.tracker = DOMEditTracker.instanceOver div
</code></pre><p>Verify that the initial state matches what&#39;s stored in the state
history, above, and is therefore expected.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform the editing action, and validate both it and its results.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            div.removeAttribute <span class="hljs-string">'id'</span>
            <span class="hljs-built_in">window</span>.action =
                tracker.stack[tracker.stack.length - <span class="hljs-number">1</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> action.toJSON() ), <span class="hljs-string">'toEqual'</span>, {
            node : [], type : <span class="hljs-string">'removeAttribute'</span>,
            name : <span class="hljs-string">'id'</span>, value : <span class="hljs-string">'0'</span>
        }
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><p>Perform an undo of that action, and verify that the results are
back to the initial state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.undo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform a redo of that action, and verify that the results are
back to the second state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.redo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><h3><a name='should-work-for-removeattributenode-actions'></a>should work for &quot;removeAttributeNode&quot; actions &nbsp; <font size=-1><a href='test-results.md.html#should-work-for-removeattributenode-actions'>see results</a></font> <font size=-1><a href='#should-work-for-removeattributenode-actions'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>We will test this by performing a &quot;removeAttributeNode&quot; action,
then asking it to be undone, then asking it to be redone, and
inspecting the DOM at each step to ensure it&#39;s as expected.</p>
<pre class="hljs"><code>    it <span class="hljs-string">'should work for "removeAttributeNode" actions'</span>,
    inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>Because undo and redo march a document through a sequence of states
(both forwards and backwards) we create that sequence of states
here, up front, so that we can simply index into it throughout this
test.  In this case we only have two states, the first before the
edit, and the second after it.</p>
<pre class="hljs"><code>        states = [
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : id : <span class="hljs-string">'0'</span>
                children : [ <span class="hljs-string">'\n        '</span> ]
            }
            {
                tagName : <span class="hljs-string">'DIV'</span>
                children : [ <span class="hljs-string">'\n        '</span> ]
            }
        ]
</code></pre><p>Create DOM objects used in this test, and set up a tracker.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.div = <span class="hljs-built_in">document</span>.getElementById <span class="hljs-string">'0'</span>
            <span class="hljs-built_in">window</span>.tracker = DOMEditTracker.instanceOver div
</code></pre><p>Verify that the initial state matches what&#39;s stored in the state
history, above, and is therefore expected.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform the editing action, and validate both it and its results.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            div.removeAttributeNode div.getAttributeNode <span class="hljs-string">'id'</span>
            <span class="hljs-built_in">window</span>.action =
                tracker.stack[tracker.stack.length - <span class="hljs-number">1</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> action.toJSON() ), <span class="hljs-string">'toEqual'</span>, {
            node : [], type : <span class="hljs-string">'removeAttributeNode'</span>,
            name : <span class="hljs-string">'id'</span>, value : <span class="hljs-string">'0'</span>
        }
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><p>Perform an undo of that action, and verify that the results are
back to the initial state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.undo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform a redo of that action, and verify that the results are
back to the second state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.redo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><h3><a name='should-work-for-removechild-actions'></a>should work for &quot;removeChild&quot; actions &nbsp; <font size=-1><a href='test-results.md.html#should-work-for-removechild-actions'>see results</a></font> <font size=-1><a href='#should-work-for-removechild-actions'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>We will test this by performing a &quot;removeChild&quot; action, then asking
it to be undone, then asking it to be redone, and inspecting the
DOM at each step to ensure it&#39;s as expected.</p>
<pre class="hljs"><code>    it <span class="hljs-string">'should work for "removeChild" actions'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>Because undo and redo march a document through a sequence of states
(both forwards and backwards) we create that sequence of states
here, up front, so that we can simply index into it throughout this
test.  In this case we only have two states, the first before the
edit, and the second after it.</p>
<pre class="hljs"><code>        states = [
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : id : <span class="hljs-string">'0'</span>
                children : [
                    <span class="hljs-string">'\n        '</span>
                    {
                        tagName : <span class="hljs-string">'SPAN'</span>
                        children : [ <span class="hljs-string">'this is a test'</span> ]
                    }
                ]
            }
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : id : <span class="hljs-string">'0'</span>
                children : [ <span class="hljs-string">'\n        '</span> ]
            }
        ]
</code></pre><p>Create DOM objects used in this test, and set up a tracker.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.div = <span class="hljs-built_in">document</span>.getElementById <span class="hljs-string">'0'</span>
            <span class="hljs-built_in">window</span>.span = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'span'</span>
            span.innerHTML = <span class="hljs-string">'this is a test'</span>
            div.appendChild span
            <span class="hljs-built_in">window</span>.tracker = DOMEditTracker.instanceOver div
</code></pre><p>Verify that the initial state matches what&#39;s stored in the state
history, above, and is therefore expected.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform the editing action, and validate both it and its results.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            div.removeChild span
            <span class="hljs-built_in">window</span>.action =
                tracker.stack[tracker.stack.length - <span class="hljs-number">1</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> action.toJSON() ), <span class="hljs-string">'toEqual'</span>, {
            node : [], type : <span class="hljs-string">'removeChild'</span>,
            childIndex : <span class="hljs-number">1</span>, child : {
                tagName : <span class="hljs-string">'SPAN'</span>
                children : [ <span class="hljs-string">'this is a test'</span> ]
            }
        }
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><p>Perform an undo of that action, and verify that the results are
back to the initial state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.undo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform a redo of that action, and verify that the results are
back to the second state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.redo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><h3><a name='should-work-for-replacechild-actions'></a>should work for &quot;replaceChild&quot; actions &nbsp; <font size=-1><a href='test-results.md.html#should-work-for-replacechild-actions'>see results</a></font> <font size=-1><a href='#should-work-for-replacechild-actions'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>We will test this by performing a &quot;replaceChild&quot; action, then
asking it to be undone, then asking it to be redone, and inspecting
the DOM at each step to ensure it&#39;s as expected.</p>
<pre class="hljs"><code>    it <span class="hljs-string">'should work for "replaceChild" actions'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>Because undo and redo march a document through a sequence of states
(both forwards and backwards) we create that sequence of states
here, up front, so that we can simply index into it throughout this
test.  In this case we only have two states, the first before the
edit, and the second after it.</p>
<pre class="hljs"><code>        states = [
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : id : <span class="hljs-string">'0'</span>
                children : [
                    <span class="hljs-string">'\n        '</span>
                    {
                        tagName : <span class="hljs-string">'SPAN'</span>
                        children : [ <span class="hljs-string">'this is a test'</span> ]
                    }
                ]
            }
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : id : <span class="hljs-string">'0'</span>
                children : [
                    <span class="hljs-string">'\n        '</span>
                    {
                        tagName : <span class="hljs-string">'H1'</span>
                        children : [
                            <span class="hljs-string">'a'</span>
                            {
                                tagName : <span class="hljs-string">'SUP'</span>
                                children : [ <span class="hljs-string">'b'</span> ]
                            }
                        ]
                    }
                ]
            }
        ]
</code></pre><p>Create DOM objects used in this test, and set up a tracker.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.div = <span class="hljs-built_in">document</span>.getElementById <span class="hljs-string">'0'</span>
            <span class="hljs-built_in">window</span>.span = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'span'</span>
            span.innerHTML = <span class="hljs-string">'this is a test'</span>
            div.appendChild span
            <span class="hljs-built_in">window</span>.repl = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'h1'</span>
            repl.innerHTML = <span class="hljs-string">'a&lt;sup&gt;b&lt;/sup&gt;'</span>
            <span class="hljs-built_in">window</span>.tracker = DOMEditTracker.instanceOver div
</code></pre><p>Verify that the initial state matches what&#39;s stored in the state
history, above, and is therefore expected.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform the editing action, and validate both it and its results.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            div.replaceChild repl, span
            <span class="hljs-built_in">window</span>.action =
                tracker.stack[tracker.stack.length - <span class="hljs-number">1</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> action.toJSON() ), <span class="hljs-string">'toEqual'</span>, {
            node : []
            type : <span class="hljs-string">'replaceChild'</span>
            childIndex : <span class="hljs-number">1</span>
            oldChild : {
                tagName : <span class="hljs-string">'SPAN'</span>
                children : [ <span class="hljs-string">'this is a test'</span> ]
            }
            newChild : {
                tagName : <span class="hljs-string">'H1'</span>
                children : [
                    <span class="hljs-string">'a'</span>
                    {
                        tagName : <span class="hljs-string">'SUP'</span>
                        children : [ <span class="hljs-string">'b'</span> ]
                    }
                ]
            }
        }
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><p>Perform an undo of that action, and verify that the results are
back to the initial state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.undo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform a redo of that action, and verify that the results are
back to the second state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.redo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><h3><a name='should-work-for-setattribute-actions'></a>should work for &quot;setAttribute&quot; actions &nbsp; <font size=-1><a href='test-results.md.html#should-work-for-setattribute-actions'>see results</a></font> <font size=-1><a href='#should-work-for-setattribute-actions'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>We will test this by performing a &quot;setAttribute&quot; action, then
asking it to be undone, then asking it to be redone, and inspecting
the DOM at each step to ensure it&#39;s as expected.</p>
<pre class="hljs"><code>    it <span class="hljs-string">'should work for "setAttribute" actions'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>Because undo and redo march a document through a sequence of states
(both forwards and backwards) we create that sequence of states
here, up front, so that we can simply index into it throughout this
test.  In this case we only have two states, the first before the
edit, and the second after it.</p>
<pre class="hljs"><code>        states = [
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : id : <span class="hljs-string">'0'</span>
                children : [ <span class="hljs-string">'\n        '</span> ]
            }
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : { id : <span class="hljs-string">'0'</span>, thing : <span class="hljs-string">'whatever'</span> }
                children : [ <span class="hljs-string">'\n        '</span> ]
            }
        ]
</code></pre><p>Create DOM objects used in this test, and set up a tracker.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.div = <span class="hljs-built_in">document</span>.getElementById <span class="hljs-string">'0'</span>
            <span class="hljs-built_in">window</span>.tracker = DOMEditTracker.instanceOver div
</code></pre><p>Verify that the initial state matches what&#39;s stored in the state
history, above, and is therefore expected.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform the editing action, and validate both it and its results.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            div.setAttribute <span class="hljs-string">'thing'</span>, <span class="hljs-string">'whatever'</span>
            <span class="hljs-built_in">window</span>.action =
                tracker.stack[tracker.stack.length - <span class="hljs-number">1</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> action.toJSON() ), <span class="hljs-string">'toEqual'</span>, {
            node : []
            type : <span class="hljs-string">'setAttribute'</span>
            name : <span class="hljs-string">'thing'</span>
            newValue : <span class="hljs-string">'whatever'</span>
            oldValue : <span class="hljs-string">''</span>
        }
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><p>Perform an undo of that action, and verify that the results are
back to the initial state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.undo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform a redo of that action, and verify that the results are
back to the second state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.redo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><h3><a name='should-work-for-setattributenode-actions'></a>should work for &quot;setAttributeNode&quot; actions &nbsp; <font size=-1><a href='test-results.md.html#should-work-for-setattributenode-actions'>see results</a></font> <font size=-1><a href='#should-work-for-setattributenode-actions'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>We will test this by performing a &quot;setAttributeNode&quot; action, then
asking it to be undone, then asking it to be redone, and inspecting
the DOM at each step to ensure it&#39;s as expected.</p>
<pre class="hljs"><code>    it <span class="hljs-string">'should work for "setAttributeNode" actions'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>Because undo and redo march a document through a sequence of states
(both forwards and backwards) we create that sequence of states
here, up front, so that we can simply index into it throughout this
test.  In this case we only have two states, the first before the
edit, and the second after it.</p>
<pre class="hljs"><code>        states = [
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : id : <span class="hljs-string">'0'</span>
                children : [ <span class="hljs-string">'\n        '</span> ]
            }
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : { id : <span class="hljs-string">'0'</span>, thing : <span class="hljs-string">'whatever'</span> }
                children : [ <span class="hljs-string">'\n        '</span> ]
            }
        ]
</code></pre><p>Create DOM objects used in this test, and set up a tracker.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.div = <span class="hljs-built_in">document</span>.getElementById <span class="hljs-string">'0'</span>
            <span class="hljs-built_in">window</span>.tracker = DOMEditTracker.instanceOver div
</code></pre><p>Verify that the initial state matches what&#39;s stored in the state
history, above, and is therefore expected.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform the editing action, and validate both it and its results.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            attr = <span class="hljs-built_in">document</span>.createAttribute <span class="hljs-string">'thing'</span>
            attr.value = <span class="hljs-string">'whatever'</span>
            div.setAttributeNode attr
            <span class="hljs-built_in">window</span>.action =
                tracker.stack[tracker.stack.length - <span class="hljs-number">1</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> action.toJSON() ), <span class="hljs-string">'toEqual'</span>, {
            node : []
            type : <span class="hljs-string">'setAttributeNode'</span>
            name : <span class="hljs-string">'thing'</span>
            newValue : <span class="hljs-string">'whatever'</span>
            oldValue : <span class="hljs-string">''</span>
        }
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><p>Perform an undo of that action, and verify that the results are
back to the initial state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.undo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform a redo of that action, and verify that the results are
back to the second state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> action.redo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><h3><a name='should-work-for-compound-actions'></a>should work for &quot;compound&quot; actions &nbsp; <font size=-1><a href='test-results.md.html#should-work-for-compound-actions'>see results</a></font> <font size=-1><a href='#should-work-for-compound-actions'><span class="glyphicon glyphicon-link"></span></a></font></h3><p>We will test this by performing a &quot;compound&quot; action, then asking it
to be undone, then asking it to be redone, and inspecting the DOM
at each step to ensure it&#39;s as expected.</p>
<pre class="hljs"><code>    it <span class="hljs-string">'should work for "compound" actions'</span>, inPage<span class="hljs-function"> -&gt;</span>
</code></pre><p>Because undo and redo march a document through a sequence of states
(both forwards and backwards) we create that sequence of states
here, up front, so that we can simply index into it throughout this
test.  In this case we only have three states, the first before the
first edit, the second before the second edit, and the third after
both edits.</p>
<pre class="hljs"><code>        states = [
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : id : <span class="hljs-string">'0'</span>
                children : [ <span class="hljs-string">'\n        '</span> ]
            }
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : { id : <span class="hljs-string">'0'</span>, thing : <span class="hljs-string">'whatever'</span> }
                children : [ <span class="hljs-string">'\n        '</span> ]
            }
            {
                tagName : <span class="hljs-string">'DIV'</span>
                attributes : { id : <span class="hljs-string">'0'</span>, thing : <span class="hljs-string">'whatever'</span> }
                children : [
                    <span class="hljs-string">'\n        '</span>
                    {
                        tagName : <span class="hljs-string">'SPAN'</span>
                        children : [ <span class="hljs-string">'contents of span'</span> ]
                    }
                ]
            }
        ]
</code></pre><p>Create DOM objects used in this test, and set up a tracker.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.div = <span class="hljs-built_in">document</span>.getElementById <span class="hljs-string">'0'</span>
            <span class="hljs-built_in">window</span>.tracker = DOMEditTracker.instanceOver div
</code></pre><p>Verify that the initial state matches what&#39;s stored in the state
history, above, and is therefore expected.</p>
<pre class="hljs"><code>        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform the first action, and validate both it and its results.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            attr = <span class="hljs-built_in">document</span>.createAttribute <span class="hljs-string">'thing'</span>
            attr.value = <span class="hljs-string">'whatever'</span>
            div.setAttributeNode attr
            <span class="hljs-built_in">window</span>.action1 =
                tracker.stack[tracker.stack.length - <span class="hljs-number">1</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> action1.toJSON() ), <span class="hljs-string">'toEqual'</span>, {
            node : []
            type : <span class="hljs-string">'setAttributeNode'</span>
            name : <span class="hljs-string">'thing'</span>
            newValue : <span class="hljs-string">'whatever'</span>
            oldValue : <span class="hljs-string">''</span>
        }
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">1</span>]
</code></pre><p>Perform the second action, and validate both it and its results.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            span = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'span'</span>
            span.textContent = <span class="hljs-string">'contents of span'</span>
            div.appendChild span
            <span class="hljs-built_in">window</span>.action2 =
                tracker.stack[tracker.stack.length - <span class="hljs-number">1</span>]
        pageExpects (<span class="hljs-function"> -&gt;</span> action2.toJSON() ), <span class="hljs-string">'toEqual'</span>, {
            node : [], type : <span class="hljs-string">'appendChild'</span>,
            toAppend : {
                tagName : <span class="hljs-string">'SPAN'</span>
                children : [ <span class="hljs-string">'content of span'</span> ]
            }
        }
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">2</span>]
</code></pre><p>Construct a compound action from the two just performed.  Then
perform an undo of that action, and verify that the results are
back to the initial state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span>
            <span class="hljs-built_in">window</span>.actionC = <span class="hljs-keyword">new</span> DOMEditAction <span class="hljs-string">'compound'</span>,
                action1, action2
            actionC.undo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">0</span>]
</code></pre><p>Perform a redo of that action, and verify that the results are
back to the third state.</p>
<pre class="hljs"><code>        pageDo<span class="hljs-function"> -&gt;</span> actionC.redo()
        pageExpects (<span class="hljs-function"> -&gt;</span> div.toJSON() ), <span class="hljs-string">'toEqual'</span>, states[<span class="hljs-number">2</span>]
</code></pre>
        </div>
        <div id="right">
            <h3 align=center>Navigation</h3><br><h3><a href='index.md.html'>webLurch home</a></h3><p>.</p><ul><li><a href='buildutils.litcoffee.html'>buildutils.litcoffee</a></li><li><a href='cake.litcoffee.html'>cake.litcoffee</a></li></ul><p>./app</p><ul><li><a href='../app/index.html'>index.html</a></li></ul><p>./doc</p><ul><li><a href='overview.md.html'>overview.md</a></li><li><a href='plan.md.html'>plan.md</a></li><li><a href='progress.md.html'>progress.md</a></li><li><a href='test-app-help.md.html'>test-app-help.md</a></li><li><a href='test-results.md.html'>test-results.md</a></li></ul><p>./src</p><ul><li><a href='domeditaction.litcoffee.html'>domeditaction.litcoffee</a></li><li><a href='domedittracker.litcoffee.html'>domedittracker.litcoffee</a></li><li><a href='domutils.litcoffee.html'>domutils.litcoffee</a></li><li><a href='lurcheditor.litcoffee.html'>lurcheditor.litcoffee</a></li></ul><p>./test</p><ul><li><a href='all-histories-spec.litcoffee.html'>all-histories-spec.litcoffee</a></li><li><a href='basic-spec.litcoffee.html'>basic-spec.litcoffee</a></li><li><a href='domeditaction-spec.litcoffee.html'>domeditaction-spec.litcoffee</a></li><li><a href='domedittracker-spec.litcoffee.html'>domedittracker-spec.litcoffee</a></li><li><a href='domutils-spec.litcoffee.html'>domutils-spec.litcoffee</a></li><li><a href='lurcheditor-spec.litcoffee.html'>lurcheditor-spec.litcoffee</a></li><li><a href='phantom-utils.litcoffee.html'>phantom-utils.litcoffee</a></li><li><a href='undoredo-spec.litcoffee.html'>undoredo-spec.litcoffee</a></li></ul><p>./testapp</p><ul><li><a href='utils.litcoffee.html'>utils.litcoffee</a></li><li><a href='../testapp/index.html'>index.html</a></li></ul>
        </div>
    </body>
</html>
