(function(){var resizeHistoryHeight;window.testAppSetup=function(){var t,e,n,o,i;for(window.LE=new LurchEditor(editor),initializeHistory(),window.maindiv=LE.getElement(),$(runButton).on("click",runButtonClicked),$(resetButton).on("click",resetButtonClicked),$(downloadButton).on("click",downloadButtonClicked),$(undoButton).on("click",undoButtonClicked),$(runFullHistoryButton).on("click",runFullHistoryButtonClicked),$(saveStateCommentsButton).on("click",saveStateCommentsButtonClicked),$(codeInput).on("keydown",function(t){return 13===t.keyCode?runButtonClicked():void 0}),$(commentEditInput).on("keydown",function(t){return 13===t.keyCode&&t.shiftKey?(saveStateCommentsButtonClicked(),!1):void 0}),$(sourceTab).on("click",updateSourceTab),$(historyTab).on("click",updateHistoryTab),e=Object.keys(allTestHistories),e.sort(),e.unshift("Compare to a saved history..."),o=0,i=e.length;i>o;o++)t=e[o],n=document.createElement("option"),n.textContent=t,savedHistoriesList.appendChild(n);return $(savedHistoriesList).change(chosenHistoryChanged),resizeHistoryHeight(),$(window).resize(resizeHistoryHeight),updateView(),codeInput.focus()},window.updateView=function(){return $(sourceView).hasClass("active")&&updateSourceTab(),$(historyView).hasClass("active")?updateHistoryTab():void 0},window.updateSourceTab=function(){var t;return t=LE.getElement().outerHTML.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;"),sourceView.innerHTML="<pre>"+t+"</pre>"},window.runCodeInModel=function(code){return eval(code),testHistory.push({code:code,state:LE.getElement().toJSON()})},window.runButtonClicked=function(){return runCodeInModel(codeInput.value),updateView(),codeInput.value="",codeInput.focus()},window.runSavedStep=function(t){var e,n;return e=null!=(n=window.comparisonHistory)?n.data:void 0,e&&t<e.length?(runCodeInModel(e[t].code),updateView()):void 0},window.runFullHistoryButtonClicked=function(){var t,e,n,o,i,s;if(t=null!=(i=window.comparisonHistory)?i.data:void 0){for(testHistory[testHistory.length-1].comments=t[0].comments,s=t.slice(1),n=0,o=s.length;o>n;n++)e=s[n],runCodeInModel(e.code),testHistory[testHistory.length-1].comments=e.comments;return updateView()}},window.yesButtonClicked=function(t){return testHistory[t].correct===!0?delete testHistory[t].correct:testHistory[t].correct=!0,updateView()},window.noButtonClicked=function(t){return testHistory[t].correct===!1?delete testHistory[t].correct:testHistory[t].correct=!1,updateView()},window.editStateComments=function(t){return $(commentEditInput).val(testHistory[t].comments),commentEditInput.comesFromIndex=t,$(commentEditDialog).modal({show:!0,backdrop:!0,keyboard:!0}),$(commentEditDialog).on("shown.bs.modal",function(){return $(commentEditInput).focus()})},window.saveStateCommentsButtonClicked=function(){var t;return t=commentEditInput.comesFromIndex,testHistory[t].comments=$(commentEditInput).val().trim(),$(commentEditDialog).modal("hide"),updateView()},window.downloadButtonClicked=function(){var t,e,n;return e=JSON.stringify(testHistory,null,2),t=new Blob([e],{type:"application/json"}),n=document.createElement("a"),n.setAttribute("href",URL.createObjectURL(t)),n.setAttribute("download",""+(testNameInput.value||"test-history")+".json"),n.click()},window.resetButtonClicked=function(){var t,e;return e=Node.fromJSON(testHistory[0].state),t=window.LE.getElement(),t.parentNode.replaceChild(e,t),window.LE=new LurchEditor(e),window.maindiv=e,initializeHistory(),chosenHistoryChanged(),updateView()},window.undoButtonClicked=function(){var t,e,n,o,i;for(t=testHistory,resetButtonClicked(),i=t.slice(1,-1),n=0,o=i.length;o>n;n++)e=i[n],runCodeInModel(e.code);return updateView()},window.chosenHistoryChanged=function(){var t;return t=$(savedHistoriesList).val(),window.comparisonHistory=t in allTestHistories?{filename:t,data:allTestHistories[t]}:null,updateView()},window.historyCommandRepresentation=function(t,e,n){var o;return null==n&&(n=""),o=t.code.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;"),"<div class='panel panel-info'>\n  <div class='panel-heading'>\n    "+n+"\n    <h3 class='panel-title'>Command "+e+":</h3>\n  </div>\n  <div class='panel-body'>\n    <pre>"+o+"</pre>\n  </div>\n</div>"},window.historyStateRepresentation=function(t,e,n,o){var i,s,r,a,l;return null==n&&(n=""),null==o&&(o="default"),i=Node.fromJSON(t.state).outerHTML,r=i.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;"),i=i.replace(/\s+id=['"][^'"]+['"]/g,""),a="<pre class='gap-below-2'>"+r+"</pre>\n"+i,0===e?(l="Initial state:",o+=" gap-before-2"):l="State after command "+e+":",s=t.comments?"<div class='well well-sm'>\n    <span class='glyphicon glyphicon-info-sign'>\n    </span>\n    "+t.comments+"\n</div>":"","<div class='panel panel-"+o+"'>\n    <div class='panel-heading'>\n        "+n+"\n        <h3 class='panel-title'>"+l+"</h3>\n    </div>\n    <div class='panel-body'>\n        "+s+"\n        "+a+"\n    </div>\n</div>"},window.updateHistoryTab=function(){var t,e,n,o,i,s,r,a,l,c,d,u,p,m,y,w,g,h,v,f,H,C,b,k;for(c=function(t){return"<button type='button'\n        class='btn btn-xs btn-default pull-right'\n        data-toggle='tooltip' title='Run'\n        onclick='runSavedStep("+t+");'\n ><span class='glyphicon glyphicon-play'>\n        </span></button>"},a=function(t){return"<button type='button'\n        class='btn btn-xs btn-default pull-right'\n        data-toggle='tooltip' title='Edit comments'\n        onclick='editStateComments("+t+");'\n ><span class='glyphicon glyphicon-pencil'>\n        </span></button>"},d=function(t){return"<button type='button'\n        class='btn btn-xs btn-danger pull-right'\n        data-toggle='tooltip' title='Mark incorrect'\n        onclick='noButtonClicked("+t+");'\n ><span class='glyphicon glyphicon-thumbs-down'>\n        </span></button>\n<button type='button'\n        class='btn btn-xs btn-success pull-right'\n        data-toggle='tooltip' title='Mark correct'\n        onclick='yesButtonClicked("+t+");'\n ><span class='glyphicon glyphicon-thumbs-up'>\n        </span></button>"},m="<div class='pull-right'>SAME\n    <span class='glyphicon glyphicon-ok'></span>\n</div>",i="<div class='pull-right'>DIFFERENT\n    <span class='glyphicon glyphicon-remove'></span>\n</div>",l=function(t,e){return"<div class='row'>\n    <div class='col-md-6'>"+t+"</div>\n    <div class='col-md-6'>"+e+"</div>\n</div>"},u="",e=(null!=(C=window.comparisonHistory)?C.data:void 0)||null,s=v=0,H=testHistory.length;H>v;s=++v)g=testHistory[s],s>0&&(n=historyCommandRepresentation(g,s),e&&(y=s<e.length?historyCommandRepresentation(e[s],s,c(s)):"",n=l(n,y)),u+=n),h=g.hasOwnProperty("correct")?g.correct?"success":"danger":"default",n=historyStateRepresentation(g,s,d(s)+a(s),h),e&&(s<e.length?(r=JSON.stringify(g.state),p=JSON.stringify(e[s].state),r===p?(o=m,h="success"):(o=i,h="danger"),y=historyStateRepresentation(e[s],s,o,h)):y="",n=l(n,y)),u+=n;if(e&&testHistory.length<e.length)for(s=f=b=testHistory.length,k=e.length;k>=b?k>f:f>k;s=k>=b?++f:--f)g=e[s],t=historyCommandRepresentation(g,s,c(s)),w=historyStateRepresentation(e[s],s,"","default"),u+=l("",t),u+=l("",w);return historyBody.innerHTML=u},resizeHistoryHeight=function(){var t,e,n,o,i;for(e=75,i=Array.prototype.slice.apply(mainContainer.childNodes),n=0,o=i.length;o>n&&(t=i[n],!$(t).hasClass("tab-content"));n++)t instanceof HTMLElement&&(e+=$(t).outerHeight(!0));return $(historyBody).height($(window).height()-e)},window.initializeHistory=function(){return window.testHistory=[{code:"",state:LE.getElement().toJSON()}],window.comparisonHistory=null}}).call(this);
//# sourceMappingURL=testapp.min.js.map