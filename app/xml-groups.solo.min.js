(function(){var e,n,t,i,o,a,r,l={}.hasOwnProperty,u=[].indexOf||function(e){for(var n=0,t=this.length;t>n;n++)if(n in this&&this[n]===e)return n;return-1};r={},window.setTagData=function(e){return r=e},window.addTagData=function(e){var n,t,i;i=[];for(n in e)l.call(e,n)&&(t=e[n],i.push(r[n]=t));return i},window.setGroupTag=function(e,n){return e.set("tagName",n)},window.getGroupTag=function(e){return e.get("tagName")},window.initializeGroupTag=function(e){var n,t;return n=e.parent?window.getGroupTag(e.parent):window.topLevelTagName(),t=window.getTagData(n,"defaultChild"),t?window.setGroupTag(e,t):void 0},window.getTagData=function(e,n){var t;return e instanceof window.Group&&(e=window.getGroupTag(e)),null!=(t=r[e])?t[n]:void 0},window.getTagExternalName=function(e){var n;return e instanceof window.Group&&(e=window.getGroupTag(e)),null!=(n=window.getTagData(e,"externalName"))?n:e},window.topLevelTagName=function(){var e,n;for(e in r)if(l.call(r,e)&&(n=r[e],n.topLevel))return e},window.XMLMenuItems=function(e){var n,t,i,o,l,u,c;return l=[],null!=(u=window.getGroupTag(e))&&(i=window.getTagExternalName(u),null!=(t=window.getTagData(u,"documentation"))&&(t=t.replace(/a href=/g,'a target="_blank" href='),l.push({text:'Read "'+i+'" documentation',onclick:function(){return a(t,'Documentation for "'+i+'"')}}))),l.push({text:"View XML representation",onclick:function(){var n;return n=window.convertToXML(e).replace(/&/g,"&amp;").replace(/</g,"&lt;"),a("<pre>"+n+"</pre>","XML Representation")}}),o=e.parent?window.getGroupTag(e.parent):window.topLevelTagName(),n=window.getTagData(o,"allowedChildren"),l.push({text:"Change tag to...",menu:function(){var t,i,o,a;for(o=Object.keys(r).sort(),a=[],t=0,i=o.length;i>t;t++)c=o[t],a.push(function(t){return{text:window.getTagExternalName(t),disabled:null!=n&&!(t in n),onclick:function(){return e.set("tagName",t)}}}(c));return a}()}),l},a=function(e,n){var t,i,o,a;return null==n&&(n={}),t=[{type:"button",text:"OK",subtype:"primary",onclick:function(e){return tinymce.activeEditor.windowManager.close(),"function"==typeof n.callback?n.callback(!0):void 0}}],n.confirm&&t.push({type:"button",text:"Cancel",onclick:function(e){return tinymce.activeEditor.windowManager.close(),"function"==typeof n.callback?n.callback(!1):void 0}}),tinymce.activeEditor.windowManager.open({title:null!=(i=n.title)?i:" ",url:window.objectURLForBlob(window.makeBlob(e,"text/html;charset=utf-8")),width:null!=(o=n.width)?o:500,height:null!=(a=n.height)?a:400,buttons:t})},window.groupToolbarButtons={viewxml:{text:"XML",tooltip:"View XML representation of this document",onclick:function(){var t,i,o,r,l,u,c,w;for(l=[],o=tinymce.activeEditor,w=o.Groups.ids(),u=0,c=w.length;c>u;u++)if(r=w[u],!n(o.Groups[r])){l.push("At least one element in your document has errors (indicated by a red X following the element).");break}return t=window.getTagData(window.topLevelTagName(),"allowedChildren"),t&&(l=l.concat(e(o.Groups.topLevel,t,"document"))),i=function(){var e;return e=encodeURIComponent(window.convertToXML()),window.open("data:application/xml,"+e,"_blank")},0===l.length?i():a("<p><b>The problems listed below exist in your document.</b></p> <ul><li>"+l.join("</li><li>")+"</li></ul> <p>You can click OK to generate XML anyway, but it may be invalid.  Click Cancel to go back and fix these problems first.</b></p>",{title:"Problems with your document",confirm:!0,callback:function(e){return e?i():void 0}})}}},window.XMLGroupChanged=function(e,n){return n&&!e.get("tagName")&&setTimeout(function(){return window.initializeGroupTag(e)},0),window.validateHierarchy(e)},window.XMLGroupDeleted=function(e){var n;if(null!=e.parent){if(e.parent.children[0])return window.validateHierarchy(e.parent.children[0])}else if(null!=(n=e.plugin)?n.topLevel[0]:void 0)return window.validateHierarchy(e.plugin.topLevel[0])},t=function(e){return e.set("valid",!0),e.clear("closeDecoration"),e.clear("closeHoverText")},i=function(e,n){return e.set("valid",!1),e.set("closeDecoration",'<font color="red">&#10006;</font>'),e.set("closeHoverText",n)},n=function(e){return e.get("valid")},window.validateHierarchy=function(n){var o,a,r,l,c,w,d,g,s,p,f,h,m,v,T,y;if(T=[],!n.children)return void setTimeout(function(){return window.validateHierarchy(n)},100);if(null==(g=window.getGroupTag(n))&&T.push("Each element must have a tag, but this one does not.  Add a tag using the context menu."),f=n.parent?window.getGroupTag(n.parent):window.topLevelTagName(),l=window.getTagData(n,"belongsIn"),"string"==typeof l&&(l=[l]),l instanceof Array&&u.call(l,f)<0&&(d=window.getTagExternalName(n),m=window.getTagExternalName(f),c=function(){var e,n,t;for(t=[],e=0,n=l.length;n>e;e++)a=l[e],t.push(window.getTagExternalName(a));return t}(),m=m?""+m+" elements":"in an element without a tag",c=function(){var e,n,t;for(t=[],e=0,n=l.length;n>e;e++)a=l[e],t.push(window.getTagExternalName(a));return t}(),h=function(){switch(c.length){case 1:return"this kind of element: "+c[0];case 2:return"these kinds of elements: "+c.join(" and ");default:return"these kinds of elements: "+c.join(", ")}}(),T.push(""+d+" elements are only permitted in "+h+" (not "+m+").")),v=n.previousSibling()?window.getGroupTag(n.previousSibling()):null,r=window.getTagData(n,"belongsAfter"),"string"==typeof l&&(r=[r]),null===r&&(r=[null]),r instanceof Array&&u.call(r,v)<0&&(d=window.getTagExternalName(n),m=window.getTagExternalName(v),m=m?""+m+" elements":"being first in their context",c=function(){var e,n,t,i;for(i=[],e=0,n=r.length;n>e;e++)a=r[e],i.push(null!=(t=window.getTagExternalName(a))?t:"none (i.e., being the first in their context)");return i}(),h=function(){switch(c.length){case 1:return"this kind of element: "+c[0];case 2:return"these kinds of elements: "+c.join(" and ");default:return"these kinds of elements: "+c.join(", ")}}(),T.push(""+d+" elements are only permitted to follow "+h+" (not "+m+").")),window.getTagData(n,"unique"))for(y=n;y=y.previousSibling();)if(window.getGroupTag(y)===g){T.push('Each context may contain only one "'+window.getTagExternalName(n)+'" element.  But there is already an earlier one in this context, making this one invalid.');break}return(o=window.getTagData(n,"allowedChildren"))&&(T=T.concat(e(n.children,o))),(w=window.getTagData(n,"contentCheck"))&&(s=w(n),s instanceof Array&&(T=T.concat(s))),T.length>0?i(n,T.join("\n")):t(n),(p=n.nextSibling())?window.validateHierarchy(p):void 0},e=function(e,n,t){var i,o,a,r,u,c,w,d,g,s,p,f,h,m;for(null==t&&(t="element"),d=[],r={},f=0,h=e.length;h>f;f++)i=e[f],o=window.getGroupTag(i),null==r[o]&&(r[o]=0),r[o]++;for(g in n)l.call(n,g)&&null==r[g]&&(r[g]=0);for(g in r)l.call(r,g)&&(a=r[g],n.hasOwnProperty(g)&&(m=n[g],w=m[0],c=m[1],null!=w&&null!=c&&"number"==typeof w&&"number"==typeof c&&(s=1===a?"is":"are",p=1===w?"child":"children",u=window.getTagExternalName(g),w>a&&d.push("The "+t+" requires at least "+w+" "+p+" with tag "+u+", but there "+s+" "+a+" in this "+t+"."),p=1===c?"child":"children",a>c&&d.push("The "+t+" permits at most "+c+" "+p+" with tag "+u+", but there "+s+" "+a+" in this "+t+"."))));return d},window.convertToXML=function(e){var n,t,i,a,l,u,c,w,d,g,s;return null!=e?(i=e.children,w=window.getGroupTag(e)):(i=tinymce.activeEditor.Groups.topLevel,w=window.topLevelTagName()),s=window.getTagData(w,"includeText"),g=function(e){var n,t;return s?r.hasOwnProperty(s)?(t="<"+s+">"+e+"</"+s+">",(n=window.getTagData(s,"alterXML"))&&(t=n(t)),t):e:""},c=function(){var n,r;if(i.length){for(a=function(e){return"  "+e.replace(RegExp("\n","g"),"\n  ")},u=i[0].rangeBefore(),l="",/^\s*$/.test(u.toString())||(l+=g(tinymce.DOM.encode(o(u)))),n=0,r=i.length;r>n;n++)t=i[n],"\n"!==l[l.length-1]&&(l+="\n"),l+=""+window.convertToXML(t)+"\n",u=t.rangeAfter(),/^\s*$/.test(u.toString())||(l+=g(tinymce.DOM.encode(o(u))));return"<"+w+">\n"+a(l)+"\n</"+w+">"}return d=window.getTagData(w,"rawXML")?(null!=e?e.contentAsText():tinymce.activeEditor.getContent({format:"text"})).replace(/\xA0/g,"\n"):tinymce.DOM.encode(null!=e?e.contentAsHTML():tinymce.activeEditor.getContent()),null==s&&(s=!0),"<"+w+">"+g(d)+"</"+w+">"}(),(n=window.getTagData(w,"alterXML"))&&(c=n(c,e)),c},o=function(e){var n,t,i,o,a,r;return(n=null!=e?e.cloneContents():void 0)?(o=e.startContainer.ownerDocument.createElement("div"),o.appendChild(n),t=o.innerHTML,r=/^\s/.test(t)?" ":"",a=/\s+$/.test(t)?" ":"",i=tinymce.activeEditor.serializer.serialize(o,{get:!0,format:"html",selection:!0,getInner:!0}),r+i+a):null}}).call(this);
//# sourceMappingURL=xml-groups.solo.min.js.map