(function(){var t,e,n,i=[].slice;t=function(){function t(t){this.editor=t}return t}(),tinymce.PluginManager.add("groups",function(e){return e.Groups=new t(e)}),e=function(){function t(e){var n;this.editor=e,this.setAppName(t.prototype.appName),this.setFileSystem(this.appName),this.setFilepath(FileSystem.prototype.pathSeparator),setTimeout(function(t){return function(){return t.clear()}}(this),0),this.saveMetaData=this.loadMetaData=null,this.editor.on("change",function(t){return function(){return t.setDocumentDirty(!0)}}(this)),n=function(t){return function(e,n){var i,o;return i={icon:n.icon,shortcut:n.shortcut,onclick:n.onclick},o=n.icon?"icon":"text",i[o]=n[o],t.editor.addButton(e,i),t.editor.addMenuItem(e,n)}}(this),n("newfile",{text:"New",icon:"newdocument",context:"file",shortcut:"ctrl+N",onclick:function(t){return function(){return t.tryToClear()}}(this)}),n("savefile",{text:"Save",icon:"save",context:"file",shortcut:"ctrl+S",onclick:function(t){return function(){return t.tryToSave()}}(this)}),this.editor.addMenuItem("saveas",{text:"Save as...",context:"file",shortcut:"ctrl+shift+S",onclick:function(t){return function(){return t.tryToSave(null,"")}}(this)}),n("openfile",{text:"Open...",icon:"browse",context:"file",shortcut:"ctrl+O",onclick:function(t){return function(){return t.handleOpen()}}(this)}),this.editor.addMenuItem("managefiles",{text:"Manage files...",context:"file",onclick:function(t){return function(){return t.manageFiles()}}(this)}),t.prototype.instances.push(this)}return t.prototype.appName=null,t.setAppName=function(e){var n,i,o,r,a;for(null==e&&(e=null),t.prototype.appName=e,r=t.prototype.instances,a=[],i=0,o=r.length;o>i;i++)n=r[i],a.push(n.setAppName(e));return a},t.prototype.instances=[],t.prototype.recomputePageTitle=function(){return document.title=""+(this.appName?this.appName+": ":"")+" "+(this.filename||"(untitled)")+" "+(this.documentDirty?"*":"")},t.prototype.setDocumentDirty=function(t){return null==t&&(t=!0),this.documentDirty=t,this.recomputePageTitle()},t.prototype.setFilename=function(t){return null==t&&(t=null),this.filename=t,this.recomputePageTitle()},t.prototype.setFilepath=function(t){return null==t&&(t=null),this.filepath=t},t.prototype.setAppName=function(t){var e;return null==t&&(t=null),e=this.appName===this.fileSystem,this.appName=t,e&&(this.fileSystem=this.appName),this.recomputePageTitle()},t.prototype.setFileSystem=function(t){return null==t&&(t=this.appName),this.fileSystem=t},t.prototype.clear=function(){return this.editor.setContent(""),this.setDocumentDirty(!1),this.setFilename(null)},t.prototype.tryToClear=function(){return this.documentDirty?this.editor.windowManager.open({title:"Save first?",buttons:[{text:"Save",onclick:function(t){return function(){return t.tryToSave(function(e){return e?t.clear():void 0}),t.editor.windowManager.close()}}(this)},{text:"Discard",onclick:function(t){return function(){return t.clear(),t.editor.windowManager.close()}}(this)},{text:"Cancel",onclick:function(t){return function(){return t.editor.windowManager.close()}}(this)}]}):(this.clear(),void this.editor.focus())},t.prototype.save=function(){var t,e;if(null!==this.filename)return e=new FileSystem(this.fileSystem),e.cd(this.filepath),t=[this.editor.getContent(),"function"==typeof this.saveMetaData?this.saveMetaData():void 0],e.write(this.filename,t,!0)?this.setDocumentDirty(!1):void 0},t.prototype.tryToSave=function(t,e){var n,o,r,a;return null==e&&(e=this.filename),e?(this.setFilename(e),r=this.save(),"function"==typeof t?t(r):void 0):(o=function(){var t,n,i,o,r,a;if(n=document.getElementsByClassName("mce-window")[0]){for(r=n.getElementsByTagName("button"),a=[],i=0,o=r.length;o>i;i++){if(t=r[i],"Save"===t.textContent){e?(t.removeAttribute("disabled"),t.parentNode.style.backgroundImage=null,t.parentNode.style.backgroundColor=null):(t.setAttribute("disabled",!0),t.parentNode.style.backgroundImage="none",t.parentNode.style.backgroundColor="#ccc");break}a.push(void 0)}return a}},e=null,this.saveFileNameChangedHandler=function(t){return e=t,o()},n=null,this.changedFolderHandler=function(t){return n=t},a=function(t){return function(e,n){var i;return i=new FileSystem(t.fileSystem),i.cd(e),null!==i.type(n)}}(this),this.buttonClickedHandler=function(o){return function(){var l,s;return s=arguments[0],l=2<=arguments.length?i.call(arguments,1):[],"Save"===s?a(n,e)&&!confirm("Are you sure you want to overwrite the file "+e+"?")?void o.tellDialog("setFileBrowserMode","save file"):(o.setFilepath(n),o.setFilename(e),o.editor.windowManager.close(),r=o.save(),"function"==typeof t?t(r):void 0):"Cancel"===s?(o.editor.windowManager.close(),"function"==typeof t?t(!1):void 0):void 0}}(this),this.editor.windowManager.open({title:"Save file...",url:"filedialog/filedialog.html",width:600,height:400,buttons:[{text:"Save",subtype:"primary",onclick:function(t){return function(){return t.buttonClickedHandler("Save")}}(this)},{text:"Cancel",onclick:function(t){return function(){return t.buttonClickedHandler("Cancel")}}(this)}]},{fsName:this.fileSystem,mode:"save file"}))},t.prototype.load=function(t,e){var n,i,o,r;if(null!==e)return null===t&&(t="."),o=new FileSystem(this.fileSystem),o.cd(t),r=o.read(e),n=r[0],i=r[1],this.editor.setContent(n),this.setFilepath(t),this.setFilename(e),this.setDocumentDirty(!1),i&&"function"==typeof this.loadMetaData?this.loadMetaData(i):void 0},t.prototype.tryToOpen=function(t){var e,n,o;return null==t&&(t=function(t){return function(e,n){return t.load(e,n)}}(this)),o=function(){var t,n,i,o,r,a;if(n=document.getElementsByClassName("mce-window")[0]){for(r=n.getElementsByTagName("button"),a=[],i=0,o=r.length;o>i;i++){if(t=r[i],"Open"===t.textContent){e?(t.removeAttribute("disabled"),t.parentNode.style.backgroundImage=null,t.parentNode.style.backgroundColor=null):(t.setAttribute("disabled",!0),t.parentNode.style.backgroundImage="none",t.parentNode.style.backgroundColor="#ccc");break}a.push(void 0)}return a}},e=null,this.selectedFileHandler=function(t){return e=t,o()},n=null,this.changedFolderHandler=function(t){return n=t},this.buttonClickedHandler=function(o){return function(){var r,a;return a=arguments[0],r=2<=arguments.length?i.call(arguments,1):[],"Open"===a?(o.editor.windowManager.close(),"function"==typeof t?t(n,e):void 0):"Cancel"===a?(o.editor.windowManager.close(),"function"==typeof t?t(null,null):void 0):void 0}}(this),this.editor.windowManager.open({title:"Open file...",url:"filedialog/filedialog.html",width:600,height:400,buttons:[{text:"Open",subtype:"primary",onclick:function(t){return function(){return t.buttonClickedHandler("Open")}}(this)},{text:"Cancel",onclick:function(t){return function(){return t.buttonClickedHandler("Cancel")}}(this)}]},{fsName:this.fileSystem,mode:"open file"}),o()},t.prototype.handleOpen=function(){return this.documentDirty?this.editor.windowManager.open({title:"Save first?",buttons:[{text:"Save",onclick:function(t){return function(){return t.editor.windowManager.close(),t.tryToSave(function(e){return e?t.tryToOpen():void 0})}}(this)},{text:"Discard",onclick:function(t){return function(){return t.editor.windowManager.close(),t.tryToOpen()}}(this)},{text:"Cancel",onclick:function(t){return function(){return t.editor.windowManager.close()}}(this)}]}):this.tryToOpen()},t.prototype.tellDialog=function(){var t,e,n,o,r;for(t=1<=arguments.length?i.call(arguments,0):[],n=document.getElementsByTagName("iframe"),o=0,r=n.length;r>o;o++)if(e=n[o],"filedialog/filedialog.html"===e.getAttribute("src"))return e.contentWindow.postMessage(t,"*")},t.prototype.manageFiles=function(){return this.editor.windowManager.open({title:"Manage files",url:"filedialog/filedialog.html",width:700,height:500,buttons:[{text:"New folder",onclick:function(t){return function(){return t.tellDialog("buttonClicked","New folder")}}(this)},{text:"Done",onclick:function(t){return function(){return t.editor.windowManager.close()}}(this)}]},{fsName:this.fileSystem,mode:"manage files"})},t}(),tinymce.PluginManager.add("loadsave",function(t){return t.LoadSave=new e(t)}),window.onmessage=function(t){var n,i,o,r,a;for(n=""+t.data[0]+"Handler",a=e.prototype.instances,o=0,r=a.length;r>o;o++)if(i=a[o],i.hasOwnProperty(n))return i[n].apply(null,t.data.slice(1))},window.setAppName=function(t){return null==t&&(t=null),e.prototype.appName=t},n=function(){function t(t){this.editor=t,this.editor.on("init",function(t){return function(){return t.canvas=document.createElement("canvas"),t.editor.getContentAreaContainer().appendChild(t.canvas),t.canvas.style.position="absolute",t.canvas.style.top=t.canvas.style.left="0px",t.canvas.style["background-color"]="rgba(0,0,0,0)",t.canvas.style["pointer-events"]="none",t.canvas.style["z-index"]="10"}}(this)),this.drawHandlers=[],this.editor.on("NodeChange",function(t){return function(){var e,n,i,o,r,a,l;for(t.positionCanvas(),e=t.canvas.getContext("2d"),t.clearCanvas(e),a=t.drawHandlers,l=[],o=0,r=a.length;r>o;o++){n=a[o];try{l.push(n(t.canvas,e))}catch(s){i=s,l.push(console.log("Error in overlay draw function: "+i))}}return l}}(this))}return t.prototype.addDrawHandler=function(t){return this.drawHandlers.push(t)},t.prototype.getEditorFrame=function(){var t,e,n,i;for(i=window.frames,e=0,n=i.length;n>e;e++)if(t=i[e],t.document===this.editor.getDoc())return t;return null},t.prototype.positionCanvas=function(){var t,e,n;for(this.canvas.width=this.canvas.parentNode.offsetWidth,this.canvas.height=this.canvas.parentNode.offsetHeight,e=n=this.getEditorFrame(),t=function(t){return tinymce.DOM.hasClass(t,"mce-container-body")};n&&!t(n);)n=n.parentNode;return n?this.canvas.style.top=n.clientHeight-e.clientHeight:void 0},t.prototype.clearCanvas=function(t){return t.clearRect(0,0,this.canvas.width,this.canvas.height)},t}(),tinymce.PluginManager.add("overlay",function(t){return t.Overlay=new n(t)}),setAppName("Lurch"),$(function(){var t;return t=document.createElement("textarea"),t.setAttribute("id","editor"),document.body.appendChild(t),tinymce.init({selector:"#editor",auto_focus:"editor",browser_spellcheck:!0,gecko_spellcheck:!0,statusbar:!1,plugins:"advlist table charmap colorpicker contextmenu image link importcss paste print save searchreplace textcolor fullscreen -loadsave -overlay -groups",toolbar:["newfile openfile savefile managefiles | print | undo redo | cut copy paste | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent blockquote | table","fontselect styleselect | bold italic underline textcolor subscript superscript removeformat | link unlink | charmap image | spellchecker searchreplace"],menu:{file:{title:"File",items:"newfile openfile | savefile saveas | managefiles | print"},edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall"},insert:{title:"Insert",items:"link media | template hr"},view:{title:"View",items:"visualaid"},format:{title:"Format",items:"bold italic underline strikethrough superscript subscript | formats | removeformat"},table:{title:"Table",items:"inserttable tableprops deletetable | cell row column"},help:{title:"Help",items:"about website"}},contextmenu:"link image inserttable | cell row column deletetable",setup:function(t){return t.addMenuItem("about",{text:"About...",context:"help",onclick:function(){return alert("webLurch\n\npre-alpha, not intended for general consumption!")}}),t.addMenuItem("website",{text:"Lurch website",context:"help",onclick:function(){return window.open("http://www.lurchmath.org","_blank")}}),t.on("init",function(){var e,n;return t.getBody().style.fontSize="16px",setTimeout(function(){return t.execCommand("mceFullScreen")},0),e=t.getContainer().getElementsByClassName("mce-menubtn")[0],n=document.createElement("img"),n.setAttribute("src","icons/apple-touch-icon-76x76.png"),n.style.width=n.style.height="26px",n.style.padding="2px",e.insertBefore(n,e.childNodes[0]),t.getBody().addEventListener("focus",function(){return 0!==t.windowManager.getWindows().length?t.windowManager.close():void 0})})}})})}).call(this);
//# sourceMappingURL=app.min.js.map