(function(){var t;t=function(){function t(e){var n;this.editor=e,this.setAppName(t.prototype.appName),this.setFileSystem(this.appName),this.setFilepath(FileSystem.prototype.pathSeparator),setTimeout(function(t){return function(){return t.clear()}}(this),0),this.editor.on("change",function(t){return function(){return t.setDocumentDirty(!0)}}(this)),n=function(t){return function(e,n){var i,o;return i={icon:n.icon,shortcut:n.shortcut,onclick:n.onclick},o=n.icon?"icon":"text",i[o]=n[o],t.editor.addButton(e,i),t.editor.addMenuItem(e,n)}}(this),n("newfile",{text:"New",icon:"newdocument",context:"file",shortcut:"ctrl+N",onclick:function(t){return function(){return t.tryToClear()}}(this)}),n("savefile",{text:"Save",icon:"save",context:"file",shortcut:"ctrl+S",onclick:function(t){return function(){return t.tryToSave()}}(this)}),this.editor.addMenuItem("saveas",{text:"Save as...",context:"file",shortcut:"ctrl+shift+S",onclick:function(t){return function(){return t.tryToSave(null,"")}}(this)}),n("openfile",{text:"Open...",icon:"browse",context:"file",shortcut:"ctrl+O",onclick:function(t){return function(){return t.handleOpen()}}(this)}),this.editor.addMenuItem("managefiles",{text:"Manage files...",context:"file",onclick:function(t){return function(){return t.manageFiles()}}(this)}),t.prototype.instances.push(this)}return t.prototype.appName=null,t.setAppName=function(e){var n,i,o,r,l;for(null==e&&(e=null),t.prototype.appName=e,r=t.prototype.instances,l=[],i=0,o=r.length;o>i;i++)n=r[i],l.push(n.setAppName(e));return l},t.prototype.instances=[],t.prototype.recomputePageTitle=function(){return document.title=""+(this.appName?this.appName+": ":"")+" "+(this.filename||"(untitled)")+" "+(this.documentDirty?"*":"")},t.prototype.setDocumentDirty=function(t){return null==t&&(t=!0),this.documentDirty=t,this.recomputePageTitle()},t.prototype.setFilename=function(t){return null==t&&(t=null),this.filename=t,this.recomputePageTitle()},t.prototype.setFilepath=function(t){return null==t&&(t=null),this.filepath=t},t.prototype.setAppName=function(t){var e;return null==t&&(t=null),e=this.appName===this.fileSystem,this.appName=t,e&&(this.fileSystem=this.appName),this.recomputePageTitle()},t.prototype.setFileSystem=function(t){return null==t&&(t=this.appName),this.fileSystem=t},t.prototype.clear=function(){return this.editor.setContent(""),this.setDocumentDirty(!1),this.setFilename(null)},t.prototype.tryToClear=function(){return this.documentDirty?this.editor.windowManager.open({title:"Save first?",buttons:[{text:"Save",onclick:function(t){return function(){return t.tryToSave(function(e){return e?t.clear():void 0}),t.editor.windowManager.close()}}(this)},{text:"Discard",onclick:function(t){return function(){return t.clear(),t.editor.windowManager.close()}}(this)},{text:"Cancel",onclick:function(t){return function(){return t.editor.windowManager.close()}}(this)}]}):(this.clear(),void this.editor.focus())},t.prototype.save=function(){var t;if(null!==this.filename)return t=new FileSystem(this.fileSystem),t.cd(this.filepath),t.write(this.filename,this.editor.getContent(),!0)?this.setDocumentDirty(!1):void 0},t.prototype.tryToSave=function(t,e){var n,i,o;return null==e&&(e=this.filename),e?(this.setFilename(e),o=this.save(),"function"==typeof t?t(o):void 0):(i=function(){var t,n,i,o,r,l;for(n=document.getElementsByClassName("mce-window")[0],r=n.getElementsByTagName("button"),l=[],i=0,o=r.length;o>i;i++){if(t=r[i],"Save"===t.textContent){e?(t.removeAttribute("disabled"),t.parentNode.style.backgroundImage=null,t.parentNode.style.backgroundColor=null):(t.setAttribute("disabled",!0),t.parentNode.style.backgroundImage="none",t.parentNode.style.backgroundColor="#ccc");break}l.push(void 0)}return l},e=null,this.saveFileNameChangedHandler=function(t){return e=t,i()},n=null,this.changedFolderHandler=function(t){return n=t},this.editor.windowManager.open({title:"Save file...",url:"filedialog.html",width:600,height:400,buttons:[{text:"Save",subtype:"primary",onclick:function(i){return function(){return i.setFilepath(n),i.setFilename(e),i.editor.windowManager.close(),o=i.save(),"function"==typeof t?t(o):void 0}}(this)},{text:"Cancel",onclick:function(e){return function(){return e.editor.windowManager.close(),"function"==typeof t?t(!1):void 0}}(this)}]},{fsName:this.fileSystem,mode:"save file"}))},t.prototype.load=function(t,e){var n;if(null!==e)return null===t&&(t="."),n=new FileSystem(this.fileSystem),n.cd(t),this.editor.setContent(n.read(e)),this.setFilepath(t),this.setFilename(e),this.setDocumentDirty(!1)},t.prototype.tryToOpen=function(t){var e,n,i;return null==t&&(t=function(t){return function(e,n){return t.load(e,n)}}(this)),i=function(){var t,n,i,o,r,l;for(n=document.getElementsByClassName("mce-window")[0],r=n.getElementsByTagName("button"),l=[],i=0,o=r.length;o>i;i++){if(t=r[i],"Open"===t.textContent){e?(t.removeAttribute("disabled"),t.parentNode.style.backgroundImage=null,t.parentNode.style.backgroundColor=null):(t.setAttribute("disabled",!0),t.parentNode.style.backgroundImage="none",t.parentNode.style.backgroundColor="#ccc");break}l.push(void 0)}return l},e=null,this.selectedFileHandler=function(t){return e=t,i()},n=null,this.changedFolderHandler=function(t){return n=t},this.editor.windowManager.open({title:"Open file...",url:"filedialog.html",width:600,height:400,buttons:[{text:"Open",subtype:"primary",onclick:function(i){return function(){return i.editor.windowManager.close(),"function"==typeof t?t(n,e):void 0}}(this)},{text:"Cancel",onclick:function(e){return function(){return e.editor.windowManager.close(),"function"==typeof t?t(null,null):void 0}}(this)}]},{fsName:this.fileSystem,mode:"open file"}),i()},t.prototype.handleOpen=function(){return this.documentDirty?this.editor.windowManager.open({title:"Save first?",buttons:[{text:"Save",onclick:function(t){return function(){return t.editor.windowManager.close(),t.tryToSave(function(e){return e?t.tryToOpen():void 0})}}(this)},{text:"Discard",onclick:function(t){return function(){return t.editor.windowManager.close(),t.tryToOpen()}}(this)},{text:"Cancel",onclick:function(t){return function(){return t.editor.windowManager.close()}}(this)}]}):this.tryToOpen()},t.prototype.manageFiles=function(){return this.editor.windowManager.open({title:"Manage files",url:"filedialog.html",width:700,height:500,buttons:[{text:"New folder",onclick:function(){return function(){var t,e,n,i;for(e=document.getElementsByTagName("iframe"),console.log(e),n=0,i=e.length;i>n;n++)if(t=e[n],console.log(t.getAttribute("src")),"filedialog.html"===t.getAttribute("src"))return t.contentWindow.postMessage(["buttonClicked","New folder"],"*")}}(this)},{text:"Done",onclick:function(t){return function(){return t.editor.windowManager.close()}}(this)}]},{fsName:this.fileSystem,mode:"manage files"})},t}(),tinymce.PluginManager.add("loadsave",function(e){return e.LoadSave=new t(e)}),window.onmessage=function(e){var n,i,o,r,l;for(n=""+e.data[0]+"Handler",l=t.prototype.instances,o=0,r=l.length;r>o;o++)if(i=l[o],i.hasOwnProperty(n))return i[n].apply(null,e.data.slice(1))},window.setAppName=function(e){return null==e&&(e=null),t.prototype.appName=e},setAppName("Lurch"),$(function(){var t;return t=document.createElement("textarea"),t.setAttribute("id","editor"),document.body.appendChild(t),tinymce.init({selector:"#editor",auto_focus:"editor",statusbar:!1,plugins:"advlist table charmap colorpicker contextmenu image link importcss paste print save searchreplace spellchecker textcolor fullscreen -loadsave",toolbar:["newfile openfile savefile managefiles | print | undo redo | cut copy paste | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent blockquote | table","fontselect styleselect | bold italic underline textcolor subscript superscript removeformat | link unlink | charmap image | spellchecker searchreplace"],menu:{file:{title:"File",items:"newfile openfile | savefile saveas | managefiles | print"},edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall"},insert:{title:"Insert",items:"link media | template hr"},view:{title:"View",items:"visualaid"},format:{title:"Format",items:"bold italic underline strikethrough superscript subscript | formats | removeformat"},table:{title:"Table",items:"inserttable tableprops deletetable | cell row column"},tools:{title:"Tools",items:"spellchecker code"}},contextmenu:"link image inserttable | cell row column deletetable",setup:function(t){return t.on("init",function(){return t.getBody().style.fontSize="16px",setTimeout(function(){return t.execCommand("mceFullScreen")},0)})}})})}).call(this);
//# sourceMappingURL=app.min.js.map