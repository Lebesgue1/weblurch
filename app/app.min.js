(function(){var e,t,n,i,l,o,r,a,s,u,d,c,f,p,m,h=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};window.onmessage=function(e){var t;return e.data instanceof Array?(t=e.data.shift(),"function"!=typeof window[t]?console.log("Cannot call non-function:",t):window[t].apply(null,e.data)):console.log("Invalid message from page:",e.data)},p=function(e){return window.top.postMessage(e,"*")},r=new FileSystem("demo"),window.setFileSystemName=function(e){return r=new FileSystem(e),updateFileBrowser()},o=null,m=["manage files","open file","save file","open folder","save in folder"],window.setFileBrowserMode=function(e){return h.call(m,e)>=0&&(o=e),updateFileBrowser()},window.fileBeingMoved={},window.fileToBeOpened=null,window.selectFile=function(e){return window.fileToBeOpened=e,p(["selectedFile",e]),updateFileBrowser()},i=function(e){return r.cd(e),p(["changedFolder",r.getCwd()]),selectFile(null)},s=!1,window.setDialogImitation=function(e){return null==e&&(e=!0),s=!!e,updateFileBrowser()},window.buttonClicked=function(e){var t,n,i,l;return"New folder"===e?(n=prompt("Enter name of new folder","My Folder"),void(r.mkdir(n)?updateFileBrowser():alert("That folder name is already in use."))):(t=[],"Save"===e&&(i=r.getCwd(),i.slice(-1)!==FileSystem.prototype.pathSeparator&&(i+=FileSystem.prototype.pathSeparator),t.push(i+saveFileName.value),fileBeingMoved.name&&(t.unshift(fileBeingMoved.full),fileBeingMoved.copy?(l=r.cp(fileBeingMoved.full,i+saveFileName.value),e=l?"Copied":"Copy failed"):(l=r.mv(fileBeingMoved.full,i+saveFileName.value),e=l?"Moved":"Move failed"))),"Save here"===e&&t.push(r.getCwd()),"Open"===e&&(i=r.getCwd(),i.slice(-1)!==FileSystem.prototype.pathSeparator&&(i+=FileSystem.prototype.pathSeparator),t.push(i+fileToBeOpened)),"Open this folder"===e&&(t.push(r.getCwd()),e="Open folder"),p(["buttonClicked",e].concat(t)),window.fileBeingMoved={},selectFile(null),setFileBrowserMode("manage files"))},window.onload=f=function(){return setFileBrowserMode("manage files"),i(".")},n=function(e){return confirm("Are you sure you want to permantely delete "+e+"?")?(r.rm(e),updateFileBrowser()):void 0},window.updateFileBrowser=function(){var e,l,f,p,m,h,v,g,w,y,F,b,B,S,M,N,k,x,C,T,O,D,E,A,I,L,P,H,j,z,G;for(F={navigateFolders:!0,deleteFolders:!0,deleteFiles:!0,createFolders:!0,fileNameTextBox:!1,filesDisabled:!1,moveFiles:!0,moveFolders:!0,copyFiles:!0,extensionFilter:!1,selectFile:!1},D=o?o[0].toUpperCase()+o.slice(1):"",m=[],"manage files"===o?m=["New folder","Done"]:"save file"===o?(F.deleteFolders=F.deleteFiles=F.moveFiles=F.moveFolders=F.copyFiles=!1,F.fileNameTextBox=!0,D="Save as...",m=["Cancel","Save"],s&&m.unshift("New folder")):"save in folder"===o?(F.deleteFolders=F.deleteFiles=F.moveFiles=F.moveFolders=F.copyFiles=!1,F.filesDisabled=!0,D="Save in...",m=["New folder","Cancel","Save here"]):"open file"===o?(F.deleteFolders=F.deleteFiles=F.moveFiles=F.moveFolders=F.copyFiles=!1,F.extensionFilter=F.selectFile=!0,m=["Cancel","Open"]):"open folder"===o&&(F.deleteFolders=F.deleteFiles=F.moveFiles=F.moveFolders=F.copyFiles=!1,F.filesDisabled=!0,m=["Cancel","Open this folder"]),g=[],r.getCwd()!==FileSystem.prototype.pathSeparator&&(e=a("up-arrow"),l="Parent folder",F.navigateFolders&&(p=function(){return i("..")},e=u(e,"Go up to parent folder",p),l=u(l,"Go up to parent folder",p)),g.push(c(e,l))),z=r.ls(".","folders"),A=0,P=z.length;P>A;A++)S=z[A],e=a("folder"),l=S,F.navigateFolders&&!function(t){return p=function(){return i(t)},e=u(e,"Enter folder "+t,p),l=u(l,"Enter folder "+t,p)}(S),f="",F.deleteFolders&&!function(e){return f+=u(a("delete"),"Delete folder "+e,function(){return n(e)})}(S),F.moveFolders&&!function(e){return f+=u(a("move"),"Move folder "+e,function(){var t;return window.fileBeingMoved={name:e},fileBeingMoved.path=r.getCwd(),fileBeingMoved.full=fileBeingMoved.path,t=FileSystem.prototype.pathSeparator,fileBeingMoved.full.slice(-1)!==t&&(fileBeingMoved.full+=t),fileBeingMoved.full+=e,fileBeingMoved.copy=!1,o="save file",updateFileBrowser()})}(S),g.push(c(e,l,f));for(B="undefined"!=typeof fileFilter&&null!==fileFilter?fileFilter.options["undefined"!=typeof fileFilter&&null!==fileFilter?fileFilter.selectedIndex:void 0].value:void 0,B="*.*"===B?null:null!=B?B.slice(1):void 0,G=r.ls(".","files"),I=0,H=G.length;H>I;I++)b=G[I],B&&b.slice(-B.length)!==B||(e=a("text-file"),l=b,F.filesDisabled?l="<font color='#888888'>"+l+"</font>":F.selectFile&&!function(t){return p=function(){return selectFile(t)},e=u(e,"Open "+t,p),l=u(l,"Open "+t,p)}(b),F.fileNameTextBox&&!function(t){return p=function(){return saveFileName.value=t,enableOrDisableSaveButton()},e=u(e,"Save as "+t,p),l=u(l,"Save as "+t,p)}(b),f="",F.deleteFiles&&!function(e){return f+=u(a("delete"),"Delete file "+e,function(){return n(e)})}(b),F.moveFiles&&!function(e){return f+=u(a("move"),"Move file "+e,function(){var t;return window.fileBeingMoved={name:e},fileBeingMoved.path=r.getCwd(),fileBeingMoved.full=fileBeingMoved.path,t=FileSystem.prototype.pathSeparator,fileBeingMoved.full.slice(-1)!==t&&(fileBeingMoved.full+=t),fileBeingMoved.full+=e,fileBeingMoved.copy=!1,o="save file",updateFileBrowser()})}(b),F.copyFiles&&!function(e){return f+=u(a("copy"),"Copy file "+e,function(){var t;return window.fileBeingMoved={name:e},fileBeingMoved.path=r.getCwd(),fileBeingMoved.full=fileBeingMoved.path,t=FileSystem.prototype.pathSeparator,fileBeingMoved.full.slice(-1)!==t&&(fileBeingMoved.full+=t),fileBeingMoved.full+=e,fileBeingMoved.copy=!0,o="save file",updateFileBrowser()})}(b),w=c(e,l,f),fileToBeOpened===b&&(w="SELECT"+w),g.push(w));for(0===g.length&&g.push("(empty filesystem)"),N=d(g),E=T="",F.fileNameTextBox&&(T+="File name: <input id='saveFileName' type='text' size=40 onkeyup='enableOrDisableSaveButton();'/>"),F.extensionFilter&&(y=function(){var e,n,i,l;for(i=t(),l=[],e=0,n=i.length;n>e;e++)v=i[e],l.push("<option>"+v+"</option>");return l}(),T+="File type: <select id='fileFilter' onchange='updateFileBrowser();'> "+y.join("\n")+" </select>"),M=L=0,j=m.length;j>L;M=++L)O=m[M],h="","Open"!==O||fileToBeOpened||(h="disabled=true"),m[M]="<input type='button' value='  "+O+"  ' id='statusBarButton"+O+"' "+h+" onclick='buttonClicked(\""+O+"\");'/>";return m=m.join(" "),s?(C=r.getCwd(),C===FileSystem.prototype.pathSeparator&&(C+=" (top level)"),E="<table border=1 cellpadding=5 cellspacing=0 width=100% height=100%> <tr height=1%> <td bgcolor=#cccccc> <table border=0 cellpadding=0 cellspacing=0 width=100%> <tr> <td align=left width=33%> <b>"+D+"</b> </td> <td align=center width=34%> Folder: "+C+" </td> <td align=right width=33%> "+a("close")+" </td> </tr> </table> </td> </tr> <tr> <td bgcolor=#fafafa valign=top>",T="   </td> </tr> <tr height=1%> <td bgcolor=#cccccc> <table border=0 cellpadding=0 cellspacing=0 width=100%> <tr> <td align=left width=50%> "+T+" </td> <td align=right width=50%> "+m+" </td> </tr> </table> </td> </tr> </table>"):(window.fileBeingMoved.name&&(T+=" &nbsp; "+m),T="<div style='position: absolute; bottom: 0; width: 90%; margin-bottom: 5px;'> <center>"+T+"</center> </div>"),x=("undefined"!=typeof saveFileName&&null!==saveFileName?saveFileName.value:void 0)||("undefined"!=typeof fileBeingMoved&&null!==fileBeingMoved?fileBeingMoved.name:void 0),k="undefined"!=typeof fileFilter&&null!==fileFilter?fileFilter.selectedIndex:void 0,document.body.innerHTML=E+N+T,x&&"undefined"!=typeof saveFileName&&null!==saveFileName&&(saveFileName.value=x),k&&"undefined"!=typeof fileFilter&&null!==fileFilter&&(fileFilter.selectedIndex=k),enableOrDisableSaveButton(),"undefined"!=typeof saveFileName&&null!==saveFileName?saveFileName.focus():void 0},window.enableOrDisableSaveButton=function(){var e;return e="undefined"!=typeof saveFileName&&null!==saveFileName?saveFileName.value:void 0,"undefined"!=typeof statusBarButtonSave&&null!==statusBarButtonSave&&(statusBarButtonSave.disabled=!e),"string"==typeof e?p(["saveFileNameChanged",e]):void 0},d=function(e){var t,n,i,l,o,r,a,s;for(r="<table border=0 width=100% cellspacing=5 cellpadding=5>",t=Math.ceil(e.length/2),n=s=0;t>=0?t>s:s>t;n=t>=0?++s:--s)l=e[n],i="bgcolor=#e8e8e8","SELECT"===l.slice(0,6)&&(i="bgcolor=#ddddff",l=l.slice(6)),a=e[n+t],o="bgcolor=#e8e8e8",a?"SELECT"===a.slice(0,6)&&(o="bgcolor=#ddddff",a=a.slice(6)):o="",r+="<tr> <td width=50% "+i+">"+l+"</td> <td width=50% "+o+">"+(a||"")+"</td> </tr>";return r+"</table>"},window.actionLinks=[],l=function(){var e;return e=[]},u=function(e,t,n){var i;return i=actionLinks.length,actionLinks.push(n),"<a href='javascript:void(0);' title='"+t+"' onclick='actionLinks["+i+"]();'>"+e+"</a>"},a=function(e){return"<img src='"+e+".png'>"},c=function(e,t,n){return null==n&&(n=""),"<table border=0 cellpadding=0 cellspacing=0 width=100%><tr> <td width=22>"+(e||"")+"</td> <td align=left>"+t+" &nbsp; &nbsp; </td> <td align=left width=66><nobr>"+n+"</nobr></td></tr></table>"},t=function(e){var n,i,l,o,a,s,u,d,c,f,p,m,v;for(null==e&&(e=null),e||(e=new FileSystem(r.getName())),o=["*.*"],p=e.ls(".","files"),a=0,d=p.length;d>a;a++)i=p[a],n=/\.[^.]*?$/.exec(i),n&&(n="*"+n,h.call(o,n)<0&&o.push(n));for(m=e.ls(".","folders"),s=0,c=m.length;c>s;s++){for(l=m[s],e.cd(l),v=t(e),u=0,f=v.length;f>u;u++)n=v[u],h.call(o,n)<0&&o.push(n);e.cd("..")}return o.sort()},e=function(){function e(t){var n;this.editor=t,this.setAppName(e.prototype.appName),this.setFileSystem(this.appName),this.setFilepath(FileSystem.prototype.pathSeparator),setTimeout(function(e){return function(){return e.clear()}}(this),0),this.editor.on("change",function(e){return function(){return e.setDocumentDirty(!0)}}(this)),n=function(e){return function(t,n){var i,l;return i={icon:n.icon,shortcut:n.shortcut,onclick:n.onclick},l=n.icon?"icon":"text",i[l]=n[l],e.editor.addButton(t,i),e.editor.addMenuItem(t,n)}}(this),n("newfile",{text:"New",icon:"newdocument",context:"file",shortcut:"ctrl+N",onclick:function(e){return function(){return e.tryToClear()}}(this)}),n("savefile",{text:"Save",icon:"save",context:"file",shortcut:"ctrl+S",onclick:function(e){return function(){return e.tryToSave()}}(this)}),this.editor.addMenuItem("saveas",{text:"Save as...",context:"file",shortcut:"ctrl+shift+S",onclick:function(e){return function(){return e.tryToSave(null,"")}}(this)}),n("openfile",{text:"Open...",icon:"browse",context:"file",shortcut:"ctrl+O",onclick:function(e){return function(){return e.handleOpen()}}(this)}),this.editor.addMenuItem("managefiles",{text:"Manage files...",context:"file",onclick:function(e){return function(){return e.manageFiles()}}(this)}),e.prototype.instances.push(this)}return e.prototype.appName=null,e.setAppName=function(t){var n,i,l,o,r;for(null==t&&(t=null),e.prototype.appName=t,o=e.prototype.instances,r=[],i=0,l=o.length;l>i;i++)n=o[i],r.push(n.setAppName(t));return r},e.prototype.instances=[],e.prototype.recomputePageTitle=function(){return document.title=""+(this.appName?this.appName+": ":"")+" "+(this.filename||"(untitled)")+" "+(this.documentDirty?"*":"")},e.prototype.setDocumentDirty=function(e){return null==e&&(e=!0),this.documentDirty=e,this.recomputePageTitle()},e.prototype.setFilename=function(e){return null==e&&(e=null),this.filename=e,this.recomputePageTitle()},e.prototype.setFilepath=function(e){return null==e&&(e=null),this.filepath=e},e.prototype.setAppName=function(e){var t;return null==e&&(e=null),t=this.appName===this.fileSystem,this.appName=e,t&&(this.fileSystem=this.appName),this.recomputePageTitle()},e.prototype.setFileSystem=function(e){return null==e&&(e=this.appName),this.fileSystem=e},e.prototype.clear=function(){return this.editor.setContent(""),this.setDocumentDirty(!1),this.setFilename(null)},e.prototype.tryToClear=function(){return this.documentDirty?this.editor.windowManager.open({title:"Save first?",buttons:[{text:"Save",onclick:function(e){return function(){return e.tryToSave(function(t){return t?e.clear():void 0}),e.editor.windowManager.close()}}(this)},{text:"Discard",onclick:function(e){return function(){return e.clear(),e.editor.windowManager.close()}}(this)},{text:"Cancel",onclick:function(e){return function(){return e.editor.windowManager.close()}}(this)}]}):(this.clear(),void this.editor.focus())},e.prototype.save=function(){var e;if(null!==this.filename)return e=new FileSystem(this.fileSystem),e.cd(this.filepath),e.write(this.filename,this.editor.getContent(),!0)?this.setDocumentDirty(!1):void 0},e.prototype.tryToSave=function(e,t){var n,i,l;return null==t&&(t=this.filename),t?(this.setFilename(t),l=this.save(),"function"==typeof e?e(l):void 0):(i=function(){var e,n,i,l,o,r;for(n=document.getElementsByClassName("mce-window")[0],o=n.getElementsByTagName("button"),r=[],i=0,l=o.length;l>i;i++){if(e=o[i],"Save"===e.textContent){t?(e.removeAttribute("disabled"),e.parentNode.style.backgroundImage=null,e.parentNode.style.backgroundColor=null):(e.setAttribute("disabled",!0),e.parentNode.style.backgroundImage="none",e.parentNode.style.backgroundColor="#ccc");break}r.push(void 0)}return r},t=null,this.saveFileNameChangedHandler=function(e){return t=e,i()},n=null,this.changedFolderHandler=function(e){return n=e},this.editor.windowManager.open({title:"Save file...",url:"filedialog.html",width:600,height:400,buttons:[{text:"Save",subtype:"primary",onclick:function(i){return function(){return i.setFilepath(n),i.setFilename(t),i.editor.windowManager.close(),l=i.save(),"function"==typeof e?e(l):void 0}}(this)},{text:"Cancel",onclick:function(t){return function(){return t.editor.windowManager.close(),"function"==typeof e?e(!1):void 0}}(this)}]},{fsName:this.fileSystem,mode:"save file"}))},e.prototype.load=function(e,t){var n;if(null!==t)return null===e&&(e="."),n=new FileSystem(this.fileSystem),n.cd(e),this.editor.setContent(n.read(t)),this.setFilepath(e),this.setFilename(t),this.setDocumentDirty(!1)},e.prototype.tryToOpen=function(e){var t,n,i;return null==e&&(e=function(e){return function(t,n){return e.load(t,n)}}(this)),i=function(){var e,n,i,l,o,r;for(n=document.getElementsByClassName("mce-window")[0],o=n.getElementsByTagName("button"),r=[],i=0,l=o.length;l>i;i++){if(e=o[i],"Open"===e.textContent){t?(e.removeAttribute("disabled"),e.parentNode.style.backgroundImage=null,e.parentNode.style.backgroundColor=null):(e.setAttribute("disabled",!0),e.parentNode.style.backgroundImage="none",e.parentNode.style.backgroundColor="#ccc");break}r.push(void 0)}return r},t=null,this.selectedFileHandler=function(e){return t=e,i()},n=null,this.changedFolderHandler=function(e){return n=e},this.editor.windowManager.open({title:"Open file...",url:"filedialog.html",width:600,height:400,buttons:[{text:"Open",subtype:"primary",onclick:function(i){return function(){return i.editor.windowManager.close(),"function"==typeof e?e(n,t):void 0}}(this)},{text:"Cancel",onclick:function(t){return function(){return t.editor.windowManager.close(),"function"==typeof e?e(null,null):void 0}}(this)}]},{fsName:this.fileSystem,mode:"open file"}),i()},e.prototype.handleOpen=function(){return this.documentDirty?this.editor.windowManager.open({title:"Save first?",buttons:[{text:"Save",onclick:function(e){return function(){return e.editor.windowManager.close(),e.tryToSave(function(t){return t?e.tryToOpen():void 0})}}(this)},{text:"Discard",onclick:function(e){return function(){return e.editor.windowManager.close(),e.tryToOpen()}}(this)},{text:"Cancel",onclick:function(e){return function(){return e.editor.windowManager.close()}}(this)}]}):this.tryToOpen()},e.prototype.manageFiles=function(){return this.editor.windowManager.open({title:"Manage files",url:"filedialog.html",width:700,height:500,buttons:[{text:"New folder",onclick:function(){return function(){var e,t,n,i;for(t=document.getElementsByTagName("iframe"),console.log(t),n=0,i=t.length;i>n;n++)if(e=t[n],console.log(e.getAttribute("src")),"filedialog.html"===e.getAttribute("src"))return e.contentWindow.postMessage(["buttonClicked","New folder"],"*")}}(this)},{text:"Done",onclick:function(e){return function(){return e.editor.windowManager.close()}}(this)}]},{fsName:this.fileSystem,mode:"manage files"})},e}(),tinymce.PluginManager.add("loadsave",function(t){return t.LoadSave=new e(t)}),window.onmessage=function(t){var n,i,l,o,r;for(n=""+t.data[0]+"Handler",r=e.prototype.instances,l=0,o=r.length;o>l;l++)if(i=r[l],i.hasOwnProperty(n))return i[n].apply(null,t.data.slice(1))},window.setAppName=function(t){return null==t&&(t=null),e.prototype.appName=t},setAppName("Lurch"),$(function(){var e;return e=document.createElement("textarea"),e.setAttribute("id","editor"),document.body.appendChild(e),tinymce.init({selector:"#editor",auto_focus:"editor",statusbar:!1,plugins:"advlist table charmap colorpicker contextmenu image link importcss paste print save searchreplace spellchecker textcolor fullscreen -loadsave",toolbar:["newfile openfile savefile managefiles | print | undo redo | cut copy paste | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent blockquote | table","fontselect styleselect | bold italic underline textcolor subscript superscript removeformat | link unlink | charmap image | spellchecker searchreplace"],menu:{file:{title:"File",items:"newfile openfile | savefile saveas | managefiles | print"},edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall"},insert:{title:"Insert",items:"link media | template hr"},view:{title:"View",items:"visualaid"},format:{title:"Format",items:"bold italic underline strikethrough superscript subscript | formats | removeformat"},table:{title:"Table",items:"inserttable tableprops deletetable | cell row column"},tools:{title:"Tools",items:"spellchecker code"}},contextmenu:"link image inserttable | cell row column deletetable",setup:function(e){return e.on("init",function(){return e.getBody().style.fontSize="16px",setTimeout(function(){return e.execCommand("mceFullScreen")},0)})}})})}).call(this);
//# sourceMappingURL=app.min.js.map