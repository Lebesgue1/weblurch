(function(){var BackgroundFunction,OM,OMNode,addToCache,cacheLookup,drawHTMLCache,exports,makeBlob,markUsed,pruneCache,_ref,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__slice=[].slice,__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};window.Background={functions:{},registerFunction:function(e,t,n,r){return null==n&&(n={}),null==r&&(r=[]),window.Background.functions[e]={"function":t,globals:n,scripts:r}},runningTasks:[],waitingTasks:[],addTask:function(e,t,n){var r,i,o,s,a,u,l,c,f,h,d,p;for(o={name:e,inputs:t,callback:n,id:""+e+","+function(){var e,n,i;for(i=[],e=0,n=t.length;n>e;e++)r=t[e],i.push(r.id());return i}()},f=window.Background.waitingTasks,i=a=0,l=f.length;l>a;i=++a)if(s=f[i],s.id===o.id){window.Background.waitingTasks.splice(i,1);break}for(h=window.Background.runningTasks,i=u=0,c=h.length;c>u;i=++u)if(s=h[i],s.id===o.id){null!=(d=s.runner)&&null!=(p=d.worker)&&"function"==typeof p.terminate&&p.terminate(),window.Background.runningTasks.splice(i,1);break}return window.Background.waitingTasks.push(o),window.Background.update()},available:{},update:function(){var e,t,n,r,i;for(e=window.Background;e.runningTasks.length<e.concurrency();){if(null==(r=e.waitingTasks.shift()))return;if(n=null!=(i=e.available[r.name])?i.pop():void 0,null==n){if(t=e.functions[r.name],null==t)continue;n=new BackgroundFunction(t["function"],t.globals,t.scripts)}r.runner=n,e.runningTasks.push(r),function(t){var r;return r=function(){var r,i,o;return r=e.runningTasks.indexOf(t),e.runningTasks.splice(r,1),(null!=(i=e.available)[o=t.name]?i[o]:i[o]=[]).push(n),window.Background.update()},n.call.apply(n,t.inputs).sendTo(function(e){return r(),"function"==typeof t.callback?t.callback(e):void 0}).orElse(r)}(r)}}},navigator.getHardwareConcurrency(function(){}),window.Background.concurrency=function(){var e;return Math.max(1,(null!=(e=navigator.hardwareConcurrency)?e:1)-1)},BackgroundFunction=function(){function _Class(e,t,n){var r,i,o;if(this["function"]=e,this.globals=t,this.scripts=n,this.call=__bind(this.call,this),this.promise={sendTo:function(e){return function(t){return e.promise.resultCallback=t,e.promise.hasOwnProperty("result")&&e.promise.resultCallback(e.promise.result),e.promise}}(this),orElse:function(e){return function(t){return e.promise.errorCallback=t,e.promise.hasOwnProperty("error")&&e.promise.errorCallback(e.promise.error),e.promise}}(this)},window.Worker){this.worker=new window.Worker("worker.solo.js"),this.worker.addEventListener("message",function(e){return function(t){var n;return e.promise.result=t.data,null!=(n=e.promise)&&"function"==typeof n.resultCallback?n.resultCallback(t.data):void 0}}(this),!1),this.worker.addEventListener("error",function(e){return function(t){var n;return e.promise.error=t,null!=(n=e.promise)&&"function"==typeof n.errorCallback?n.errorCallback(t):void 0}}(this),!1),this.worker.postMessage({setFunction:""+this["function"]}),o=this.globals;for(i in o)__hasProp.call(o,i)&&(r=o[i],this.globals[i]=""+r);this.worker.postMessage({install:this.globals}),this.worker.postMessage({"import":this.scripts})}}return _Class.prototype.call=function(){var args,group,groups,_i,_len;for(args=1<=arguments.length?__slice.call(arguments,0):[],delete this.promise.result,delete this.promise.resultCallback,delete this.promise.error,delete this.promise.errorCallback,_i=0,_len=arguments.length;_len>_i;_i++)if(group=arguments[_i],group.deleted)return;return groups=function(){var e,t,n;for(n=[],e=0,t=args.length;t>e;e++)group=args[e],n.push(group.toJSON());return n}(),null!=this.worker?this.worker.postMessage({runOn:groups}):setTimeout(function(_this){return function(){var e,_base,_base1;try{with(this.globals)_this.promise.result=_this["function"].apply(_this,groups)}catch(_error){return e=_error,_this.promise.error=e,void("function"==typeof(_base=_this.promise).errorCallback&&_base.errorCallback(_this.promise.error))}return"function"==typeof(_base1=_this.promise).resultCallback?_base1.resultCallback(_this.promise.result):void 0}}(this),0),this.promise},_Class}(),CanvasRenderingContext2D.prototype.roundedRect=function(e,t,n,r,i){return this.beginPath(),this.moveTo(e+i,t),this.lineTo(n-i,t),this.arcTo(n,t,n,t+i,i),this.lineTo(n,r-i),this.arcTo(n,r,n-i,r,i),this.lineTo(e+i,r),this.arcTo(e,r,e,r-i,i),this.lineTo(e,t+i),this.arcTo(e,t,e+i,t,i),this.closePath()},CanvasRenderingContext2D.prototype.roundedZone=function(e,t,n,r,i,o,s,a,u){return this.beginPath(),this.moveTo(e+u,t),this.lineTo(this.canvas.width-a,t),this.lineTo(this.canvas.width-a,o),this.lineTo(n,o),this.lineTo(n,r-u),this.arcTo(n,r,n-u,r,u),this.lineTo(s,r),this.lineTo(s,i),this.lineTo(e,i),this.lineTo(e,t+u),this.arcTo(e,t,e+u,t,u),this.closePath()},window.rectanglesCollide=function(e,t,n,r,i,o,s,a){return!(i>=n||e>=s||o>=r||t>=a)},window.svgBlobForHTML=function(e,t){var n,r,i;return null==t&&(t="font-size:12px"),r=document.createElement("span"),r.setAttribute("style",t),r.innerHTML=e,document.body.appendChild(r),r=$(r),i=r.width()+2,n=r.height()+2,r.remove(),makeBlob("<svg xmlns='http://www.w3.org/2000/svg' width='"+i+"' height='"+n+"'><foreignObject width='100%' height='100%'><div xmlns='http://www.w3.org/1999/xhtml' style='"+t+"'>"+e+"</div></foreignObject></svg>","image/svg+xml;charset=utf-8")},makeBlob=function(e,t){var n,r,i,o,s;try{return new Blob([e],{type:t})}catch(a){if(r=a,window.BlobBuilder=null!=(i=null!=(o=null!=(s=window.BlobBuilder)?s:window.WebKitBlobBuilder)?o:window.MozBlobBuilder)?i:window.MSBlobBuilder,"TypeError"===r.name&&null!=window.BlobBuilder)return n=new BlobBuilder,n.append(e.buffer),n.getBlob(t);if("InvalidStateError"===r.name)return new Blob([e.buffer],{type:t})}},drawHTMLCache={order:[],maxSize:100},cacheLookup=function(e,t){var n;return n=JSON.stringify([e,t]),drawHTMLCache.hasOwnProperty(n)?drawHTMLCache[n]:null},addToCache=function(e,t,n){var r;return r=JSON.stringify([e,t]),drawHTMLCache[r]=n,markUsed(e,t)},markUsed=function(e,t){var n,r;return r=JSON.stringify([e,t]),(n=drawHTMLCache.order.indexOf(r))>-1&&drawHTMLCache.order.splice(n,1),drawHTMLCache.order.unshift(r),pruneCache()},pruneCache=function(){var e;for(e=[];drawHTMLCache.order.length>drawHTMLCache.maxSize;)e.push(delete drawHTMLCache[drawHTMLCache.order.pop()]);return e},CanvasRenderingContext2D.prototype.drawHTML=function(e,t,n,r){var i,o;return null==r&&(r="font-size:12px"),(i=cacheLookup(e,r))?(this.drawImage(i,t,n),markUsed(e,r),!0):(o=objectURLForBlob(svgBlobForHTML(e,r)),i=new Image,i.onload=function(){var t,n;return addToCache(e,r,i),(null!=(t=null!=(n=window.URL)?n:window.webkitURL)?t:window).revokeObjectURL(o)},i.onerror=function(t){return addToCache(e,r,new Image),console.log("Failed to load SVG with this <foreignObject> div content:",e)},i.src=o,!1)},window.objectURLForBlob=function(e){var t,n;return(null!=(t=null!=(n=window.URL)?n:window.webkitURL)?t:window).createObjectURL(e)},window.base64URLForBlob=function(e,t){var n;return n=new FileReader,n.onload=function(e){return t(e.target.result)},n.readAsDataURL(e)},CanvasRenderingContext2D.prototype.measureHTML=function(e,t){var n;return null==t&&(t="font-size:12px"),(n=cacheLookup(e,t))?(markUsed(e,t),{width:n.width,height:n.height}):(this.drawHTML(e,0,0,t),null)},window.installDOMUtilitiesIn=function(e){return e.Node.prototype.address=function(e){var t;return null==e&&(e=null),this===e?[]:this.parentNode?(t=this.parentNode.address(e),null===t?null:t.concat([this.indexInParent()])):e?null:[]},e.Node.prototype.indexInParent=function(){return this.parentNode?Array.prototype.slice.apply(this.parentNode.childNodes).indexOf(this):-1},e.Node.prototype.index=function(e){var t;if(!(e instanceof Array))throw Error("Node address function requires an array");return 0===e.length?this:"number"!=typeof e[0]?void 0:null!=(t=this.childNodes[e[0]])?t.index(e.slice(1)):void 0},e.Node.prototype.toJSON=function(t){var n,r,i,o,s,a;if(null==t&&(t=!0),this instanceof e.Text)return this.textContent;if(this instanceof e.Comment)return t?{comment:!0,content:this.textContent}:{m:!0,n:this.textContent};if(!(this instanceof e.Element))throw Error("Cannot serialize this node: "+this);if(i={tagName:this.tagName},this.attributes.length)for(i.attributes={},a=this.attributes,o=0,s=a.length;s>o;o++)n=a[o],i.attributes[n.name]=n.value;return this.childNodes.length&&(i.children=function(){var e,n,i,o;for(i=this.childNodes,o=[],e=0,n=i.length;n>e;e++)r=i[e],o.push(r.toJSON(t));return o}.call(this)),t||(i.t=i.tagName,delete i.tagName,i.a=i.attributes,delete i.attributes,i.c=i.children,delete i.children),i},e.Node.fromJSON=function(t){var n,r,i,o,s,a,u,l;if("string"==typeof t)return e.document.createTextNode(t);if("comment"in t&&t.comment)return e.document.createComment(t.content);if("m"in t&&t.m)return e.document.createComment(t.n);if(!1 in t&&!1 in t)throw Error("Object has no t[agName]: "+this);if(s=e.document.createElement(t.tagName||t.t),n=t.attributes||t.a)for(o in n)__hasProp.call(n,o)&&(a=n[o],s.setAttribute(o,a));if(i=t.children||t.c)for(u=0,l=i.length;l>u;u++)r=i[u],s.appendChild(Node.fromJSON(r));return s},e.Node.prototype.nextLeaf=function(e){var t;for(null==e&&(e=null),t=this;t&&t!==e&&!t.nextSibling;)t=t.parentNode;if(t=null!=t?t.nextSibling:void 0,!t)return null;for(;t.childNodes.length>0;)t=t.childNodes[0];return t},e.Node.prototype.previousLeaf=function(e){var t;for(null==e&&(e=null),t=this;t&&t!==e&&!t.previousSibling;)t=t.parentNode;if(t=null!=t?t.previousSibling:void 0,!t)return null;for(;t.childNodes.length>0;)t=t.childNodes[t.childNodes.length-1];return t},e.Node.prototype.remove=function(){var e;return null!=(e=this.parentNode)?e.removeChild(this):void 0},e.Element.prototype.hasClass=function(e){var t,n;return t=null!=(n=this.getAttribute("class"))?n.split(/\s+/):void 0,t&&__indexOf.call(t,e)>=0},e.Element.prototype.addClass=function(e){var t,n;return t=(null!=(n=this.getAttribute("class"))?n.split(/\s+/):void 0)||[],__indexOf.call(t,e)<0&&t.push(e),this.setAttribute("class",t.join(" "))},e.Element.prototype.removeClass=function(e){var t,n,r;return n=(null!=(r=this.getAttribute("class"))?r.split(/\s+/):void 0)||[],n=function(){var r,i,o;for(o=[],r=0,i=n.length;i>r;r++)t=n[r],t!==e&&o.push(t);return o}(),n.length>0?this.setAttribute("class",n.join(" ")):this.removeAttribute("class")},e.document.nodeFromPoint=function(t,n){var r,i,o,s,a,u,l,c,f,h;for(r=e.document.elementFromPoint(t,n),f=r.childNodes,a=0,l=f.length;l>a;a++)if(i=f[a],i instanceof e.Text)for(o=e.document.createRange(),o.selectNode(i),h=o.getClientRects(),u=0,c=h.length;c>u;u++)if(s=h[u],s.left<t&&t<s.right&&s.top<n&&n<s.bottom)return i;return r}},installDOMUtilitiesIn(window),("undefined"==typeof exports||null===exports)&&(exports=null!=(_ref="undefined"!=typeof module&&null!==module?module.exports:void 0)?_ref:window),exports.OMNode=exports.OM=OM=OMNode=function(){function e(t){this.tree=t,this.setAttribute=__bind(this.setAttribute,this),this.removeAttribute=__bind(this.removeAttribute,this),this.getAttribute=__bind(this.getAttribute,this),this.remove=__bind(this.remove,this),this.findInParent=__bind(this.findInParent,this),this.simpleEncode=__bind(this.simpleEncode,this),this.copy=__bind(this.copy,this),this.sameObjectAs=__bind(this.sameObjectAs,this),this.equals=__bind(this.equals,this),this.encode=__bind(this.encode,this),Object.defineProperty(this,"parent",{get:function(){return this.tree.p?new e(this.tree.p):void 0}}),Object.defineProperty(this,"type",{get:function(){return this.tree.t}}),Object.defineProperty(this,"value",{get:function(){return"bi"!==this.tree.t?this.tree.v:void 0}}),Object.defineProperty(this,"name",{get:function(){return this.tree.n}}),Object.defineProperty(this,"cd",{get:function(){return this.tree.cd}}),Object.defineProperty(this,"uri",{get:function(){return this.tree.uri}}),Object.defineProperty(this,"symbol",{get:function(){return this.tree.s?new e(this.tree.s):void 0}}),Object.defineProperty(this,"body",{get:function(){return this.tree.b?new e(this.tree.b):void 0}}),Object.defineProperty(this,"children",{get:function(){var t,n,r,i,o,s;for(o=null!=(i=this.tree.c)?i:[],s=[],n=0,r=o.length;r>n;n++)t=o[n],s.push(new e(t));return s}}),Object.defineProperty(this,"variables",{get:function(){var t,n,r,i,o;if("bi"===this.tree.t){for(i=this.tree.v,o=[],n=0,r=i.length;r>n;n++)t=i[n],o.push(new e(t));return o}return[]}})}var t;return e.checkJSON=function(e){var t,n,r,i,o,s,a,u,l,c,f,h,d,p,b,g,v,m,y;if(!(e instanceof Object))return"Expected an object, found "+typeof e;if(e.hasOwnProperty("a")){g=e.a;for(o in g)if(__hasProp.call(g,o)){u=g[o];try{a=JSON.parse(o)}catch(w){return r=w,"Key "+o+" invalid JSON"}if("sy"!==a.t)return"Key "+o+" is not a symbol";if(s=this.checkJSON(a))return s;if(s=this.checkJSON(u))return s}}switch(t=function(){var t,n,r,i;for(t=1<=arguments.length?__slice.call(arguments,0):[],i=Object.keys(e),n=0,r=i.length;r>n;n++)if(o=i[n],__indexOf.call(t,o)<0&&"t"!==o&&"a"!==o)return"Key "+o+" not valid in object of type "+e.t;return null},i=/^[:A-Za-z_][:A-Za-z_.0-9-]*$/,e.t){case"i":if(s=t("v"))return s;if(!/^[+-]?[0-9]+$/.test(""+e.v))return"Not an integer: "+e.v;break;case"f":if(s=t("v"))return s;if("number"!=typeof e.v)return"Not a number: "+e.v+" of type "+typeof e.v;if(isNaN(e.v))return"OpenMath floats cannot be NaN";if(!isFinite(e.v))return"OpenMath floats must be finite";break;case"st":if(s=t("v"))return s;if("string"!=typeof e.v)return"Value for st type was "+typeof e.v+", not string";break;case"ba":if(s=t("v"))return s;if(!(e.v instanceof Uint8Array))return"Value for ba type was not an instance of Uint8Array";break;case"sy":if(s=t("n","cd","uri"))return s;if("string"!=typeof e.n)return"Name for sy type was "+typeof e.n+", not string";if("string"!=typeof e.cd)return"CD for sy type was "+typeof e.cd+", not string";if(null!=e.uri&&"string"!=typeof e.uri)return"URI for sy type was "+typeof e.uri+", not string";if(!i.test(e.n))return"Invalid identifier as symbol name: "+e.n;if(!i.test(e.cd))return"Invalid identifier as symbol CD: "+e.cd;break;case"v":if(s=t("n"))return s;if("string"!=typeof e.n)return"Name for v type was "+typeof e.n+", not string";if(!i.test(e.n))return"Invalid identifier as variable name: "+e.n;break;case"a":if(s=t("c"))return s;if(!(e.c instanceof Array))return"Children of application object was not an array";if(0===e.c.length)return"Application object must have at least one child";for(v=e.c,c=0,d=v.length;d>c;c++)if(n=v[c],s=this.checkJSON(n))return s;break;case"bi":if(s=t("s","v","b"))return s;if(s=this.checkJSON(e.s))return s;if("sy"!==e.s.t)return"Head of a binding must be a symbol";if(!(e.v instanceof Array))return"In a binding, the v value must be an array";for(m=e.v,f=0,p=m.length;p>f;f++){if(l=m[f],s=this.checkJSON(l))return s;if("v"!==l.t)return"In a binding, all values in the v array must have type v"}if(s=this.checkJSON(e.b))return s;break;case"e":if(s=t("s","c"))return s;if(s=this.checkJSON(e.s))return s;if("sy"!==e.s.t)return"Head of an error must be a symbol";if(!(e.c instanceof Array))return"In an error, the c key must be an array";for(y=e.c,h=0,b=y.length;b>h;h++)if(n=y[h],s=this.checkJSON(n))return s;break;default:return"Invalid type: "+e.t}return null},e.decode=function(t){var n,r,i;if("string"==typeof t)try{t=JSON.parse(t)}catch(o){return n=o,n.message}return(r=this.checkJSON(t))?r:(i=function(e){var t,n,r,o,s,a,u,l,c,f,h,d,p;for(c=null!=(l=e.c)?l:[],o=0,a=c.length;a>o;o++)t=c[o],t.p=e,i(t);for(h=null!=(f=e.v)?f:[],s=0,u=h.length;u>s;s++)r=h[s],r.p=e,i(r);p=null!=(d=e.a)?d:{};for(n in p)__hasProp.call(p,n)&&(r=p[n],r.p=e,i(r));return null!=e.s&&(e.s.p=e,i(e.s)),null!=e.b?(e.b.p=e,i(e.b)):void 0},i(t),t.p=null,new e(t))},e.prototype.encode=function(){return JSON.stringify(this.tree,function(e,t){return"p"===e?void 0:t})},e.prototype.equals=function(e,t){var n;return null==t&&(t=!0),(n=function(e,r){var i,o,s,a,u,l;if(e===r)return!0;if(e instanceof Array||e instanceof Uint8Array){if(e instanceof Array&&!(r instanceof Array))return!1;if(e instanceof Uint8Array&&!(r instanceof Uint8Array))return!1;if(e.length!==r.length)return!1;for(o=u=0,l=e.length;l>u;o=++u)if(i=e[o],!n(i,r[o]))return!1;return!0}if(!(e instanceof Object))return!1;if(!(r instanceof Object))return!1;for(s in e)if(__hasProp.call(e,s)&&(a=e[s],"p"!==s&&(t||"a"!==s))){if(!r.hasOwnProperty(s))return!1;if(!n(a,r[s]))return!1}for(s in r)if(__hasProp.call(r,s)&&(a=r[s],"p"!==s&&(t||"a"!==s)&&!e.hasOwnProperty(s)))return!1;return!0})(this.tree,e.tree)},e.prototype.sameObjectAs=function(e){return this.tree===(null!=e?e.tree:void 0)},e.prototype.copy=function(){var t;return t=function(e){var n,r,i;switch(e.t){case"i":case"f":case"st":return{t:e.t,v:e.v};case"v":return{t:"v",n:e.n};case"sy":return r={t:"sy",n:e.n,cd:e.cd},e.hasOwnProperty("uri")&&(r.uri=e.uri),r;case"ba":return{t:"ba",v:new Uint8Array(e.v)};case"e":case"a":return r={t:e.t,c:function(){var r,i,o,s;for(o=e.c,s=[],r=0,i=o.length;i>r;r++)n=o[r],s.push(t(n));return s}()},"e"===e.t&&(r.s=t(e.s)),r;case"bi":return{t:"bi",s:t(e.s),v:function(){var n,r,o,s;for(o=e.v,s=[],n=0,r=o.length;r>n;n++)i=o[n],s.push(t(i));return s}(),b:t(e.b)}}},e.decode(t(this.tree))},e.integer=function(t){return e.decode({t:"i",v:t})},e["float"]=function(t){return e.decode({t:"f",v:t})},e.string=function(t){return e.decode({t:"st",v:t})},e.bytearray=function(t){return e.decode({t:"ba",v:t})},e.symbol=function(t,n,r){return e.decode(null!=r?{t:"sy",n:t,cd:n,uri:r}:{t:"sy",n:t,cd:n})},e.variable=function(t){return e.decode({t:"v",n:t})},e.application=function(){var t,n,r,i,o;for(n=1<=arguments.length?__slice.call(arguments,0):[],r={t:"a",c:[]},i=0,o=n.length;o>i;i++)t=n[i],r.c.push(t instanceof e?JSON.parse(t.encode()):t);return e.decode(r)},e.attribution=function(){var t,n,r,i;if(r=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],!(r instanceof Object))return"Invalid first parameter to attribution";if(t.length%2!==0)return"Incomplete key-value pair in attribution";for(r instanceof e&&(r=JSON.parse(r.encode()));t.length>0;)null==r.a&&(r.a={}),n=t.shift(),n=n instanceof e?n.encode():JSON.stringify(n),i=t.shift(),r.a[n]=i instanceof e?JSON.parse(i.encode()):i;return e.decode(r)},e.binding=function(){var t,n,r,i,o,s,a,u;if(n=arguments[0],o=3<=arguments.length?__slice.call(arguments,1,s=arguments.length-1):(s=1,[]),t=arguments[s++],!(n instanceof Object))return"Invalid first parameter to binding";if(!(t instanceof Object))return"Invalid last parameter to binding";for(r={t:"bi",s:n instanceof e?JSON.parse(n.encode()):n,v:[],b:t instanceof e?JSON.parse(t.encode()):t},a=0,u=o.length;u>a;a++)i=o[a],r.v.push(i instanceof e?JSON.parse(i.encode()):i);return e.decode(r)},e.error=function(){var t,n,r,i,o,s;if(t=arguments[0],r=2<=arguments.length?__slice.call(arguments,1):[],!(t instanceof Object))return"Invalid first parameter to binding";for(i={t:"e",s:t instanceof e?JSON.parse(t.encode()):t,c:[]},o=0,s=r.length;s>o;o++)n=r[o],i.c.push(n instanceof e?JSON.parse(n.encode()):n);return e.decode(i)},t=[{name:"symbol",pattern:/[:A-Za-z_][:A-Za-z_0-9-]*\.[:A-Za-z_][:A-Za-z_0-9-]*/},{name:"variable",pattern:/[:A-Za-z_][:A-Za-z_0-9-]*/},{name:"float",pattern:/[+-]?(?:[0-9]+\.[0-9]*|[0-9]*\.[0-9]+)/},{name:"integer",pattern:/[+-]?[0-9]+/},{name:"string",pattern:/"(?:[^"\\]|\\"|\\\\)*"|'(?:[^'\\]|\\'|\\\\)*'/},{name:"comma",pattern:/,/},{name:"openParen",pattern:/\(/},{name:"closeParen",pattern:/\)/},{name:"openBracket",pattern:/\[/},{name:"closeBracket",pattern:/\]/}],e.simpleDecode=function(n){var r,i,o,s,a,u,l,c,f,h,d,p,b,g,v,m,y,w,O,k,_,N,x;if("string"!=typeof n)return"Input was not a string";for(b=[];n.length>0;){for(f=n.length,v=0,O=t.length;O>v;v++)p=t[v],l=p.pattern.exec(n),null!=l&&0===l.index&&(b.push({type:p.name,text:l[0]}),n=n.slice(l[0].length));if(n.length===f)return"Could not understand from here: "+n.slice(0,11)}for(d="expression about to start",h=[];b.length>0;){switch(c=b.shift(),d){case"expression about to start":switch(c.type){case"symbol":o=c.text.split("."),h.unshift({node:e.symbol(o[1],o[0])});break;case"variable":h.unshift({node:e.variable(c.text)});break;case"integer":u=parseInt(c.text),/\./.test(u)&&(u=c.text),h.unshift({node:e.integer(u)});break;case"float":h.unshift({node:e["float"](parseFloat(c.text))});break;case"string":g=c.text[0],c=c.text.slice(1,-1).replace(RegExp("\\\\"+g,"g"),g),h.unshift({node:e.string(c)});break;default:return"Unexpected "+c.text}d="expression ended";break;case"expression ended":switch(c.type){case"comma":d="expression about to start";break;case"openParen":h[0].head="application","closeParen"===(null!=b&&null!=(x=b[0])?x.type:void 0)?(b.shift(),h.unshift({node:e.application(h.shift().node)}),d="expression ended"):d="expression about to start";break;case"openBracket":h[0].head="binding",d="expression about to start";break;case"closeParen":for(a=m=0,k=h.length;k>m&&(i=h[a],"application"!==i.head);a=++m)if("binding"===i.head)return"Mismatch: [ closed by )";if(a===h.length)return"Unexpected )";for(r=[],s=y=0;a>=0?a>=y:y>=a;s=a>=0?++y:--y)r.unshift(h.shift().node);h.unshift({node:e.application.apply(null,r)});break;case"closeBracket":for(a=w=0,_=h.length;_>w&&(i=h[a],"binding"!==i.head);a=++w)if("application"===i.head)return"Mismatch: ( closed by ]";if(a===h.length)return"Unexpected ]";for(r=[],s=N=0;a>=0?a>=N:N>=a;s=a>=0?++N:--N)r.unshift(h.shift().node);h.unshift({node:e.binding.apply(null,r)});break;default:return"Unexpected "+c.text}}if("string"==typeof(null!=h?h[0].node:void 0))return h[0].node}return h.length>1?"Unexpected end of input":h[0].node},e.prototype.simpleEncode=function(){var e;return(e=function(t){var n,r,i,o,s,a;switch(null!=t?t.t:void 0){case"i":case"f":return""+t.v;case"v":return t.n;case"st":return"'"+t.v.replace(/'/g,"\\'")+"'";case"sy":return""+t.cd+"."+t.n;case"ba":return"'byte array'";case"e":return"'error'";case"a":return i=function(){var n,i,o,s;for(o=t.c,s=[],n=0,i=o.length;i>n;n++)r=o[n],s.push(e(r));return s}(),o=i.shift(),""+o+"("+i.join(",")+")";case"bi":return a=function(){var n,r,i,o;for(i=t.v,o=[],n=0,r=i.length;r>n;n++)s=i[n],o.push(e(s));return o}(),o=e(t.s),n=e(t.b),""+o+"["+a.join(",")+","+n+"]";default:return"Error: Invalid OpenMath type "+(null!=t?t.t:void 0)}})(this.tree)},e.prototype.findInParent=function(){var e,t,n,r,i,o,s,a,u,l,c,f,h;if(!this.parent)return void 0;for(l=this.parent.children,t=o=0,a=l.length;a>o;t=++o)if(e=l[t],this.sameObjectAs(e))return"c"+t;if("v"===this.type)for(c=this.parent.variables,t=s=0,u=c.length;u>s;t=++s)if(i=c[t],this.sameObjectAs(i))return"v"+t;if(this.sameObjectAs(this.parent.symbol))return"s";if(this.sameObjectAs(this.parent.body))return"b";h=null!=(f=this.parent.tree.a)?f:{};for(n in h)if(__hasProp.call(h,n)&&(r=h[n],this.tree===r))return n;return void 0},e.prototype.remove=function(){var e;if(e=this.findInParent()){switch(e[0]){case"c":this.parent.tree.c.splice(parseInt(e.slice(1)),1);break;case"v":this.parent.tree.v.splice(parseInt(e.slice(1)),1);break;case"b":delete this.parent.tree.b;break;case"s":delete this.parent.tree.s;break;case"{":delete this.parent.tree.a[e]}return delete this.tree.p}},e.prototype.getAttribute=function(t){var n,r,i,o,s,a;if(!(t instanceof e))return void 0;if("sy"!==t.type)return void 0;i=RegExp('"n":"'+t.name+'"'),n=RegExp('"cd":"'+t.cd+'"'),a=null!=(s=this.tree.a)?s:{};for(r in a)if(__hasProp.call(a,r)&&(o=a[r],i.test(r)&&n.test(r)))return new e(o)},e.prototype.removeAttribute=function(t){var n,r,i,o,s,a;if(t instanceof e&&"sy"===t.type){i=RegExp('"n":"'+t.name+'"'),n=RegExp('"cd":"'+t.cd+'"'),a=null!=(s=this.tree.a)?s:{};for(r in a)if(__hasProp.call(a,r)&&(o=a[r],i.test(r)&&n.test(r)))return new e(o).remove(),void delete this.tree.a[r]}},e.prototype.setAttribute=function(t,n){var r;if(t instanceof e&&n instanceof e&&"sy"===t.type)return this.removeAttribute(t),n.remove(),(null!=(r=this.tree).a?r.a:r.a={})[t.encode()]=n.tree,n.tree.p=this.tree},e}(),OM["int"]=OM.integer,OM.flo=OM["float"],OM.str=OM.string,OM.byt=OM.bytearray,OM.sym=OM.symbol,OM["var"]=OM.variable,OM.app=OM.application,OM.att=OM.attribution,OM.bin=OM.binding,OM.err=OM.error,OM.simple=OM.simpleDecode,JSON.equals=function(e,t){var n,r,i,o,s;if(e instanceof Object!=t instanceof Object)return!1;if(e instanceof Array!=t instanceof Array)return!1;if(!(e instanceof Object))return e===t;if(r=Object.keys(e).sort(),i=Object.keys(t).sort(),JSON.stringify(r)!==JSON.stringify(i))return!1;for(o=0,s=r.length;s>o;o++)if(n=r[o],!JSON.equals(e[n],t[n]))return!1;return!0}}).call(this);
//# sourceMappingURL=weblurch.min.js.map