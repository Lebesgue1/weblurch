(function(){var t,e,r,n=[].slice,i={}.hasOwnProperty,o=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};window.DOMEditAction=t=function(){function t(){var t,r,i,o,s,a,h,l,d;if(s=arguments[0],o=arguments[1],r=3<=arguments.length?n.call(arguments,2):[],!(o instanceof Node))throw Error("This is not a node: "+o);if(this.tracker=e.instanceOver(o),this.node=o.address(this.tracker.getElement()),"appendChild"===s){if(1!==r.length)throw Error("Wrong # of parameters: "+r);if(!(r[0]instanceof Node))throw Error("Invalid parameter: "+r);this.toAppend=r[0].toJSON()}else if("insertBefore"===s){if(1!==r.length&&2!==r.length)throw Error("Wrong # of parameters: "+r);if(!(r[0]instanceof Node))throw Error("Invalid parameter: "+r[0]);if(this.toInsert=r[0].toJSON(),2===r.length){if(!(r[1]instanceof Node))throw Error("Invalid parameter: "+r[0]);if(r[1].parentNode!==o)throw Error("Invalid child: "+r[0]);this.insertBefore=r[1].indexInParent()}else this.insertBefore=o.childNodes.length}else if("normalize"===s){if(0!==r.length)throw Error("Wrong # of parameters: "+r);for(this.textChildren={},l=o.childNodes,i=a=0,h=l.length;h>a;i=++a)t=l[i],t instanceof Text&&(this.textChildren[i]=t.textContent)}else if("removeAttribute"===s){if(1!==r.length)throw Error("Wrong # of parameters: "+r);this.name=r[0]+"",this.value=o.getAttribute(this.name)}else if("removeAttributeNode"===s){if(1!==r.length)throw Error("Wrong # of parameters: "+r);if(!(r[0]instanceof Attr))throw Error("Invalid attribute node: "+r[0]);d=r[0],this.name=d.name,this.value=d.value}else if("removeChild"===s){if(1!==r.length)throw Error("Wrong # of parameters: "+r);if(!(r[0]instanceof Node))throw Error("Invalid parameter: "+r[0]);if(r[0].parentNode!==o)throw Error("Invalid child: "+r[0]);this.childIndex=r[0].indexInParent(),this.child=r[0].toJSON()}else if("replaceChild"===s){if(2!==r.length)throw Error("Wrong # of parameters: "+r);if(!(r[0]instanceof Node))throw Error("Invalid parameter: "+r[0]);if(!(r[1]instanceof Node))throw Error("Invalid parameter: "+r[1]);if(r[0].parentNode!==o)throw Error("Invalid child: "+r[0]);this.childIndex=r[0].indexInParent(),this.oldChild=r[0].toJSON(),this.newChild=r[1].toJSON()}else if("setAttribute"===s){if(2!==r.length)throw Error("Wrong # of parameters: "+r);this.name=r[0]+"",this.newValue=r[1]+"",this.oldValue=o.getAttribute(this.name)}else{if("setAttributeNode"!==s)throw Error("Invalid DOMEditAction type: "+s);if(1!==r.length)throw Error("Wrong # of parameters: "+r);if(!(r[0]instanceof Attr))throw Error("Invalid parameter: "+r[0]);this.name=r[0].name,this.newValue=r[0].value,this.oldValue=o.getAttribute(this.name)}}return t.prototype.toJSON=function(){return JSON.stringify({node:this.node,toAppend:this.toAppend,toInsert:this.toInsert,insertBefore:this.insertBefore,textChildren:this.textChildren,name:this.name,value:this.value,child:this.child,childIndex:this.childIndex,oldChild:this.oldChild,newChild:this.newChild,oldValue:this.oldValue,newValue:this.newValue})},t}(),window.DOMEditTracker=e=function(){function e(t){if(this.element=null,t&&"DIV"!==(null!=t?t.tagName:void 0))throw new Error("DOMEditTracker can only be constructed in a DIV node");this.element=t,this.stack=[],e.instances.push(this)}return e.instances=[],e.instanceOver=function(t){var e,r,n,i;if(!(t instanceof Node))return null;for(i=this.instances,r=0,n=i.length;n>r;r++)if(e=i[r],e.getElement()===t)return e;return this.instanceOver(t.parentNode)},e.prototype.getElement=function(){return this.element},e.prototype.getEditActions=function(){return this.stack.slice(0)},e.prototype.nodeEditHappened=function(e){return e instanceof t?this.stack.push(e):void 0},e}(),Node.prototype.address=function(t){var e;return null==t&&(t=null),this===t?[]:this.parentNode?(e=this.parentNode.address(t),null===e?null:e.concat([this.indexInParent()])):t?null:[]},Node.prototype.indexInParent=function(){return this.parentNode?Array.prototype.slice.apply(this.parentNode.childNodes).indexOf(this):-1},Node.prototype.index=function(t){var e;if(!(t instanceof Array))throw Error("Node address function requires an array");return 0===t.length?this:"number"!=typeof t[0]?void 0:null!=(e=this.childNodes[t[0]])?e.index(t.slice(1)):void 0},Node.prototype.toJSON=function(t){var e,r,n,i,o,s;if(null==t&&(t=!0),this instanceof Text)return this.textContent;if(this instanceof Comment)return t?{comment:!0,content:this.textContent}:{m:!0,n:this.textContent};if(!(this instanceof Element))throw Error("Cannot serialize this node: "+this);if(n={tagName:this.tagName},this.attributes.length)for(n.attributes={},s=this.attributes,i=0,o=s.length;o>i;i++)e=s[i],n.attributes[e.name]=e.value;return this.childNodes.length&&(n.children=function(){var e,n,i,o;for(i=this.childNodes,o=[],e=0,n=i.length;n>e;e++)r=i[e],o.push(r.toJSON(t));return o}.call(this)),t||(n.t=n.tagName,delete n.tagName,n.a=n.attributes,delete n.attributes,n.c=n.children,delete n.children),n},Node.fromJSON=function(t){var e,r,n,o,s,a,h,l;if("string"==typeof t)return document.createTextNode(t);if("comment"in t&&t.comment)return document.createComment(t.content);if("m"in t&&t.m)return document.createComment(t.n);if(!1 in t&&!1 in t)throw Error("Object has no t[agName]: "+this);if(s=document.createElement(t.tagName||t.t),e=t.attributes||t.a)for(o in e)i.call(e,o)&&(a=e[o],s.setAttribute(o,a));if(n=t.children||t.c)for(h=0,l=n.length;l>h;h++)r=n[h],s.appendChild(Node.fromJSON(r));return s},"appendChild insertBefore normalize removeAttribute\nremoveAttributeNode removeChild replaceChild\nsetAttribute setAttributeNode".split(" ").map(function(r){var i;return i=Node.prototype[r],Node.prototype[r]=function(){var o,s,a,h;return o=1<=arguments.length?n.call(arguments,0):[],h=e.instanceOver(this),h&&(s=function(t,e,r){r.prototype=t.prototype;var n=new r,i=t.apply(n,e);return Object(i)===i?i:n}(t,[r,this].concat(n.call(o)),function(){})),a=i.call.apply(i,[this].concat(n.call(o))),h&&h.nodeEditHappened(s),a}}),window.LurchEditor=r=function(t){function e(t){var r,n;e.__super__.constructor.call(this,t),n=this.cleanIds(t),this.freeIds=0===n.length?[0]:function(){var t,e,i;for(i=[],r=t=0,e=Math.max.apply(Math,n)+1;e>=0?e>=t:t>=e;r=e>=0?++t:--t)s.call(n,r)<0&&i.push(r);return i}(),this.assignIds(t)}return o(e,t),e.prototype.nextFreeId=function(){return this.freeIds.length>1?this.freeIds.shift():this.freeIds[0]++},e.prototype.addFreeId=function(t){return t<this.freeIds[this.freeIds.length-1]?(this.freeIds.push(t),this.freeIds.sort(function(t,e){return t-e})):void 0},e.prototype.cleanIds=function(t){var e,r,n,i,o,a;if(n=[],!(t instanceof Node))return n;for(t.id&&(/^\d+$/.test(t.id)?n.push(parseInt(t.id)):t.removeAttribute("id")),a=t.childNodes,i=0,o=a.length;o>i;i++)e=a[i],n=n.concat(function(){var t,i,o,a;for(o=this.cleanIds(e),a=[],t=0,i=o.length;i>t;t++)r=o[t],s.call(n,r)<0&&a.push(r);return a}.call(this));return n},e.prototype.assignIds=function(t){var e,r,n,i,o;if(t instanceof Node){for(t instanceof HTMLElement&&!t.id&&(t.id=this.nextFreeId()),i=t.childNodes,o=[],r=0,n=i.length;n>r;r++)e=i[r],o.push(this.assignIds(e));return o}},e.prototype.address=function(t){return this.element?null!=t?t.address(this.element):void 0:null},e.prototype.index=function(t){return this.element?this.element.index(t):null},e}(e)}).call(this);
//# sourceMappingURL=weblurch.min.js.map