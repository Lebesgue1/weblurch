(function(){var t,e,r,i=[].slice,o={}.hasOwnProperty,n=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1},s=function(t,e){function r(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};window.DOMEditAction=t=function(){function t(){var r,o,n,s,h,l,a,u,d,c,p,f,m,y,g,N;if(u=arguments[0],h=arguments[1],o=3<=arguments.length?i.call(arguments,2):[],"compound"===u){for(this.type=u,this.subactions=null==h?[]:h instanceof Array?h:[h].concat(o),y=this.subactions,d=0,f=y.length;f>d;d++)if(r=y[d],!(r instanceof t))throw Error("Compound action array contained a non-action: "+r);if(0===this.subactions.length)this.node=[],this.tracker=null;else for(this.node=this.subactions[0].node,this.tracker=this.subactions[0].tracker,g=this.subactions.slice(1),c=0,m=g.length;m>c;c++)for(r=g[c],n=r.length,n>this.node.length&&(n=this.node.length),s=p=1;n>=1?n>p:p>n;s=n>=1?++p:--p)if(this.node[s]!==r[s]){this.node=this.node.slice(0,s);break}return this.description="Document edit",this}if(!(h instanceof Node))throw Error("This is not a node: "+h);if(this.tracker=e.instanceOver(h),this.type=u,this.node=h.address(null!=(N=this.tracker)?N.getElement():void 0),"appendChild"===u){if(1!==o.length)throw Error("Wrong # of parameters: "+o);if(!(o[0]instanceof Node))throw Error("Invalid parameter: "+o);this.toAppend=o[0].toJSON()}else if("insertBefore"===u){if(1!==o.length&&2!==o.length)throw Error("Wrong # of parameters: "+o);if(!(o[0]instanceof Node))throw Error("Invalid parameter: "+o[0]);if(this.toInsert=o[0].toJSON(),2===o.length){if(!(o[1]instanceof Node))throw Error("Invalid parameter: "+o[1]);if(o[1].parentNode!==h)throw Error("Invalid child: "+o[1]);this.insertBefore=o[1].indexInParent()}else this.insertBefore=h.childNodes.length}else if("normalize"===u){if(0!==o.length)throw Error("Wrong # of parameters: "+o);this.sequences={},a=this,l=function(t){return function(e,r){var i,o,n,s,h,a;for(null==r&&(r=[]),i=e.childNodes[0],o=0,a=[];i;){if(s=r.concat([o]),i instanceof Text&&i.nextSibling instanceof Text){for(h=[];i instanceof Text;)h.push(i.textContent),i=i.nextSibling;n=JSON.stringify(s),t.sequences[n]=h}else l(i,s),i=i.nextSibling;a.push(o++)}return a}}(this),l(h)}else if("removeAttribute"===u){if(1!==o.length)throw Error("Wrong # of parameters: "+o);this.name=o[0]+"",this.value=h.getAttribute(this.name)}else if("removeAttributeNode"===u){if(1!==o.length)throw Error("Wrong # of parameters: "+o);if(!(o[0]instanceof Attr))throw Error("Invalid attribute node: "+o[0]);this.name=o[0].name,this.value=h.getAttribute(this.name)}else if("removeChild"===u){if(1!==o.length)throw Error("Wrong # of parameters: "+o);if(!(o[0]instanceof Node))throw Error("Invalid parameter: "+o[0]);if(o[0].parentNode!==h)throw Error("Invalid child: "+o[0]);this.childIndex=o[0].indexInParent(),this.child=o[0].toJSON()}else if("replaceChild"===u){if(2!==o.length)throw Error("Wrong # of parameters: "+o);if(!(o[0]instanceof Node))throw Error("Invalid parameter: "+o[0]);if(!(o[1]instanceof Node))throw Error("Invalid parameter: "+o[1]);if(o[1].parentNode!==h)throw Error("Invalid child: "+o[1]);this.childIndex=o[1].indexInParent(),this.oldChild=o[1].toJSON(),this.newChild=o[0].toJSON()}else if("setAttribute"===u){if(2!==o.length)throw Error("Wrong # of parameters: "+o);this.name=o[0]+"",this.newValue=o[1]+"",this.oldValue=h.getAttribute(this.name)||""}else{if("setAttributeNode"!==u)throw Error("Invalid DOMEditAction type: "+u);if(1!==o.length)throw Error("Wrong # of parameters: "+o);if(!(o[0]instanceof Attr))throw Error("Invalid parameter: "+o[0]);this.name=o[0].name,this.newValue=o[0].value,this.oldValue=h.getAttribute(this.name)||""}}return t.prototype.isNullAction=function(){var t,e,r,i;if("appendChild"===this.type||"insertBefore"===this.type||"removeChild"===this.type)return!1;if("removeAttribute"===this.type||"removeAttributeNode"===this.type)return null===this.value;if("normalize"===this.type)return JSON.equals(this.sequences,{});if("replaceChild"===this.type)return JSON.equals(this.oldChild,this.newChild);if("setAttribute"===this.type||"setAttributeNode"===this.type)return this.oldValue===this.newValue;if("compound"===this.type){for(i=this.subactions,e=0,r=i.length;r>e;e++)if(t=i[e],!t.isNullAction())return!1;return!0}throw Error("Invalid DOMEditAction type: "+this.type)},t.prototype.toString=function(){var t,e,r,i,o,n;return t=50,"appendChild"===this.type?(n=Node.fromJSON(this.toAppend).textContent,n.length>t&&(n=n.slice(0,+t+1||9e9)+"..."),0===n.length&&(n="a node"),"Add "+n):"insertBefore"===this.type?(n=Node.fromJSON(this.toInsert).textContent,n.length>t&&(n=n.slice(0,+t+1||9e9)+"..."),0===n.length&&(n="a node"),"Insert "+n):"normalize"===this.type?"Normalize text":"removeAttribute"===this.type||"removeAttributeNode"===this.type?"Remove "+this.name+" attribute":"removeChild"===this.type?(n=Node.fromJSON(this.child).textContent,n.length>t&&(n=n.slice(0,+t+1||9e9)+"..."),0===n.length&&(n="a node"),"Remove "+n):"replaceChild"===this.type?(i=Node.fromJSON(this.oldChild).textContent,i.length>t&&(i=i.slice(0,+t+1||9e9)+"..."),0===i.length&&(i="a node"),o=Node.fromJSON(this.newChild).textContent,o.length>t&&(o=o.slice(0,+t+1||9e9)+"..."),0===o.length&&(o="a node"),"Replace "+i+" with "+o):"setAttribute"===this.type||"setAttributeNode"===this.type?(r=this.oldValue||"empty",e=this.newValue||"empty","Change "+this.name+" from "+r+" to "+e):"compound"===this.type?this.description:"Error, unknown edit action type: "+this.type},t.prototype.toJSON=function(){return{type:this.type,node:this.node,toAppend:this.toAppend,toInsert:this.toInsert,insertBefore:this.insertBefore,sequences:this.sequences,name:this.name,value:this.value,child:this.child,childIndex:this.childIndex,oldChild:this.oldChild,newChild:this.newChild,oldValue:this.oldValue,newValue:this.newValue,description:this.description,subactions:this.subactions}},t.prototype.redo=function(){var t,e,r,i,o,n,s,h;if(!this.tracker)throw Error("Cannot redo action with no DOMEditTracker");if(r=this.tracker.getElement().index(this.node),"appendChild"===this.type)return r.appendChild(Node.fromJSON(this.toAppend));if("insertBefore"===this.type)return e=Node.fromJSON(this.toInsert),this.insertBefore===r.childNodes.length?r.appendChild(e):r.insertBefore(e,r.childNodes[this.insertBefore]);if("normalize"===this.type)return r.normalize();if("removeAttribute"===this.type||"removeAttributeNode"===this.type)return r.removeAttribute(this.name);if("removeChild"===this.type)return r.removeChild(r.childNodes[this.childIndex]);if("replaceChild"===this.type)return i=Node.fromJSON(this.newChild),r.replaceChild(i,r.childNodes[this.childIndex]);if("setAttribute"===this.type||"setAttributeNode"===this.type)return r.setAttribute(this.name,this.newValue);if("compound"===this.type){for(s=this.subactions,h=[],o=0,n=s.length;n>o;o++)t=s[o],h.push(t.redo());return h}},t.prototype.undo=function(){var t,e,r,i,n,s,h,l,a,u,d,c,p,f,m;if(!this.tracker)throw Error("Cannot undo action with no DOMEditTracker");if(s=this.tracker.getElement().index(this.node),"appendChild"===this.type)return s.removeChild(s.childNodes[s.childNodes.length-1]);if("insertBefore"===this.type)return s.removeChild(s.childNodes[this.insertBefore]);if("normalize"===this.type){i={},d=this.sequences;for(n in d)o.call(d,n)&&(i[n]=s.index(JSON.parse(n)));c=this.sequences,f=[];for(n in c)o.call(c,n)&&(r=i[n],f.push(function(){var t,e,i,o;for(i=this.sequences[n],o=[],t=0,e=i.length;e>t;t++)l=i[t],l.length<r.textContent.length?(r.splitText(l.length),o.push(r=r.nextSibling)):o.push(void 0);return o}.call(this)));return f}if("removeAttribute"===this.type||"removeAttributeNode"===this.type)return s.setAttribute(this.name,this.value);if("removeChild"===this.type)return e=Node.fromJSON(this.child),this.childIndex===s.childNodes.length?s.appendChild(e):s.insertBefore(e,s.childNodes[this.childIndex]);if("replaceChild"===this.type)return h=Node.fromJSON(this.oldChild),s.replaceChild(h,s.childNodes[this.childIndex]);if("setAttribute"===this.type||"setAttributeNode"===this.type)return""!==this.oldValue?s.setAttribute(this.name,this.oldValue):s.removeAttribute(this.name);if("compound"===this.type){for(p=this.subactions.slice(0).reverse(),m=[],a=0,u=p.length;u>a;a++)t=p[a],m.push(t.undo());return m}},t}(),window.DOMEditTracker=e=function(){function e(t){if(t&&"DIV"!==(null!=t?t.tagName:void 0))throw new Error("DOMEditTracker can only be constructed in a DIV node");this.element=t||null,this.stack=[],this.stackPointer=0,this.stackRecording=!0,this.compoundActions=null,this.compoundName=null,this.listeners=[],e.instances.push(this)}return e.instances=[],e.instanceOver=function(t){var e,r,i,o;if(!(t instanceof Node))return null;for(o=this.instances,r=0,i=o.length;i>r;r++)if(e=o[r],e.getElement()===t)return e;return this.instanceOver(t.parentNode)},e.prototype.getElement=function(){return this.element},e.prototype.getEditActions=function(){return this.stack.slice(0)},e.prototype.clearStack=function(){return this.stack=[]},e.prototype.nodeEditHappened=function(e){var r,i,o,n;if(e instanceof t&&!e.isNullAction()){for(n=this.listeners,i=0,o=n.length;o>i;i++)(r=n[i])(e);if(this.stackRecording)return null!==this.compoundActions?void this.compoundActions.push(e):(this.stackPointer<this.stack.length&&(this.stack=this.stack.slice(0,this.stackPointer)),this.stack.push(e),this.stackPointer=this.stack.length)}},e.prototype.startCompoundAction=function(t){return null===this.compoundActions?(this.compoundActions=[],this.compoundName=t):void 0},e.prototype.endCompoundAction=function(){var e;if(null!==this.compoundActions)return e=new t("compound",this.compoundActions),this.compoundName&&(e.name=this.compoundName),this.compoundActions=null,this.compoundName=null,this.nodeEditHappened(e)},e.prototype.canUndo=function(){return this.stackPointer>0},e.prototype.canRedo=function(){return this.stackPointer<this.stack.length},e.prototype.undoDescription=function(){return 0===this.stackPointer?"":"Undo "+this.stack[this.stackPointer-1].toString()},e.prototype.redoDescription=function(){return this.stackPointer===this.stack.length?"":"Redo "+this.stack[this.stackPointer].toString()},e.prototype.undo=function(){return this.endCompoundAction(),this.stackPointer>0?(this.stackRecording=!1,this.stack[this.stackPointer-1].undo(),this.stackRecording=!0,this.stackPointer--):void 0},e.prototype.redo=function(){return null===this.compoundActions?this.stackPointer<this.stack.length?(this.stackRecording=!1,this.stack[this.stackPointer].redo(),this.stackRecording=!0,this.stackPointer++):void 0:void 0},e.prototype.listen=function(t){return this.listeners.push(t)},e}(),Node.prototype.address=function(t){var e;return null==t&&(t=null),this===t?[]:this.parentNode?(e=this.parentNode.address(t),null===e?null:e.concat([this.indexInParent()])):t?null:[]},Node.prototype.indexInParent=function(){return this.parentNode?Array.prototype.slice.apply(this.parentNode.childNodes).indexOf(this):-1},Node.prototype.index=function(t){var e;if(!(t instanceof Array))throw Error("Node address function requires an array");return 0===t.length?this:"number"!=typeof t[0]?void 0:null!=(e=this.childNodes[t[0]])?e.index(t.slice(1)):void 0},Node.prototype.toJSON=function(t){var e,r,i,o,n,s;if(null==t&&(t=!0),this instanceof Text)return this.textContent;if(this instanceof Comment)return t?{comment:!0,content:this.textContent}:{m:!0,n:this.textContent};if(!(this instanceof Element))throw Error("Cannot serialize this node: "+this);if(i={tagName:this.tagName},this.attributes.length)for(i.attributes={},s=this.attributes,o=0,n=s.length;n>o;o++)e=s[o],i.attributes[e.name]=e.value;return this.childNodes.length&&(i.children=function(){var e,i,o,n;for(o=this.childNodes,n=[],e=0,i=o.length;i>e;e++)r=o[e],n.push(r.toJSON(t));return n}.call(this)),t||(i.t=i.tagName,delete i.tagName,i.a=i.attributes,delete i.attributes,i.c=i.children,delete i.children),i},Node.fromJSON=function(t){var e,r,i,n,s,h,l,a;if("string"==typeof t)return document.createTextNode(t);if("comment"in t&&t.comment)return document.createComment(t.content);if("m"in t&&t.m)return document.createComment(t.n);if(!1 in t&&!1 in t)throw Error("Object has no t[agName]: "+this);if(s=document.createElement(t.tagName||t.t),e=t.attributes||t.a)for(n in e)o.call(e,n)&&(h=e[n],s.setAttribute(n,h));if(i=t.children||t.c)for(l=0,a=i.length;a>l;l++)r=i[l],s.appendChild(Node.fromJSON(r));return s},"appendChild insertBefore normalize removeAttribute removeAttributeNode removeChild replaceChild setAttribute setAttributeNode".split(/\s+/).map(function(r){var o,n;return n=Node.prototype[r]?Node:Element,o=n.prototype[r],n.prototype[r]=function(){var n,s,h,l;return n=1<=arguments.length?i.call(arguments,0):[],l=e.instanceOver(this),l&&(s=function(t,e,r){r.prototype=t.prototype;var i=new r,o=t.apply(i,e);return Object(o)===o?o:i}(t,[r,this].concat(i.call(n)),function(){})),h=o.call.apply(o,[this].concat(i.call(n))),l&&l.nodeEditHappened(s),h}}),Node.prototype.nextLeaf=function(t){var e;for(null==t&&(t=null),e=this;e&&e!==t&&!e.nextSibling;)e=e.parentNode;if(e=null!=e?e.nextSibling:void 0,!e)return null;for(;e.childNodes.length>0;)e=e.childNodes[0];return e},Node.prototype.previousLeaf=function(t){var e;for(null==t&&(t=null),e=this;e&&e!==t&&!e.previousSibling;)e=e.parentNode;if(e=null!=e?e.previousSibling:void 0,!e)return null;for(;e.childNodes.length>0;)e=e.childNodes[e.childNodes.length-1];return e},Node.prototype.remove=function(){var t;return null!=(t=this.parentNode)?t.removeChild(this):void 0},Element.prototype.hasClass=function(t){var e,r;return e=null!=(r=this.getAttribute("class"))?r.split(/\s+/):void 0,e&&n.call(e,t)>=0},Element.prototype.addClass=function(t){var e,r;return e=(null!=(r=this.getAttribute("class"))?r.split(/\s+/):void 0)||[],n.call(e,t)<0&&e.push(t),this.setAttribute("class",e.join(" "))},Element.prototype.removeClass=function(t){var e,r,i;return r=(null!=(i=this.getAttribute("class"))?i.split(/\s+/):void 0)||[],r=function(){var i,o,n;for(n=[],i=0,o=r.length;o>i;i++)e=r[i],e!==t&&n.push(e);return n}(),r.length>0?this.setAttribute("class",r.join(" ")):this.removeAttribute("class")},window.LurchEditor=r=function(t){function r(t){var e,i;r.__super__.constructor.call(this,t),i=this.cleanIds(t),this.freeIds=0===i.length?[0]:function(){var t,r,o;for(o=[],e=t=0,r=Math.max.apply(Math,i)+1;r>=0?r>=t:t>=r;e=r>=0?++t:--t)n.call(i,e)<0&&o.push(e);return o}(),this.assignIds(t),this.clearStack(),this.cursor={position:null,anchor:null},null===r.prototype.cursorTimerId&&(r.prototype.cursorTimerId=setInterval(r.prototype.blinkCursors,500))}var i;return s(r,t),r.prototype.nextFreeId=function(){return this.freeIds.length>1?this.freeIds.shift():this.freeIds[0]++},r.prototype.addFreeId=function(t){return t<this.freeIds[this.freeIds.length-1]?(this.freeIds.push(t),this.freeIds.sort(function(t,e){return t-e})):void 0},r.prototype.cursorTimerId=null,r.prototype.cleanIds=function(t){var e,r,i,o,s,h;if(i=[],!(t instanceof Node))return i;for(t.id&&(/^\d+$/.test(t.id)?i.push(parseInt(t.id)):t.removeAttribute("id")),h=t.childNodes,o=0,s=h.length;s>o;o++)e=h[o],i=i.concat(function(){var t,o,s,h;for(s=this.cleanIds(e),h=[],t=0,o=s.length;o>t;t++)r=s[t],n.call(i,r)<0&&h.push(r);return h}.call(this));return i},r.prototype.assignIds=function(t){var e,r,i,o,n;if(t instanceof Node){for(t instanceof HTMLElement&&!t.id&&(t.id=this.nextFreeId()),o=t.childNodes,n=[],r=0,i=o.length;i>r;r++)e=o[r],n.push(this.assignIds(e));return n}},r.prototype.address=function(t){return this.element?null!=t?t.address(this.element):void 0:null},r.prototype.index=function(t){return this.element?this.element.index(t):null},r.prototype.positionId="lurch-cursor-position",r.prototype.anchorId="lurch-cursor-anchor",r.prototype.selectionClass="lurch-cursor-selection",r.prototype.updateCursor=function(){var t,e;for(this.cursor={position:null,anchor:null},e=t=document.getElementById(r.prototype.positionId);e&&!this.cursor.position;)e===this.element&&(this.cursor.position=t),e=e.parentNode;for(e=t=document.getElementById(r.prototype.anchorId);e&&!this.cursor.anchor;)e===this.element&&(this.cursor.anchor=t),e=e.parentNode;return this.cursor.anchor=this.cursor.anchor||this.cursor.position},r.prototype.elementsSupportingCursor=function(){var t,e,r,o;for(r="a abbr acronym address article aside b bdi bdo big blockquote caption center cite code dd details dfn div dl dt em fieldset figcaption figure footer form header h1 h2 h3 h4 h5 h6 i kbd label legend li mark nav ol p pre q s samp section small span strong sub summary sup td th time u ul var".trim().split(/\s+/),o=[],t=0,e=r.length;e>t;t++)i=r[t],o.push(i.toUpperCase());return o}(),r.prototype.shouldBeCounted=function(t){return t instanceof Node&&(t=t.tagName),n.call(r.prototype.elementsSupportingCursor,t)>=0?1:0},r.prototype.selectionWrapClass="lurch-selection-wrap",r.prototype.wrapForSelection=function(t){var e,i;return e=document.createElement("span"),e.addClass(r.prototype.selectionWrapClass),e.addClass(r.prototype.selectionClass),null!=(i=t.parentNode)&&i.replaceChild(e,t),e.appendChild(t)},r.prototype.unwrapFromSelection=function(t){var e;return e=t.childNodes[0],t.parentNode.replaceChild(e,t)},r.prototype.isWrappedForSelection=function(t){return"function"==typeof t.hasClass?t.hasClass(r.prototype.selectionWrapClass):void 0},r.prototype.cursorPositionsIn=function(t){var e,i,o,n,s,h,l,a;if(!(t instanceof Node))throw Error("cursorPositionsIn requires a Node as the parameter, but got this: "+t);if(t instanceof Text)return t.length-1;if(this.isWrappedForSelection(t))return this.cursorPositionsIn(t.childNodes[0]);if(0===t.childNodes.length)return this.shouldBeCounted(t);for(n=this.shouldBeCounted(t),s=n,a=Array.prototype.slice.apply(t.childNodes),o=h=0,l=a.length;l>h;o=++h)e=a[o],i="function"==typeof e.getAttribute?e.getAttribute("id"):void 0,i!==r.prototype.positionId&&i!==r.prototype.anchorId&&(s+=n+this.cursorPositionsIn(e));return s},r.prototype.cursorPositionOf=function(t,e){var i,o,n,s;if(null==e&&(e=this.getElement()),!t.parentNode)return 0;for(n=0,s=t.parentNode.childNodes[0],o=this.shouldBeCounted(t.parentNode);s!==t;)i="function"==typeof s.getAttribute?s.getAttribute("id"):void 0,i!==r.prototype.positionId&&i!==r.prototype.anchorId&&(n+=o+this.cursorPositionsIn(s)),s=s.nextSibling;return t.parentNode===e?n:n+this.shouldBeCounted(t.parentNode.parentNode)+this.cursorPositionOf(t.parentNode,e)},r.prototype.cursorPosition=function(){return this.updateCursor(),this.cursor.position?this.cursorPositionOf(this.cursor.position):-1},r.prototype.anchorPosition=function(){return this.updateCursor(),this.cursor.anchor?this.cursorPositionOf(this.cursor.anchor):-1},r.prototype.insertNodeAt=function(t,e,i){var o,n,s,h,l,a,u,d,c;if(null==e&&(e=0),null==i&&(i=this.getElement()),this.isWrappedForSelection(i))return this.insertNodeAt(t,e,i.childNodes[0]);if(i instanceof Text)return void(0>=e+1?i.parentNode.insertBefore(t,i):e+1>=i.textContent.length?i.parentNode.appendChild(t):(a=i.splitText(e+1),i.parentNode.insertBefore(t,a)));for(h=this.shouldBeCounted(i),n=0,c=Array.prototype.slice.apply(i.childNodes),u=0,d=c.length;d>u;u++){if(o=c[u],h>0&&n===e)return void i.insertBefore(t,o);if(s="function"==typeof o.getAttribute?o.getAttribute("id"):void 0,s!==r.prototype.positionId&&s!==r.prototype.anchorId){if(n+=h,l=this.cursorPositionsIn(o),n+l>e)return void this.insertNodeAt(t,e-n,o);n+=l}}return h>0?i.appendChild(t):void 0},r.prototype.removeCursor=function(){var t,e,i,o,n,s,h;for(this.updateCursor(),null!=(n=this.cursor.position)&&n.remove(),null!=(s=this.cursor.anchor)&&s.remove(),this.cursor.position=this.cursor.anchor=null,e=Array.prototype.slice.apply(this.element.getElementsByClassName(r.prototype.selectionClass)),i=0,o=e.length;o>i;i++)t=e[i],this.isWrappedForSelection(t)?this.unwrapFromSelection(t):t.removeClass(r.prototype.selectionClass);return null!=(h=this.getElement())?h.normalize():void 0},r.prototype.placeCursor=function(t,e){var i,o,n,s,h,l,a,u,d,c,p,f,m,y,g;if(null==t&&(t=0),null==e&&(e=!0),o=this.anchorPosition(),this.removeCursor(),n=document.createElement("span"),n.setAttribute("id",r.prototype.positionId),this.insertNodeAt(n,t),this.cursor.position=n,e||-1===o)return void(this.cursor.anchor=this.cursor.position);if(i=document.createElement("span"),i.setAttribute("id",r.prototype.anchorId),this.insertNodeAt(i,o),this.cursor.anchor=i,i.previousSibling===n||i.nextSibling===n)return i.remove(),void(this.cursor.anchor=this.cursor.position);for(m=o>t?[n,i]:[i,n],s=m[0],h=m[1],a=function(t){return function(e){return null===e||e===t.getElement()?null:e.nextSibling||a(e.parentNode)}}(this),d=[],l=function(t,e){var i,o,n,s;if(t===e)return!0;if(!(t instanceof Element))return t instanceof Text&&d.push(t),!1;for(s=Array.prototype.slice.apply(t.childNodes),o=0,n=s.length;n>o;o++)if(i=s[o],l(i,e))return!0;return t.addClass(r.prototype.selectionClass),!1},c=s;(c=a(c))&&!l(c,h););for(g=[],p=0,f=d.length;f>p;p++)u=d[p],g.push((null!=(y=u.parentNode)?y.hasClass(r.prototype.selectionClass):void 0)?void 0:this.wrapForSelection(u));return g},r.prototype.moveCursor=function(t,e){var r,i;return null==t&&(t=0),null==e&&(e=!0),console.log("moveCursor",this.cursorPosition()),-1!==(r=this.cursorPosition())?(console.log("current",r),(i=r+t)<0&&(i=0),console.log("newpos",i),this.placeCursor(i,e),console.log("done")):void 0},r.prototype.cursorVisible="lurch-cursor-visible",r.prototype.blinkCursors=function(t){var i,o,n,s,h,l,a;for(null==t&&(t="toggle"),o=r.prototype.cursorVisible,l=e.instances,a=[],s=0,h=l.length;h>s;s++)if(i=l[s],i instanceof r){if(i.updateCursor(),!i.cursor.position)continue;n=i.stackRecording,i.stackRecording=!1,"toggle"===t&&(t=!i.cursor.position.hasClass(o)),t?i.cursor.position.addClass(o):i.cursor.position.removeClass(o),a.push(i.stackRecording=n)}else a.push(void 0);return a},r}(e),JSON.equals=function(t,e){var r,i,o,n,s;if(t instanceof Object!=e instanceof Object)return!1;if(t instanceof Array!=e instanceof Array)return!1;if(!(t instanceof Object))return t===e;if(i=Object.keys(t).sort(),o=Object.keys(e).sort(),JSON.stringify(i)!==JSON.stringify(o))return!1;for(n=0,s=i.length;s>n;n++)if(r=i[n],!JSON.equals(t[r],e[r]))return!1;return!0}}).call(this);
//# sourceMappingURL=weblurch.min.js.map