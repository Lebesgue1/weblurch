(function(){var t,e,n,r,i,o,s,l=function(t,e){return function(){return t.apply(e,arguments)}},a=[].slice,u={}.hasOwnProperty,c=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};window.Background={functions:{},registerFunction:function(t,e){return window.Background.functions[t]=e},runningTasks:[],waitingTasks:[],addTask:function(t,e,n){var r,i,o,s,l,a,u,c,d,h,f,p;for(o={name:t,inputs:e,callback:n,id:""+t+","+function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)r=e[t],i.push(r.id());return i}()},d=window.Background.waitingTasks,i=l=0,u=d.length;u>l;i=++l)if(s=d[i],s.id===o.id){window.Background.waitingTasks.splice(i,1);break}for(h=window.Background.runningTasks,i=a=0,c=h.length;c>a;i=++a)if(s=h[i],s.id===o.id){null!=(f=s.runner)&&null!=(p=f.worker)&&"function"==typeof p.terminate&&p.terminate(),window.Background.runningTasks.splice(i,1);break}return window.Background.waitingTasks.push(o),window.Background.update()},available:{},update:function(){var e,n,r,i,o;for(e=window.Background;e.runningTasks.length<e.concurrency();){if(null==(i=e.waitingTasks.shift()))return;if(r=null!=(o=e.available[i.name])?o.pop():void 0,null==r){if(n=e.functions[i.name],null==n)continue;r=new t(n)}i.runner=r,e.runningTasks.push(i),function(t){var n;return n=function(){var n,i,o;return n=e.runningTasks.indexOf(t),e.runningTasks.splice(n,1),(null!=(i=e.available)[o=t.name]?i[o]:i[o]=[]).push(r),window.Background.update()},r.call.apply(r,t.inputs).sendTo(function(e){return n(),"function"==typeof t.callback?t.callback(e):void 0}).orElse(n)}(i)}}},navigator.getHardwareConcurrency(function(){}),window.Background.concurrency=function(){var t;return Math.max(1,(null!=(t=navigator.hardwareConcurrency)?t:1)-1)},t=function(){function t(t){this["function"]=t,this.call=l(this.call,this),this.promise={sendTo:function(t){return function(e){return t.promise.resultCallback=e,t.promise.hasOwnProperty("result")&&t.promise.resultCallback(t.promise.result),t.promise}}(this),orElse:function(t){return function(e){return t.promise.errorCallback=e,t.promise.hasOwnProperty("error")&&t.promise.errorCallback(t.promise.error),t.promise}}(this)},window.Worker&&(this.worker=new window.Worker("worker.solo.js"),this.worker.addEventListener("message",function(t){return function(e){var n;return t.promise.result=e.data,null!=(n=t.promise)&&"function"==typeof n.resultCallback?n.resultCallback(e.data):void 0}}(this),!1),this.worker.addEventListener("error",function(t){return function(e){var n;return t.promise.error=e,null!=(n=t.promise)&&"function"==typeof n.errorCallback?n.errorCallback(e):void 0}}(this),!1),this.worker.postMessage({setFunction:""+this["function"]}))}return t.prototype.call=function(){var t,e,n,r,i;for(t=1<=arguments.length?a.call(arguments,0):[],delete this.promise.result,delete this.promise.resultCallback,delete this.promise.error,delete this.promise.errorCallback,r=0,i=arguments.length;i>r;r++)if(e=arguments[r],e.deleted)return;return n=function(){var n,r,i;for(i=[],n=0,r=t.length;r>n;n++)e=t[n],i.push(e.toJSON());return i}(),null!=this.worker?this.worker.postMessage({runOn:n}):setTimeout(function(t){return function(){var e,r,i;try{t.promise.result=t["function"].apply(t,n)}catch(o){return e=o,t.promise.error=e,void("function"==typeof(r=t.promise).errorCallback&&r.errorCallback(t.promise.error))}return"function"==typeof(i=t.promise).resultCallback?i.resultCallback(t.promise.result):void 0}}(this),0),this.promise},t}(),CanvasRenderingContext2D.prototype.roundedRect=function(t,e,n,r,i){return this.beginPath(),this.moveTo(t+i,e),this.lineTo(n-i,e),this.arcTo(n,e,n,e+i,i),this.lineTo(n,r-i),this.arcTo(n,r,n-i,r,i),this.lineTo(t+i,r),this.arcTo(t,r,t,r-i,i),this.lineTo(t,e+i),this.arcTo(t,e,t+i,e,i),this.closePath()},CanvasRenderingContext2D.prototype.roundedZone=function(t,e,n,r,i,o,s,l,a){return this.beginPath(),this.moveTo(t+a,e),this.lineTo(this.canvas.width-l,e),this.lineTo(this.canvas.width-l,o),this.lineTo(n,o),this.lineTo(n,r-a),this.arcTo(n,r,n-a,r,a),this.lineTo(s,r),this.lineTo(s,i),this.lineTo(t,i),this.lineTo(t,e+a),this.arcTo(t,e,t+a,e,a),this.closePath()},window.rectanglesCollide=function(t,e,n,r,i,o,s,l){return!(i>=n||t>=s||o>=r||e>=l)},r={order:[],maxSize:100},n=function(t,e){var n;return n=JSON.stringify([t,e]),r.hasOwnProperty(n)?r[n]:null},e=function(t,e,n){var i;return i=JSON.stringify([t,e]),r[i]=n,o(t,e)},o=function(t,e){var n,i;return i=JSON.stringify([t,e]),(n=r.order.indexOf(i))>-1&&r.order.splice(n,1),r.order.unshift(i),s()},s=function(){var t;for(t=[];r.order.length>r.maxSize;)t.push(delete r[r.order.pop()]);return t},CanvasRenderingContext2D.prototype.drawHTML=function(t,r,s,l){var a,u,c,d,h,f,p,g,w;return null==l&&(l="font-size:12px"),(c=n(t,l))?(this.drawImage(c,r,s),o(t,l),!0):(d=document.createElement("span"),d.setAttribute("style",l),d.innerHTML=t,document.body.appendChild(d),d=$(d),p=d.width(),u=d.height(),d.remove(),a="<svg xmlns='http://www.w3.org/2000/svg' width='"+p+"' height='"+u+"'><foreignObject width='100%' height='100%'><div xmlns='http://www.w3.org/1999/xhtml' style='"+l+"'>"+t+"</div></foreignObject></svg>",h=i(a,"image/svg+xml;charset=utf-8"),f=(null!=(g=null!=(w=window.URL)?w:window.webkitURL)?g:window).createObjectURL(h),c=new Image,c.onload=function(){var n,r;return e(t,l,c),(null!=(n=null!=(r=window.URL)?r:window.webkitURL)?n:window).revokeObjectURL(f)},c.onerror=function(n){return e(t,l,new Image),console.log("Failed to load SVG with this <foreignObject> div content:",t)},c.src=f,!1)},i=function(t,e){var n,r,i,o,s;try{return new Blob([t],{type:e})}catch(l){if(r=l,window.BlobBuilder=null!=(i=null!=(o=null!=(s=window.BlobBuilder)?s:window.WebKitBlobBuilder)?o:window.MozBlobBuilder)?i:window.MSBlobBuilder,"TypeError"===r.name&&null!=window.BlobBuilder)return n=new BlobBuilder,n.append(t.buffer),n.getBlob(e);if("InvalidStateError"===r.name)return new Blob([t.buffer],{type:e})}},CanvasRenderingContext2D.prototype.measureHTML=function(t,e){var r;return null==e&&(e="font-size:12px"),(r=n(t,e))?(o(t,e),{width:r.width,height:r.height}):(this.drawHTML(t,0,0,e),null)},window.installDOMUtilitiesIn=function(t){return t.Node.prototype.address=function(t){var e;return null==t&&(t=null),this===t?[]:this.parentNode?(e=this.parentNode.address(t),null===e?null:e.concat([this.indexInParent()])):t?null:[]},t.Node.prototype.indexInParent=function(){return this.parentNode?Array.prototype.slice.apply(this.parentNode.childNodes).indexOf(this):-1},t.Node.prototype.index=function(t){var e;if(!(t instanceof Array))throw Error("Node address function requires an array");return 0===t.length?this:"number"!=typeof t[0]?void 0:null!=(e=this.childNodes[t[0]])?e.index(t.slice(1)):void 0},t.Node.prototype.toJSON=function(e){var n,r,i,o,s,l;if(null==e&&(e=!0),this instanceof t.Text)return this.textContent;if(this instanceof t.Comment)return e?{comment:!0,content:this.textContent}:{m:!0,n:this.textContent};if(!(this instanceof t.Element))throw Error("Cannot serialize this node: "+this);if(i={tagName:this.tagName},this.attributes.length)for(i.attributes={},l=this.attributes,o=0,s=l.length;s>o;o++)n=l[o],i.attributes[n.name]=n.value;return this.childNodes.length&&(i.children=function(){var t,n,i,o;for(i=this.childNodes,o=[],t=0,n=i.length;n>t;t++)r=i[t],o.push(r.toJSON(e));return o}.call(this)),e||(i.t=i.tagName,delete i.tagName,i.a=i.attributes,delete i.attributes,i.c=i.children,delete i.children),i},t.Node.fromJSON=function(e){var n,r,i,o,s,l,a,c;if("string"==typeof e)return t.document.createTextNode(e);if("comment"in e&&e.comment)return t.document.createComment(e.content);if("m"in e&&e.m)return t.document.createComment(e.n);if(!1 in e&&!1 in e)throw Error("Object has no t[agName]: "+this);if(s=t.document.createElement(e.tagName||e.t),n=e.attributes||e.a)for(o in n)u.call(n,o)&&(l=n[o],s.setAttribute(o,l));if(i=e.children||e.c)for(a=0,c=i.length;c>a;a++)r=i[a],s.appendChild(Node.fromJSON(r));return s},t.Node.prototype.nextLeaf=function(t){var e;for(null==t&&(t=null),e=this;e&&e!==t&&!e.nextSibling;)e=e.parentNode;if(e=null!=e?e.nextSibling:void 0,!e)return null;for(;e.childNodes.length>0;)e=e.childNodes[0];return e},t.Node.prototype.previousLeaf=function(t){var e;for(null==t&&(t=null),e=this;e&&e!==t&&!e.previousSibling;)e=e.parentNode;if(e=null!=e?e.previousSibling:void 0,!e)return null;for(;e.childNodes.length>0;)e=e.childNodes[e.childNodes.length-1];return e},t.Node.prototype.remove=function(){var t;return null!=(t=this.parentNode)?t.removeChild(this):void 0},t.Element.prototype.hasClass=function(t){var e,n;return e=null!=(n=this.getAttribute("class"))?n.split(/\s+/):void 0,e&&c.call(e,t)>=0},t.Element.prototype.addClass=function(t){var e,n;return e=(null!=(n=this.getAttribute("class"))?n.split(/\s+/):void 0)||[],c.call(e,t)<0&&e.push(t),this.setAttribute("class",e.join(" "))},t.Element.prototype.removeClass=function(t){var e,n,r;return n=(null!=(r=this.getAttribute("class"))?r.split(/\s+/):void 0)||[],n=function(){var r,i,o;for(o=[],r=0,i=n.length;i>r;r++)e=n[r],e!==t&&o.push(e);return o}(),n.length>0?this.setAttribute("class",n.join(" ")):this.removeAttribute("class")},t.document.nodeFromPoint=function(e,n){var r,i,o,s,l,a,u,c,d,h;for(r=t.document.elementFromPoint(e,n),d=r.childNodes,l=0,u=d.length;u>l;l++)if(i=d[l],i instanceof t.Text)for(o=t.document.createRange(),o.selectNode(i),h=o.getClientRects(),a=0,c=h.length;c>a;a++)if(s=h[a],s.left<e&&e<s.right&&s.top<n&&n<s.bottom)return i;return r}},installDOMUtilitiesIn(window),JSON.equals=function(t,e){var n,r,i,o,s;if(t instanceof Object!=e instanceof Object)return!1;if(t instanceof Array!=e instanceof Array)return!1;if(!(t instanceof Object))return t===e;if(r=Object.keys(t).sort(),i=Object.keys(e).sort(),JSON.stringify(r)!==JSON.stringify(i))return!1;for(o=0,s=r.length;s>o;o++)if(n=r[o],!JSON.equals(t[n],e[n]))return!1;return!0}}).call(this);
//# sourceMappingURL=weblurch.min.js.map