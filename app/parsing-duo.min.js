(function(){var e,t,n,s,r,o,i,l,u,a=function(e,t){return function(){return e.apply(t,arguments)}},h=[].slice;("undefined"==typeof i||null===i)&&(i=null!=(u="undefined"!=typeof module&&null!==module?module.exports:void 0)?u:window),"undefined"!=typeof require&&null!==require&&require("./utils"),l=function(e){return e.pos<e.rhs.length?e.rhs[e.pos]:null},n=function(e){return{lhs:e.lhs,rhs:e.rhs,pos:e.pos,ori:e.ori,got:e.got.slice(0)}},o=function(e,t){var n,s,r,o,i;if(e.length!==t.length)return!1;for(r=o=0,i=e.length;i>o;r=++o)if(n=e[r],s=t[r],n instanceof RegExp){if(!(s instanceof RegExp)||n.source!==s.source)return!1}else if(n!==s)return!1;return!0},i.Grammar=e=function(){function e(e){this.START=e,this.parse=a(this.parse,this),this.addRule=a(this.addRule,this),this.setOption=a(this.setOption,this),this.rules={},this.defaults={addCategories:!0,collapseBranches:!1,showDebuggingOutput:!1,expressionBuilder:null,tokenizer:null,comparator:JSON.equals,maxIterations:-1}}return e.prototype.setOption=function(e,t){return this.defaults[e]=t},e.prototype.addRule=function(){var e,t,n,s,r,o,i,l,u,a,p;for(e=arguments[0],r=2<=arguments.length?h.call(arguments,1):[],p=[],i=0,u=r.length;u>i;i++){for(s=r[i],s instanceof RegExp&&(s=[s]),s instanceof Array||(s=(""+s).split(" ")),n=l=0,a=s.length;a>l;n=++l)t=s[n],t instanceof RegExp&&(s[n]=new RegExp("^"+t.source+"$"));p.push((null!=(o=this.rules)[e]?o[e]:o[e]=[]).push(s))}return p},e.prototype.parse=function(e,t){var s,i,u,a,h,p,f,g,c,d,m,x,y,k,w,B,R,O,v,z,T,b,E,I,A,C,D,S,q,G,j,J,M,N,F,P,U,$,H,K,L,Q,V,W,X,Y,Z;for(null==t&&(t={}),null==t.addCategories&&(t.addCategories=this.defaults.addCategories),null==t.collapseBranches&&(t.collapseBranches=this.defaults.collapseBranches),null==t.showDebuggingOutput&&(t.showDebuggingOutput=this.defaults.showDebuggingOutput),null==t.expressionBuilder&&(t.expressionBuilder=this.defaults.expressionBuilder),u={},null==t.tokenizer&&(t.tokenizer=this.defaults.tokenizer),null==t.comparator&&(t.comparator=this.defaults.comparator),null==t.maxIterations&&(t.maxIterations=this.defaults.maxIterations),i=t.showDebuggingOutput?function(){return console.log.apply(console,arguments)}:function(){},i("\n\n"),null!=t.tokenizer&&"string"==typeof e&&(e=t.tokenizer.tokenize(e)),z=function(){var t,n,s;for(s=[],p=t=0,n=e.length;n>=0?n>=t:t>=n;p=n>=0?++t:--t)s.push([]);return s}(),z[0].push({lhs:"",rhs:[this.START],pos:0,ori:0,got:[]}),d=0,p=I=0,S=z.length;S>I;p=++I){for(T=z[p],i("processing stateSet "+p+" in this stateGrid (with input "+e+"):"),i("----------------------"),b=A=0,K=z.length;K>=0?K>A:A>K;b=K>=0?++A:--A){for(i("|    state set "+b+":"),O=0,E=C=0,L=z[b].length;L>=0?L>C:C>L;E=L>=0?++C:--C)z[b].length<15||z[b][E].pos>0?i("|        entry "+E+": "+r(z[b][E])):O++;O>0&&i("|    (plus "+O+" at pos 0 not shown)")}for(i("----------------------"),f=0;f<T.length;)if(v=T[f],i("entry "+f+":",r(v)),c=l(v),i("next:",c),null!==c)if(p>=e.length)f++;else if(i("is it a terminal?",c instanceof RegExp),c instanceof RegExp)c.test(e[p])&&(s=n(v),s.pos++,s.got.push(e[p]),z[p+1].push(s),i("scanner added this to "+(p+1)+":",r(s))),f++;else{if(!this.rules.hasOwnProperty(c))throw"Unknown non-terminal in grammar rule: "+c;for(B=this.rules[c],i("rhss: ["+B.join("],[")+"]"),g=N=0,G=B.length;G>N;g=++N){for(w=B[g],a=!1,F=0,j=T.length;j>F;F++)if(R=T[F],R.lhs===c&&o(R.rhs,w)&&0===R.pos){a=!0;break}a||(T.push({lhs:c,rhs:w,pos:0,ori:p,got:[]}),i("adding this state:",r(T[T.length-1])))}if(f++,d++>(W=t.maxIterations)&&W>0)throw"Maximum number of iterations reached."}else{for(i("considering if this completion matters to state set",v.ori),Q=z[v.ori],g=D=0,q=Q.length;q>D;g=++D)if(R=Q[g],l(R)===v.lhs&&(R=n(R),R.pos++,h=v.got.slice(0),t.addCategories&&h.unshift(v.lhs),null!=t.expressionBuilder&&h.unshift(u),t.collapseBranches&&1===h.length&&(h=h[0]),R.got.push(h),z[p].push(R),i("completer added this to "+p+":",r(R)),d++>(V=t.maxIterations)&&V>0))throw"Maximum number of iterations reached.";f++}}for(i("finished processing this stateGrid (with input "+e+"):"),i("----------------------"),b=P=0,X=z.length;X>=0?X>P:P>X;b=X>=0?++P:--P){for(i("|    state set "+b+":"),O=0,E=U=0,Y=z[b].length;Y>=0?Y>U:U>Y;E=Y>=0?++U:--U)z[b].length<15||z[b][E].pos>0?i("|        entry "+E+": "+r(z[b][E])):O++;O>0&&i("|    (plus "+O+" at pos 0 not shown)")}for(i("----------------------"),k=[],Z=z[z.length-1],$=0,J=Z.length;J>$;$++)if(T=Z[$],""===T.lhs&&null===l(T)){if(y=T.got[0],null!=t.expressionBuilder&&(x=function(e){var n,s;return e instanceof Array&&e[0]===u?(n=function(){var t,n,r,o;for(r=e.slice(1),o=[],n=0,t=r.length;t>n;n++)s=r[n],o.push(x(s));return o}(),1===n.length&&t.collapseBranches&&(n=n[0]),n.indexOf(void 0)>-1?void 0:t.expressionBuilder(n)):e},y=x(y),null==y))continue;for(a=!1,H=0,M=k.length;M>H;H++)if(m=k[H],t.comparator(m,y)){a=!0;break}a||k.push(y)}return k},e}(),i.Tokenizer=t=function(){function e(){this.tokenize=a(this.tokenize,this),this.addType=a(this.addType,this),this.tokenTypes=[]}return e.prototype.addType=function(e,t){return null==t&&(t=function(e){return e}),"^"!==e.source[0]&&(e=new RegExp("^(?:"+e.source+")")),this.tokenTypes.push({regexp:e,formatter:t})},e.prototype.tokenize=function(e){var t,n,s,r,o,i,l,u,a,h;for(o=[];e.length>0;){for(r=e.length,h=this.tokenTypes,u=0,a=h.length;a>u;u++)if(l=h[u],n=l.regexp.exec(e)){if(e=e.slice(n[0].length),l.formatter instanceof Function)s=l.formatter(n[0],n),null!=s&&o.push(s);else{for(t=""+l.formatter,i="";s=/\%([0-9]+)/.exec(t);)i+=t.slice(0,s.index)+n[s[1]],t=t.slice(s.index+s[0].length);o.push(i+t)}break}if(e.length===r)return null}return o},e}(),s=function(e){return e instanceof Array?("{}"===JSON.stringify(e[0])&&(e=e.slice(1)),"["+e.map(s).join(",")+"]"):e},r=function(e){return"("+e.lhs+" -> "+e.pos+"in["+e.rhs+"], "+e.ori+") got "+s(e.got)}}).call(this);
//# sourceMappingURL=parsing-duo.min.js.map